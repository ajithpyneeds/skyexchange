if(typeof(RacingSportUtil)=="undefined"){RacingSportUtil={}}(function(){RacingSportUtil.initQueryRacingByDay=function(d,e,c){$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.queryRacingByDayPath,data:{isInit:true,dayType:d,eventType:e,marketTs:-1},success:c,error:function(f){Trace.error(f)}})};var a=function(c){c.find("#closeInfo").hide()};var b=function(c){c.find("#closeInfo").show()};RacingSportUtil.initRenderRacing=function(e){var d=new TreeMap();var s=new TreeMap();for(var F=0;F<e.length;F++){var D=e[F];var h=D.countryCode;if(h==null){continue}var f=d.get(h);if(f==null){f=[];d.put(h,f)}f[f.length]=D}d.keySet().sort(function(j,i){return j.localeCompare(i)});var t=JsCache.get("#contentBox");for(var F=0;F<d.keySet().length;F++){var h=d.keySet()[F];var B=$j("#countryGroup_"+h);if(B.length==0){B=JsCache.clone("#countryGroupTemplate");B.attr("id","countryGroup_"+h);t.append(B);UiUtils.bindToExpand(B.find(".to-expand"),a,b)}B.find("#heading").html(h);var g=false;var f=d.get(h);for(var C=0;C<f.length;C++){var D=f[C];var p=$j("#racingBox_"+D.id);if(p.length==0){p=JsCache.clone("#racingBoxTemplate");p.attr("id","racingBox_"+D.id);B.find("#gameList").append(p)}p.find("#eventName").html(D.name);p.find("#placeInfo").html("--").hide();var l=p.find("#timeRacing");D.markets.sort(function(j,i){if(j.marketTime.localeCompare(i.marketTime)==0){return j.marketName.localeCompare(i.marketName)}return j.marketTime.localeCompare(i.marketTime)});if(D.markets.length>0){var I=null;for(var z=0;z<D.markets.length;z++){var n=D.markets[z];if(n.marketType!="WIN"){continue}if(MarketUtil.isClosed(n.status)||EventUtils.isCloseSite(D.closeSite,PageConfig.webSiteType)||MarketUtil.isCloseSite(n.closeSite,PageConfig.webSiteType)){continue}I=n;break}if(I!=null){var u=s.get(h);if(u==null||I.marketTime.localeCompare(u)<0){s.put(h,I.marketTime)}}}var w=false;for(var z=0;z<D.markets.length;z++){var n=D.markets[z];if(n.marketType!="WIN"){continue}if(MarketUtil.isClosed(n.status)||EventUtils.isCloseSite(D.closeSite,PageConfig.webSiteType)||MarketUtil.isCloseSite(n.closeSite,PageConfig.webSiteType)){continue}w=true;var E=PageConfig.fullMarketPath+"?eventType="+D.eventType+"&eventId="+n.eventId+"&marketId="+n.marketId;var A=n.marketTime.split(" ")[1];if(n.marketType!="WIN"){A=(A+" "+n.marketType)}if($j("#market_"+n.marketId.replace(".","_")).length==0){if(n.inPlay==1){l.append('<li><a id="market_'+n.marketId.replace(".","_")+'" title="'+n.marketName+'" href="'+E+'" marketDateTime="'+n.marketDateTime+'" class="in-play">'+A+"</a></li>")}else{l.append('<li><a id="market_'+n.marketId.replace(".","_")+'" title="'+n.marketName+'" href="'+E+'" marketDateTime="'+n.marketDateTime+'">'+A+"</a></li>")}}var H=p.attr("firstMarketTime");if(H==null||n.marketTime.localeCompare(H)<0){p.attr("firstMarketTime",n.marketTime)}}if(!w){$j("#racingBox_"+D.id).remove()}else{g=true}}var q=B.find(".to-expand").find("#closeInfo");var o=B.find("[id^=racingBox_]");var v=0;var y="";var x="";var m=0;var c=new Date().getTime();o.each(function(){var k=$j(this).find("#timeRacing").find("li");m+=k.length;for(var J=0;J<k.length;J++){var i=k.get(J);var j=$j(i).find("a").attr("marketDateTime");if((j-c)>=0){if(v==0||j<v){v=j}x=((v-c)/60000)+""}}});if(x.indexOf(".")>0){x=x.split(".")[0]}if(parseInt(x)>60){y=(parseInt(x)/60)+"";if(y.indexOf(".")>0){y=y.split(".")[0];x=(x-parseInt(y)*60)+"";y="in "+y+" hrs "}}if(y==""){y="in "}if(x!="0"){x+=" mins"}var r="(Next "+y+x+")";if(r=="(Next in 0)"){r="(Next race starting soon)"}if(m>1){q.html("Races "+m+" "+r)}else{q.html("Race "+m+" "+r)}if(!g){$j("#countryGroup_"+h).remove()}}for(var F=0;F<s.keySet().length;F++){var h=s.keySet()[F];$j("#countryGroup_"+h).attr("firstMarketTime",s.get(h))}var G=t.children();G.sort(function(J,j){var N=$j(J);var M=$j(j);var k=N.attr("firstMarketTime");var i=M.attr("firstMarketTime");if(k==null||i==null){Trace.error(N);Trace.error(M)}if(k==null&&i==null){return 0}if(k==null){return 1}if(i==null){return -1}if(k.localeCompare(i)==0){var L=N.find("#heading").html();var K=M.find("#heading").html();return L.localeCompare(K)}return k.localeCompare(i)});t.append(G);G.each(function(){$this=$j(this);var i=$this.find("[id^=racingBox_]");i.sort(function(K,k){var O=$j(K);var N=$j(k);var J=O.attr("firstMarketTime");var j=N.attr("firstMarketTime");if(J.localeCompare(j)==0){var M=O.find("#eventName").html();var L=N.find("#eventName").html();return M.localeCompare(L)}return J.localeCompare(j)});$this.append(i)})};RacingSportUtil.updateMarkets=function(n){for(var g=0;g<n.length;g++){var d=n[g];d.markets.sort(function(j,i){if(j.marketDateTime>i.marketDateTime){return 1}else{if(j.marketDateTime>i.marketDateTime){return -1}}return 0});var o=$j("#racingBox_"+d.id);for(var f=0;f<d.markets.length;f++){var e=d.markets[f];if(e.marketType!="WIN"){continue}var l=$j("#market_"+e.marketId.replace(".","_"));if(l.length>0){if(e.inPlay==1){if(l.hasClass("in-play")==false){l.addClass("in-play")}}else{l.removeClass("in-play")}if(MarketUtil.isClosed(e.status)||EventUtils.isCloseSite(d.closeSite,PageConfig.webSiteType)||MarketUtil.isCloseSite(e.closeSite,PageConfig.webSiteType)){l.parent().fadeOut("slow");setTimeout(function(i){return function(){$j("#market_"+i).parent().remove();if(o.find("li").length==0){o.remove()}}}(e.marketId.replace(".","_")),5000)}}else{if(MarketUtil.isClosed(e.status)||EventUtils.isCloseSite(d.closeSite,PageConfig.webSiteType)||MarketUtil.isCloseSite(e.closeSite,PageConfig.webSiteType)){continue}var h=o.find("#timeRacing").clone();var k=e.marketTime.split(" ")[1];var c=PageConfig.fullMarketPath+"?eventType="+d.eventType+"&eventId="+e.eventId+"&marketId="+e.marketId;if(e.inPlay==1){h.append('<li><a id="market_'+e.marketId.replace(".","_")+'" title="'+e.marketName+'" href="'+c+'" marketDateTime="'+e.marketDateTime+'" class="in-play">'+k+"</a></li>")}else{h.append('<li><a id="market_'+e.marketId.replace(".","_")+'" title="'+e.marketName+'" href="'+c+'" marketDateTime="'+e.marketDateTime+'">'+k+"</a></li>")}var m=[];h.find("li").each(function(){m.push($j(this))});m.sort(function(j,i){return $j(j).find("a").attr("marketdatetime").localeCompare($j(i).find("a").attr("marketdatetime"))});o.find("#timeRacing").find("li").remove();for(var g=0;g<m.length;g++){o.find("#timeRacing").append(m[g])}}}}}})();