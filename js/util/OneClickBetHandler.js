if(typeof(OneClickBetHandler)=="undefined"){OneClickBetHandler={}}(function(){OneClickBetHandler.pending=[];OneClickBetHandler.init=function(){var B=$j("#oneClickSetting");var A=$j("#oneClickBetStakeBox");var z=A.find("[name=betStake]");var y=$j("#editOneClickBetStakeBox");var x=y.find("[name=editBetStake]");var w=$j("[name=oneClickBetDialog]");OneClickBetHandler.show();v(B);OneClickBetHandler.pending=[];B.unbind("click").click(function(){if(typeof(LoginHandler)!="undefined"&&!LoginHandler.userIsLogin()){return}k(B)});z.unbind("click").click(function(){if(PageConfig.isConfirmOneClickBet==0){return}t(this,A,z)});A.find("#edit").unbind("click").click(function(){if(PageConfig.isConfirmOneClickBet==0){return}OneClickBetHandler.view("edit");y.find("[name=editBetStake]")[0].select()});y.find("#save").unbind("click").click(function(){a(y)});w.find("#ok").unbind("click").click(function(){if(w.find("#dontShow").prop("checked")==true){CookieUtil.setCookie("isHideOneClickBetDialog_"+PageConfig.userID,"1",999)}o(PageConfig.isOneClickBet,PageConfig.oneClickBetStakeIndex,1);w.fadeOut();A.removeClass("white-halo");JsCache.get("#oneClickBetDialog").removeClass("white-halo")});x.unbind("click").click(function(){$j(this).select()})};OneClickBetHandler.show=function(){l();p();r()};OneClickBetHandler.isEnable=function(){return PageConfig.ENABLE_ONE_CLICK_BET_ALL_PAGE?PageConfig.ENABLE_ONE_CLICK_BET_ALL_PAGE:(location.href.indexOf("fullMarket")>=0||location.href.indexOf("multiMarkets")>=0||location.href.indexOf("politics")>=0)};OneClickBetHandler.isEnableSubmitOneClickBet=function(){return(PageConfig.isOneClickBet==1&&PageConfig.isConfirmOneClickBet==1)};OneClickBetHandler.placeBet=function(H,x,w,G,C,B,F){var I=u(H,F);var y=x.attr("eventType");var E=BetHandler.getMinBet(w,G);var z=parseFloat(E);var A=H.attr("inPlay");if(parseFloat(PageConfig.selectBetStake)>z){z=parseFloat(PageConfig.selectBetStake)}var D={sideType:B,odds:I,stake:z,eventType:y,eventId:w,marketId:G.replace("_","."),selectionId:C,inPlay:A,timestamp:new Date().getTime()};OneClickBetHandler.submitBet(D)};OneClickBetHandler.submitBet=function(w){TxnHandler.clickResetBtn();var z=0;var y="";if(PageConfig.ENABLE_LINE_MARKET){LineMarketHandler.reverseSideType([w])}if(w.length==0||!w){return}var x=n(w);$j.ajax({type:"POST",dataType:"JSON",url:"/exchange/member/playerService/exchange",data:{bets:JSON.stringify([w]),isOneClickBet:1},beforeSend:function(){h(w);d(x,true)},complete:function(){d(x,false)},success:function(A){try{if(A.error){NoticeHandler.error(A.error);return}if(A.result.length==0){return}BetHandler.isOnBetting=false;var F=[];for(var B in A.result){var G=A.result[B];if(G.status=="SUCCESS"){if(z==0&&y==""){z=G.eventId;y=G.marketId}if(G.unMatchTicket!=null){DataBase.unMatchTicket.update([G.unMatchTicket])}if(G.txn!=null){DataBase.txn.update([G.txn])}var E=G.eventId+"_"+G.marketId;if(ArrayUtil.indexOf(F,E)==-1){F.push(E)}}else{if(G.error){NoticeHandler.error(G.error)}}}if(z!=0&&y!=""){TxnHandler.setEventIdAndMarketId(z,y,CategoryType.BETFAIR.unique());z=0;y=""}if(F.length>0){for(var C=0;C<F.length;C++){var E=F[C].split("_");BetHandler.getWinLoss(E[0],E[1])}}setTimeout(function(){TxnHandler.getUnMatchTicketsAndTxns()},250);TxnHandler.updateOpenBetSelectionBox();TxnHandler.addBlankSelectOption(PageConfig.selectEventId,PageConfig.selectMarketId);TxnHandler.checkToHideOpenBets()}catch(D){Trace.printStackTrace(D)}finally{f();d(x,false)}},error:function(A){Trace.printStackTrace(A)}});JsCache.get("#confirmBetList").hide();JsCache.get("#confirmBetFullBtn").hide()};OneClickBetHandler.placeFancyBet=function(D,x,w,G,A,C,H){var z=DataBase.fancyBetMarkets.get(w,G);if(z==null){Trace.log("onclickbet fancy market"+G+" is null");return}var B=parseFloat(z.min);var F=parseFloat(z.max);var y=parseFloat(PageConfig.selectBetStake);if(y<B){NoticeHandler.error("[Bet "+G+"_"+FancySideType.getInstanceOf(A).name+"] "+I18N.get("msg.member.minBet"));return}if(y>F){NoticeHandler.error("[Bet "+G+"_"+FancySideType.getInstanceOf(A).name+"] "+I18N.get("msg.member.maxBet"));return}var E={eventType:x,eventId:w,marketId:G,sideType:A,runs:C,odds:H,stake:y,timestamp:new Date().getTime()};FancyBetHandler.submitBet(E,null,null,1,TopMenuHandler.isAcceptAnyOdds("fancyBet")?1:0)};OneClickBetHandler.placeFeedingSiteBet=function(D,x,w,F,B,G){var z=DataBase.feedingSiteMarkets.get(w,F);if(z==null){Trace.log("oneClickBet FeedingSite market"+F+" is null");return}var A=parseFloat(z.min);var E=parseFloat(z.max);var y=parseFloat(PageConfig.selectBetStake);if(y<A){NoticeHandler.error("[Bet "+F+"_"+B+"] "+I18N.get("msg.member.minBet"));return}if(y>E){NoticeHandler.error("[Bet "+F+"_"+B+"] "+I18N.get("msg.member.maxBet"));return}var C={eventType:x,eventId:w,marketId:F,selectionId:B,odds:G,stake:y,betfairEventId:z.betfairEventId,timestamp:new Date().getTime()};FeedingSiteBetHandler.submitBet(C,null,null,1)};OneClickBetHandler.placeSportsBookBet=function(E,H,x,w,G,B,I){var z=DataBase.sportsBookMarkets.get(H,w,G);if(z==null){Trace.log("oneClickBet sportsBookBet market"+G+" is null");return}var A=parseFloat(z.min);var F=parseFloat(z.max);var y=parseFloat(PageConfig.selectBetStake);if(y<A){NoticeHandler.error("[Bet "+G+"_"+B+"] "+I18N.get("msg.member.minBet"));return}if(y>F){NoticeHandler.error("[Bet "+G+"_"+B+"] "+I18N.get("msg.member.maxBet"));return}var D=E.prop("handicap");var C={apiSiteType:H,eventType:x,eventId:w,marketId:G,selectionId:B,odds:I,stake:y,betfairEventId:z.betfairEventId,handicap:D,timestamp:new Date().getTime()};SportsBookBetHandler.submitBet(C,H,TopMenuHandler.isAcceptAnyOdds("sportsBook")?1:0,null,null,1)};OneClickBetHandler.placeBookMakerBet=function(E,x,w,G,C,A,H){var z=DataBase.bookMakerMarkets.get(w,G);if(z==null){Trace.log("oneClickBet bookMakerBet market"+G+" is null");return}var B=parseFloat(z.min);var F=parseFloat(z.max);var y=parseFloat(PageConfig.selectBetStake);if(y<B){NoticeHandler.error("[Bet "+G+"_"+C+"] "+I18N.get("msg.member.minBet"));return}if(y>F){NoticeHandler.error("[Bet "+G+"_"+C+"] "+I18N.get("msg.member.maxBet"));return}var D={eventType:x,eventId:w,marketId:G,selectionId:C,sideType:A,odds:H,stake:y};BookMakerBetHandler.submitBet(D,null,null,1,TopMenuHandler.isAcceptAnyOdds("fancyBet")?1:0)};function h(w){if(w==null){return}OneClickBetHandler.pending.push(w);c(OneClickBetHandler.pending[0])}function f(){if(OneClickBetHandler.pending.length>0){OneClickBetHandler.pending.shift()}c(OneClickBetHandler.pending[0])}function c(w){var A=$j("#oneClickLoadingWrap");var z=JsCache.get("#openBetSlip");var D=A.find("#loadPending");var y=A.find("#pendingNum");var B=A.find("#oneClickTime");var x=OneClickBetHandler.pending.length;if(x>1){D.show()}else{D.hide()}if(x>0){if(w!=null){b(B,5)}y.html((x-1));A.show();z.css("height","calc(100% - 131px)");var C=JsCache.get(".matched-wrap");if(!C.is(":visible")){C.show();JsCache.get(".slip-wrap").removeClass("no-open-bet_slip")}}else{A.hide();z.css("height","calc(100% - 35px)")}}var g=null;function b(x,w){if(g!=null){clearTimeout(g);g=null}var y=w;if(y>=0){q(x,y)}}function q(w,x){if(x>0){w.html(I18N.get("form.button.placeBets")+I18N.get("form.button.placeBets.forNumberSec",[x]));x--;g=setTimeout(function(){q(w,x)},1000)}else{w.html(I18N.get("form.button.placeBets")+I18N.get("form.button.placeBets.processing"));clearTimeout(g);g=null}}function o(x,w,y){$j.ajax({type:"POST",dataType:"JSON",url:"/exchange/member/playerService/setPlayerOneClickBet",data:{isOneClickBet:x,oneClickBetStakeIndex:w,isConfirmOneClickBet:y},success:function(z){if(!z){return}if(z.result=="SUCCESS"){if(z.isOneClickBet!=null&&z.isOneClickBet!=PageConfig.isOneClickBet){PageConfig.isOneClickBet=z.isOneClickBet;r()}if(z.oneClickBetStakeIndex!=null&&PageConfig.oneClickBetStakeIndex!=z.oneClickBetStakeIndex){PageConfig.oneClickBetStakeIndex=z.oneClickBetStakeIndex}if(z.isConfirmOneClickBet!=null&&z.isConfirmOneClickBet!=PageConfig.isConfirmOneClickBet){PageConfig.isConfirmOneClickBet=z.isConfirmOneClickBet}}else{PageConfig.isOneClickBet=0;r()}},error:function(z){Trace.log(z);PageConfig.isOneClickBet=0;r()}})}function v(w){w.removeClass("select");if(PageConfig.isOneClickBet==1){w.addClass("select")}}function k(w){if(w.hasClass("select")){w.removeClass("select");o(0,PageConfig.oneClickBetStakeIndex,PageConfig.isConfirmOneClickBet)}else{w.addClass("select");o(1,PageConfig.oneClickBetStakeIndex,PageConfig.isConfirmOneClickBet)}}function l(){var w=$j("#oneClickSetting");if(OneClickBetHandler.isEnable()){w.show()}else{w.hide()}}function r(){var x=$j("#oneClickBetStakeBox");var w=$j("#editOneClickBetStakeBox");if(PageConfig.isOneClickBet==1&&OneClickBetHandler.isEnable()){x.show()}else{x.hide();w.hide()}UiUtils.appendHeight();i()}function p(){var z=e();var A=$j("#oneClickBetStakeBox");var x=$j("#editOneClickBetStakeBox");var y=A.find("[name=betStake]");var w=x.find("[name=editBetStake]");$j.each(y,function(B,C){C=A.find(C);C.html(z[B]);C.removeClass("select");if(PageConfig.oneClickBetStakeIndex==B){C.addClass("select");PageConfig.selectBetStake=z[B]}});$j.each(w,function(B,C){C=x.find(C);C.val(z[B])})}function t(w,A,y){w=$j(w);var z=e();var x=w.attr("index");if(PageConfig.oneClickBetStakeIndex==x){return}y.removeClass("select");A.find("[index="+x+"]").addClass("select");o(PageConfig.isOneClickBet,x,PageConfig.isConfirmOneClickBet);PageConfig.selectBetStake=z[x]}function a(x){var y=[];var w=x.find("[name=editBetStake]");$j.each(w,function(A,B){B=x.find(B);var z=B.val();if(MathUtil.isNumeric(z,false,false)&&z.length<=8){if(z<PageConfig.minBet){z=PageConfig.minBet}y.push(z)}else{NoticeHandler.error("[ "+z+" ] is illegal")}});if(y.toString()==PageConfig.oneClickBetStake){p();OneClickBetHandler.view("normal");return}if(y.length!=4){p();OneClickBetHandler.view("normal");return}j(y.toString())}function j(w){$j.ajax({type:"POST",dataType:"JSON",url:"/exchange/member/playerService/setOneClickBetStake",data:{newOneClickBetStake:w},success:function(x){if(!x){return}if(x.error){NoticeHandler.error(x.error);m();return}if(x.result=="SUCCESS"&&x.oneClickBetStake!=null){PageConfig.oneClickBetStake=x.oneClickBetStake;p()}OneClickBetHandler.view("normal")},error:function(x){Trace.log(x);m()}})}function m(){PageConfig.oneClickBetStake="";p();OneClickBetHandler.view("normal")}function e(){if(PageConfig.oneClickBetStake=="null"||PageConfig.oneClickBetStake==""){for(var w=1;w<=4;w++){var x=CoinType.getInstanceOf(PageConfig.playerCurrency,w);if(w==1){PageConfig.oneClickBetStake=x.amounts}else{PageConfig.oneClickBetStake+=","+x.amounts}}}return PageConfig.oneClickBetStake.split(",")}function n(y){var x;var z=y.eventId;var A=y.marketId;if(MultiMarketsHandler.isViewMultiMarket()||PageConfig.isPoliticsPage==true){x=$j("[id^=multiMarket_"+z+"_"+A.replace(".","_")+"]")}else{if(PageConfig.selectEventId==-1){if(location.hash=="#InPlay"){x=$j("#event_"+z)}else{x=$j("#highLightEvent_"+z)}}else{var w=$j("#fullMarketBetsWrap:visible");if(z==w.attr("eventid")&&A==w.attr("marketid")){x=w}else{if($j("#popMarketItem_"+A.replace(".","_")).length>0){x=$j("#popMarketItem_"+A.replace(".","_"))}}}}return x}function d(x,w){if(w){x.addClass("disabled");x.addClass("cooldown")}else{x.removeClass("cooldown");x.removeClass("disabled")}}var s=[{name:"normal",elem:["#oneClickBetStakeBox"]},{name:"edit",elem:["#editOneClickBetStakeBox"]}];OneClickBetHandler.view=function(w){UiUtils.view(w,s)};function i(){var x=CookieUtil.getCookie("isHideOneClickBetDialog_"+PageConfig.userID);var w=JsCache.get("[name=oneClickBetDialog]");var z=JsCache.get("#oneClickBetStakeBox");var y=JsCache.get("#oneClickBetDialog");z.removeClass("white-halo");y.removeClass("white-halo");if(PageConfig.isOneClickBet==1&&x==null&&OneClickBetHandler.isEnable()&&PageConfig.isConfirmOneClickBet==0){w.fadeIn();z.addClass("white-halo");y.addClass("white-halo")}else{w.fadeOut()}}function u(x,y){var w=1.01;w=parseFloat(x.html());if(y==true){w=parseFloat(x.attr("fullMarketOdds"))}if(isNaN(w)){w=1.01}return w}OneClickBetHandler.showMsg=function(F,H,D,B,C){var G=$j(".matched-wrap");var w=G.find("#oneClickMsg");w.removeClass("success").removeClass("error").addClass(F);if(H!=null){w.html(H)}else{if(C!=null){var y="";var z=SideType.getInstanceOf(C.sideType);var A=(B=="txn"?"Bet Matched ":"Bet Unmatched ");var x=(B=="txn"?C.stake:C.lastPrice);var E=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:E.symbol});y=A+StringUtil.ucfirst(z.name)+" "+C.selectionName+" "+CurrencyUtil.formatter(x)+" at odds "+C.odds;w.html(y)}}if(D){setTimeout(function(){w.fadeOut()},2000)}w.fadeIn()}})();