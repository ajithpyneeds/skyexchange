if(typeof(AnnouncementUtilHandler)=="undefined"){AnnouncementUtilHandler={}}if(typeof(PageCommonConfig)=="undefined"){PageCommonConfig={}}(function(){AnnouncementUtilHandler.listAnnouncement=function(b){var c={};c.pageNumber=b;$j.ajax({type:"POST",dataType:"JSON",url:AnnouncementUtilHandler.getUrl()+"getActiveAnnouncement",data:c,success:function(d){try{var g=d.totalPage;var h=d.currentPage;PageHandler.init(h,g,function(e){AnnouncementUtilHandler.listAnnouncement(e)});PageHandler.pageList();var f=$j("#announcementContent");f.empty();$j.each(d.resultList,function(e,j){var k=JsCache.get("#announcementTemplate").clone();k.find("#date").attr("id","date_"+e).html(DateUtil.format(j.publishDate,"dd"));k.find("#month").attr("id","month_"+e).html(DateUtil.format(j.publishDate,"MMM"));k.find("#year").attr("id","year_"+e).html(DateUtil.format(j.publishDate,"yyyy"));k.find("#textByLanguageType").attr("id","textByLanguageType_"+e).html(j.message);f.append(k)});if(d.resultList.length==0){$j("#announcementContent").addClass("nofound");f.append(JsCache.get("#announcementNotFound").clone())}else{$j("#announcementContent").removeClass("nofound")}}catch(i){Trace.printStackTrace(i)}finally{}},error:function(){}})};AnnouncementUtilHandler.search=function(b){var c={};c.publishDate=$j("#searchDateStr").val().trim();c.pageNumber=b;if(PageConfig.announcementPageType=="manager"){c.status=$j("#status").val()}$j.ajax({type:"POST",dataType:"JSON",url:AnnouncementUtilHandler.getUrl()+"queryAnnouncement",data:c,beforeSend:function(){},complete:function(){},success:function(d){if(!d){return}if(d.error){alert(d.error);return}var f=d.totalPage;var g=d.currentPage;PageHandler.init(g,f,function(h){AnnouncementUtilHandler.search(h)});PageHandler.pageList();var e=$j("#announcementContent");e.empty();$j.each(d.resultList,function(h,i){var k=i.id;var j=JsCache.get("#announcementTemplate").clone();j.find("#id").attr("id","id_"+k).html(k);j.find("#status").attr("id","status_"+k).html(AnnouncementStatusType.getInstanceOf(i.status).name);j.find("#receiverType").attr("id","receiverType_"+k).html(AnnouncementReceiverType.getInstanceOf(i.receiverType).name1);j.find("#publishDate").attr("id","publishDate_"+k).html(i.publishDate);j.find("#updateDate").attr("id","updateDate_"+k).html(i.updateDate);j.find("#durationHr").attr("id","durationHr_"+k).html(i.durationHr+" hr");j.find("#creator").attr("id","creator_"+k).html(i.creator);j.find("#updator").attr("id","updator_"+k).html(i.updator);if(PageConfig.announcementPageType=="manager"){AnnouncementHandler.bindButton(j,i.id)}j.find("#englishText").attr("id","englishText_"+k).html(i.englishText.replace(/<[^>]*>/g,""));e.append(j)})},error:function(f,d,e){Trace.log(f.status);Trace.log(e)}})};AnnouncementUtilHandler.initPlayerAnnouncementPage=function(){AnnouncementUtilHandler.initAnnouncementTask();UiUtils.appendHeight()};AnnouncementUtilHandler.showAnnouncementTask=null;AnnouncementUtilHandler.initAnnouncementTask=function(){if(AnnouncementUtilHandler.isLogin()){if(AnnouncementUtilHandler.showAnnouncementTask==null){var b=TaskExecuterV2.createTask(60,0,function(){a(this)});AnnouncementUtilHandler.showAnnouncementTask=b}else{AnnouncementUtilHandler.showAnnouncementTask.isStop=false}AnnouncementUtilHandler.showAnnouncementTask.run();TaskExecuterV2.execute()}else{$j(".marquee-box").hide()}};function a(b){var c={};c.pageNumber=1;c.pageSize=100;$j.ajax({type:"POST",dataType:"JSON",url:AnnouncementUtilHandler.getUrl()+"getActiveAnnouncement",data:{data:c},success:function(d){try{if(!isEqual(b.oldAnnouncement,d.resultList)){$content=$j(".marquee");$content.empty();$j.each(d.resultList,function(e,g){$content.append("<a><span>"+DateUtil.format(g.publishDate,"dd MMM yyyy")+"</span>"+g.message+"</a>")});b.oldAnnouncement=d.resultList;$j(".marquee").find("a").click(function(){if(PageCommonConfig.announcementPageType=="player"){$j("#announcementPopUp").css("display","flex");AnnouncementUtilHandler.initAllAnnouncementPage()}else{window.open(PageConfig.allAnnouncementPagePath,"_blank",config="height=640,width=880,location=no")}});$j(".marquee").marquee({duration:16000,gap:0,delayBeforeStart:0,direction:"left",duplicated:false,})}}catch(f){Trace.printStackTrace(f)}finally{b.check();TaskExecuterV2.execute()}},error:function(){b.check();TaskExecuterV2.execute()}})}AnnouncementUtilHandler.initAllAnnouncementPage=function(){AnnouncementUtilHandler.listAnnouncement(1)};AnnouncementUtilHandler.getUrl=function(){if(PageCommonConfig.announcementPageType=="player"){return PageCommonConfig.ajaxPath}else{return PageConfig.ajaxPath}};AnnouncementUtilHandler.isLogin=function(){return typeof(PageConfig.userName)!="undefined"||PageConfig.hasAccount||(typeof(PageCommonConfig.hasAccount)!="undefined"&&PageCommonConfig.hasAccount)}})();var isEqual=function(b,a){return JSON.stringify(b)===JSON.stringify(a)};