if(typeof(FullMarketUtil)=="undefined"){FullMarketUtil={}}(function(){var c="http://content-cache.betfair.com/feeds_images/Horses/SilkColours/";FullMarketUtil.updateFullMarket=function(j,f,g,d,m,i,k){var l=$j("#fullMarketBetsWrap");var n=EventType.getInstanceOf(g);var e=DataBase.events.get(g,d);if(e==null){return}j.find("#multiMarketRefresh").unbind("click").click(function(){j.find("#multiMarketLoading").show();setTimeout(function(){j.find("#multiMarketLoading").hide()},500)});j.find("#backAll").unbind("click").click(function(){FullMarketUtil.betAll(this,j)});j.find("#layAll").unbind("click").click(function(){FullMarketUtil.betAll(this,j)});if(PageConfig.ENABLE_LINE_MARKET&&MarketUtil.isLineMarket(i.marketType,i.bettingType)){j.find("#selectionCounts").hide()}else{j.find("#selectionCounts").html(i.numberOfActiveRunners+" selections").show()}var h=i.selections;if(h==null){return}FullMarketUtil.updateSelection(j,f,g,d,m,h,false,k)};FullMarketUtil.updateSelection=function(O,n,t,r,y,g,x,v){var D=$j("#fullMarketBetsWrap");var f=EventType.getInstanceOf(t);var e=true;var I=false;var R=DataBase.events.get(t,r);if(R==null){return}var M=DataBase.markets.get(r,y);if(M==null){return}var j={precision:0,separateSign:",",currencySymbol:PageConfig.currencySymbol==null?"$":PageConfig.currencySymbol,formatter:CurrencyUtil.DefaultFormatter,"trailingZeros,":false};var P=1.01;if(PageConfig.ENABLE_LINE_MARKET){if(MarketUtil.isLineMarket(M.marketType,M.bettingType)){P=2}}if(!FullMarketUtil.isViewMultiMarket()&&!PageConfig.isPoliticsPage){if(g.length==0){D.hide()}else{D.show()}}g.sort(function(S,i){if(S.sortPriority>i.sortPriority){return 1}else{if(S.sortPriority<i.sortPriority){return -1}else{return 0}}});for(var C in g){var q=g[C];var w=q.selectionId;var d=O.find("#fullSelection_"+w);var k=SelectionUtil.isShowSelection(q.closeSite,q.bookMode,PageConfig.webSiteType);var K=GameProductUtils.isClose(v)||SelectionUtil.isShowSuspend(q.suspendSite,q.bookSuspend,PageConfig.webSiteType);var z=q.isAutoSuspend==1;var u="";if(d.length==0){if(!k){continue}if(f.isRacingEvent()){if(!SelectionUtil.isActive(q.status)&&!SelectionUtil.isRemoved(q.status)&&!SelectionUtil.isRemovedVacant(q.status)&&!SelectionUtil.isHidden(q.status)){continue}}else{if(!SelectionUtil.isActive(q.status)){continue}}I=true;var G="";u="window.open('market/marketDepth.jsp?eventId="+r+"&marketId="+y+"&selectionId="+q.selectionId+"','_blank','resizable=no,width=920,height=600')";G='<a onclick="'+u+'"><img class="icon-predict" src="/images/transparent.gif"/></a>';d=D.find("#fullSelectionTemplate").clone();d.attr("id","fullSelection_"+w);d.attr("eventType",R.eventType);d.attr("eventId",R.id);d.attr("marketId",M.marketId.replace(".","_"));d.attr("selectionId",w);d.attr("eventName",R.name);d.attr("status",q.status);d.attr("sortPriority",q.sortPriority);d.find("p").append(G+q.runnerName);d.find("td[class^='back-']").attr("selectionId",w).attr("runner",q.runnerName).attr("marketName",M.marketName).attr("marketType",M.marketType);d.find("td[class^='lay-']").attr("selectionId",w).attr("runner",q.runnerName).attr("marketName",M.marketName).attr("marketType",M.marketType);FullMarketUtil.bindEvent(d);n.append(d.show());if(e){TxnHandler.changeOpenBetInFullMarkets(r,y);e=false}}else{if(!k){d.hide();continue}if(!d.is(":visible")){d.show()}if(f.isRacingEvent()){if(!SelectionUtil.isActive(q.status)&&!SelectionUtil.isRemoved(q.status)&&!SelectionUtil.isRemovedVacant(q.status)&&!SelectionUtil.isHidden(q.status)){d.remove();continue}}else{if(!SelectionUtil.isActive(q.status)){d.remove();continue}}}if(!x&&((FullMarketViewHandler.isEnableFullMarketWebSocket()&&FullMarketViewHandler.webSocketUtil!=null&&FullMarketViewHandler.webSocketUtil.getReadyState()==1)||(MultiMarketsHandler.isEnableMultiMarketWebSocket()&&MultiMarketsHandler.webSocketUtil!=null&&MultiMarketsHandler.webSocketUtil.getReadyState()==1&&MultiMarketsHandler.isWebSocketUpdateMarket(r,y)))){}else{var Q=d.find("td[class^='back-']");var A=d.find("td[class^='lay-']");Q.attr("fullMarketOdds",P).attr("inPlay",M.inPlay).removeClass("spark");UiUtils.removeContents(Q.find("a"));UiUtils.removeContents(Q.find("span"));A.attr("fullMarketOdds",P).attr("inPlay",M.inPlay).removeClass("spark");UiUtils.removeContents(A.find("a"));UiUtils.removeContents(A.find("span"));if(MarketUtil.isOpen(M.status)){var s=1;var l=q.availableToBack;for(var L in l){var J=l[L];var F=d.find("#back_"+s);F.attr("fullMarketOdds",J.price);SparkHandler.addSparkClass(F,J.price,J.size);CurrencyUtil.updateSetting({currencySymbol:PageConfig.currencySymbol==null?"$":PageConfig.currencySymbol});F.find("span").before(J.price).append(CurrencyUtil.formatter(J.size,j));s++}var E=1;var p=q.availableToLay;for(var L in p){var H=p[L];var o=d.find("#lay_"+E);o.attr("fullMarketOdds",H.price);SparkHandler.addSparkClass(o,H.price,H.size);CurrencyUtil.updateSetting({currencySymbol:PageConfig.currencySymbol==null?"$":PageConfig.currencySymbol});o.find("span").before(H.price).append(CurrencyUtil.formatter(H.size,j));E++}}}if(!x){if(z){d.addClass("disabled")}else{d.removeClass("disabled")}if(K){d.find("#suspend").show();d.find("#closed").hide();d.find("#nonRunner").hide();d.find("td[class^='back-']").hide();d.find("td[class^='lay-']").hide()}else{if(MarketUtil.isOpen(M.status)){d.find("#suspend").hide();d.find("#closed").hide();d.find("#nonRunner").hide();d.find("td[class^='back-']").show();d.find("td[class^='lay-']").show()}else{if(K||(MarketUtil.isSuspend(M.status)&&!MarketUtil.isClosed(M.status))){d.find("#suspend").show();d.find("#closed").hide();d.find("#nonRunner").hide();d.find("td[class^='back-']").hide();d.find("td[class^='lay-']").hide()}else{if(MarketUtil.isClosed(M.status)){d.find("#suspend").hide();d.find("#closed").show();d.find("#nonRunner").hide();d.find("td[class^='back-']").hide();d.find("td[class^='lay-']").hide()}}}if(f.isRacingEvent()){if(SelectionUtil.isHidden(q.status)||SelectionUtil.isRemoved(q.status)||SelectionUtil.isRemovedVacant(q.status)){if(d.find("#suspend").is(":hidden")&&d.find("#closed").is(":hidden")){d.find("#nonRunner").show()}d.find("td[class^='back-']").hide();d.find("td[class^='lay-']").hide()}}}}if(PageConfig.ENABLE_JOCKEY_COLOR){FullMarketUtil.appendJockeyColor(d,R,M,q,u,t)}}if(!x){if(I==true){BetHandler.getWinLoss(r,y.replace(".","_"));BetHandler.addSelectClass()}FullMarketUtil.showBetBookPercent(g,n);if(PageConfig.ENABLE_CASH_OUT=="true"){CashOutHandler.updatePending(y,q)}}var m=false;var B=false;if(BetHandler.isEnableCheckLowLiquidity()){if(BetHandler.isLowLiquidity(t,r,y.replace("_","."))){B=true}}var h=M.disableBettingSite;var N=M.autoDisableBettingSite;if(WebSiteUtil.isDisableBettingSite(h,PageConfig.webSiteType)||WebSiteUtil.isDisableBettingSite(N,PageConfig.webSiteType)){m=true}if(m||B){n.addClass("disabled")}else{if(!n.hasClass("cooldown")){n.removeClass("disabled")}}};FullMarketUtil.bindEvent=function(d){d.find("td[class^='back-']").mouseup(function(){BetHandler.clickBtn(this,true)});d.find("td[class^='lay-']").mouseup(function(){BetHandler.clickBtn(this,true)})};FullMarketUtil.betAll=function(g,d){var f=$j(g);var i=f.attr("id");var h=[];if(i=="backAll"){h=d.find("td[id^='back_1']")}else{if(i=="layAll"){h=d.find("td[id^='lay_1']")}}var e=true;BetHandler.betAll(h,e,d.attr("eventType"),d.attr("eventId"),d.attr("marketId"))};FullMarketUtil.showBetBookPercent=function(g,f){var h=0;var n=0;for(var k in g){var m=g[k];var j=0;if(m.availableToBack[0]!=null){j=parseFloat(m.availableToBack[0].price)}var e=0;if(m.availableToLay[0]!=null){e=parseFloat(m.availableToLay[0].price)}if(j!=0){h+=MathUtil.decimal.divide(1,j)}else{h+=1}if(e!=0){n+=MathUtil.decimal.divide(1,e)}}h=MathUtil.decimal.multiply(h,100);n=MathUtil.decimal.multiply(n,100);h=MathUtil.roundp(h,1);n=MathUtil.roundp(n,1);var d=f.find("#backPercent");var l=f.find("#layPercent");if(d!=null&&d.length!=0){d.html(h+"%")}if(l!=null&&l.length!=0){l.html(n+"%")}};FullMarketUtil.showLowLiquidityTag=function(e,d){if(d){e.show()}else{e.hide()}};FullMarketUtil.disableBetButton=function(e,d){if(d){e.addClass("disable")}else{e.removeClass("disable")}};FullMarketUtil.appendJockeyColor=function(x,w,l,A,g,o){if(l.marketType!=null&&"WIN"!=l.marketType&&"PLACE"!=l.marketType&&"OTHER_PLACE"!=l.marketType){return}if(EventType.GREYHOUND_RACING.unique()==o){FullMarketUtil.appendGreyhoundJockeyColor(x,w,l,A,g);return}if(A.runnerMetadata==null||A.runnerMetadata.length==0){return}var t=null;try{t=JSON.parse(A.runnerMetadata)}catch(y){Trace.log(y)}if(t==null||t.length==0){return}var v=false;if(w.countryCode!=null&&"US"==w.countryCode){v=true}var d=t.COLOURS_FILENAME;if(d==null&&!v){return}var u=t.CLOTH_NUMBER_ALPHA;var r=t.STALL_DRAW;var f=t.JOCKEY_NAME;var k=t.TRAINER_NAME==null?"N/A":t.TRAINER_NAME;var s=t.AGE==null?"N/A":t.AGE;var q=t.WEIGHT_VALUE;var i=t.WEIGHT_UNITS;var h=t.FORM==null?"N/A":t.FORM;var p=t.DAYS_SINCE_LAST_RUN==null?"N/A":t.DAYS_SINCE_LAST_RUN;var j=t.JOCKEY_CLAIM==null?"N/A":t.JOCKEY_CLAIM;var m=t.WEARING==null?"N/A":t.WEARING;if(d==null&&v){d="saddle_"+u}var n=(i==null||q==null)?"N/A":b(i,q);var z=x.find("#horseInfo");if(v){z.find("#horseBox").hide()}else{if(u!=null&&r!=null){z.find("#clothNumberAlpha").html(u);z.find("#stallDraw").html("("+r+")")}else{z.find("#clothNumberAlpha").html(u);z.find("#stallDraw").hide()}}if(v){z.find("#uniform").addClass(d.replace(".gif",""));z.find("#uniform").find("img").hide()}else{z.find("#uniform").find("img").prop("src",c+d)}if(f==null){z.find("#jockyName").hide()}else{z.find("#jockyName").html(f)}z.find("#runnerName").html(A.runnerName);z.find("#trainerName").html(k);z.find("#ageWeight").html(s+" / "+n);z.find("#form").html(h);z.find("#daysSinceLastRun").html(p);z.find("#jockeyClam").html(j);z.find("#wearing").html(m);z.show();if(g.length>0){z.find("#marketDepthBtn").attr("onclick",g)}x.find("p").hide()};function b(e,f){if("pounds"==e){var d=parseInt(MathUtil.decimal.multiply(f,0.071429));return d+"-"+parseInt(f-(d*14))}return f+e}FullMarketUtil.appendGreyhoundJockeyColor=function(m,e,h,n,i){var k=m.find("#horseInfo");if(k.is(":visible")){return}k.removeClass("horse-info").addClass("dog-info");k.find("#horseInfoHover").hide();k.find("#horseBox").hide();var f=false;if(e.countryCode!=null&&("AU"==e.countryCode||"NZ"==e.countryCode)){f=true}var p=n.runnerName;var j=[];if(p.indexOf(".")>-1){j=p.split(".")}var g=j[0];var d=j[1];var l="/images/greyhound/";var o="";if(f){o+="aus_"}o+="silk_"+g+".png";k.find("#jockyName").html(d);k.find("#uniform").find("img").prop("src",l+o);k.show();if(i.length>0){k.find("#marketDepthBtn").attr("onclick",i)}m.find("p").hide()};FullMarketUtil.setBrowserTabName=function(d){if(d&&d.length>0){try{$j("head title",window.parent.document).text(d)}catch(f){Trace.printStackTrace(f)}}};var a=[{name:"fancyBet",elem:["[id^=fancyBetTable_]"]},{name:"sportsBookBet",elem:["#sportsBookWrap"]}];FullMarketUtil.view=function(f){UiUtils.view(f,a);if("sportsBookBet"==f){var e=$j("#overWrap");var d=e.find("#sportsBookWrap");SportsBookEventHandler.extandMarket(d)}};FullMarketUtil.isViewMultiMarket=function(){return location.href.indexOf("multiMarkets")>-1}})();