if(typeof(FancyBetRulesHandler)=="undefined"){FancyBetRulesHandler={};FancyBetRulesHandler.mainId=1;FancyBetRulesHandler.subId=1}(function(){FancyBetRulesHandler.data="";FancyBetRulesHandler.initForManager=function(){FancyBetRulesHandler.showFancyBetRules("manager");$j("#addMainContent").click(function(){FancyBetRulesHandler.addMainContent("")});$j("#update").click(function(){FancyBetRulesHandler.updateFancyBetRule()})};function a(){$j.each($j("[name=seq]"),function(d,c){$j(c).text(d)})}FancyBetRulesHandler.addMainContent=function(f){var e=FancyBetRulesHandler.mainId;var c=$j("#settingContent");var d=$j("#mainTemplate").clone();d.attr("id","mainTemplate_"+e);d.find("#mainRule").attr("id","mainRule_"+e).val(f);d.find("#addSubContent").attr("id","addSubContent_"+e).click(function(){FancyBetRulesHandler.addSubContent(e,"")});d.find("#deleteMainContent").attr("id","deleteMainContent_"+e).click(function(){$j("#mainTemplate_"+e).remove();$j("[id^=subTemplate_][mainid^="+e+"]").remove();a()});c.append(d);a();FancyBetRulesHandler.mainId++};FancyBetRulesHandler.addSubContent=function(f,c){var d=FancyBetRulesHandler.subId;var g=$j("#mainTemplate_"+f);var e=$j("#subTemplate").clone();e.attr("id","subTemplate_"+d).attr("mainid",f);e.find("#subRule").attr("id","subRule_"+d).attr("mainid",f).val(c);e.find("#deleteSubContent").attr("id","deleteSubContent_"+d).click(function(){$j("#subTemplate_"+d).remove()});if($j("[id^=subTemplate_][mainid="+f+"]").length==0){g.after(e)}else{$j("[id^=subTemplate_][mainid="+f+"]").last().after(e)}FancyBetRulesHandler.subId++};function b(){var d=$j("#settingContent");var c=d.find("[id^=mainRule]");if(c.length==0){alert("At least input one rule");return}var e={};$j.each(c,function(j,g){var m=$j(g).attr("id").split("_")[1];var l=$j("#mainRule_"+m).val().trim();if(l==""){return}var h={};h.mainRule=l;var k=$j("[id^=subRule_][mainid="+m+"]");var f={};$j.each(k,function(n,i){var o=$j(i).val().trim();if(o==""){return}f[n+1]=o.trim()});h.subRule=f;e[j+1]=h});return e}FancyBetRulesHandler.updateFancyBetRule=function(){var c=b();if(c==null){return}$j.ajax({type:"POST",url:"/manage/marketManagementController/updateFancyBetRule",data:{fancyBetRules:JSON.stringify(c)},beforeSend:function(){JsCache.get("#loading").show()},complete:function(){JsCache.get("#loading").hide()},success:function(d){try{if(d.error){NoticeHandler.error(d.error);return}if(d.success){NoticeHandler.success(d.success)}}catch(f){Trace.printStackTrace(f)}finally{}},error:function(f,d,e){Trace.log(f.status);Trace.log(e)}})};FancyBetRulesHandler.showFancyBetRules=function(d){var c="/manage/marketManagementController/queryFancyBetRule";if(d=="player"){c="/exchange/member/playerService/queryFancyBetRule"}$j.ajax({type:"GET",dataType:"JSON",url:c,data:{},beforeSend:function(){JsCache.get("#loading").show()},complete:function(){JsCache.get("#loading").hide()},success:function(e){if(!e){return}if(e.error){NoticeHandler.error(e.error);return}if($j.isEmptyObject(e)){return}FancyBetRulesHandler.data=e;if(d=="player"){FancyBetRulesHandler.populateForPlayer()}else{FancyBetRulesHandler.populateForManager()}},error:function(g,e,f){Trace.log(g.status);Trace.log(f)}})};FancyBetRulesHandler.populateForPlayer=function(e){var c=$j("[name^=fancyBetRules]");c.empty();var f="";var d=Object.keys(FancyBetRulesHandler.data);$j.each(d,function(g,h){var i=FancyBetRulesHandler.data[h].mainRule;f+="<li>"+i;var j=FancyBetRulesHandler.data[h].subRule;var k=Object.keys(j);$j.each(k,function(l,n){var m=j[n];f+="<ul>"+m+"</ul>"});f+="</li>"});c.append(f)};FancyBetRulesHandler.populateForManager=function(e){var c=$j("[name^=fancyBetRules]");c.empty();var f="";var d=Object.keys(FancyBetRulesHandler.data);$j.each(d,function(g,h){var i=FancyBetRulesHandler.data[h].mainRule;FancyBetRulesHandler.addMainContent(i);var j=FancyBetRulesHandler.data[h].subRule;var k=Object.keys(j);$j.each(k,function(l,n){var m=j[n];FancyBetRulesHandler.addSubContent(FancyBetRulesHandler.mainId-1,m)})})}})();