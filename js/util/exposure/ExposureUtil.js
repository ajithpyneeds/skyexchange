if(typeof(ExposureUtil)=="undefined"){ExposureUtil={}}(function(){ExposureUtil.calculateExposure=function(e,d,p,n,b,h,k,l){var j=new HashMap();var f=h.selections;var o=parseInt(h.numberOfWinners);var q=parseInt(h.numberOfActiveRunners);var m=parseInt(h.numberOfRunners);var a=ExposureUtil.getNotActiveSelectionIdArr(f);if(o==0||o>1){if(e.length>0){ExposureUtil.appendToShow(k,e)}if(!l&&d.length>0){ExposureUtil.appendToShow(k,d)}if(p.length>0){ExposureUtil.appendToShow(k,p)}}var t=ExposureUtil.genTicketArray(e,true);var c=ExposureUtil.genTicketArray(d,false,true);var g=ExposureUtil.genTicketArray(p,true);ExposureHandler.initMarketInfo(n,b.replace("_","."),o,q,a);var v=null;var u=null;var x=null;var z=null;if(g.length>0){ExposureHandler.calculateExposure(g);v=ExposureHandler.getMarketExposure();u=v.betSelections;ExposureHandler.setMarketExposure(v)}if(!l&&c.length>0){ExposureHandler.calculateExposure(c);v=ExposureHandler.getMarketExposure();u=v.betSelections;ExposureHandler.setMarketExposure(v)}if(t.length>0){ExposureHandler.calculateExposure(t);x=ExposureHandler.getMarketExposure();z=x.betSelections}for(var s in f){var y=f[s];var w=y.selectionId;var r={withoutBet:0,withBet:0,lossWithoutBet:0,lossWithBet:0};if(u!=null){if(u[w]!=null){if(o==0||o>1){r.withoutBet=u[w].selectionWinPL;r.lossWithoutBet=u[w].selectionLossPL}else{r.withoutBet=u[w].minExposure}}else{r.withoutBet=u[0]==null?0:u[0].minExposure}}if(z!=null){if(z[w]!=null){if(o==0||o>1){r.withBet=z[w].selectionWinPL;r.lossWithBet=z[w].selectionLossPL}else{r.withBet=z[w].minExposure}}else{r.withBet=z[0]==null?0:z[0].minExposure}}j.put(w,r)}return j};ExposureUtil.getNotActiveSelectionIdArr=function(d){var b=[];if(d.length>0){for(var a in d){var c=d[a];if(c==null||c.status==null||SelectionUtil.isActive(c.status)){continue}b.push(c.selectionId)}}return b};ExposureUtil.genTicketArray=function(f,e,c){var b=[];for(var d in f){var g=f[d];var a=0;if(c){a=g.lastPrice}else{a=g.stake}if(a==0||a==null){continue}var h=ExposureHandler.generatorBetTicketObj(g.eventId,g.marketId.replace("_","."),g.selectionId,g.odds,a,g.sideType,e,g.status,g.result);b.push(h)}return b};ExposureUtil.appendToShow=function(c,d){for(var b in d){var a=d[b];if(MyTransactionStatusType.Active.unique()!=a.status||a.summary==1){continue}if(ArrayUtil.indexOf(c,a.selectionId)==-1){c.push(a.selectionId)}}};ExposureUtil.calculateFancyBetExposure=function(e,g,h,c){var a=ExposureUtil.genFancyBetTicketArray(h,true);var b=ExposureUtil.genFancyBetTicketArray(c,true);FancyBetExposureHandler.initMarketInfo(e,g);var f=null;var d=null;if(b.length>0){FancyBetExposureHandler.calculateExposure(b);f=FancyBetExposureHandler.getMarketExposure();FancyBetExposureHandler.setMarketExposure(f)}if(a.length>0){FancyBetExposureHandler.calculateExposure(a);d=FancyBetExposureHandler.getMarketExposure()}return{exposureBeforeBet:f,exposureAfterBet:d}};ExposureUtil.genFancyBetTicketArray=function(c){var a=[];for(var b in c){var d=c[b];var e=FancyBetExposureHandler.generatorBetTicketObj(d.eventId,d.marketId,d.runs,d.odds,d.stake,d.sideType,d.status);a.push(e)}return a};ExposureUtil.calculateFeedingSiteBetExposure=function(a,k,e,j,i,f,g){var d=ExposureUtil.genFeedingSiteBetTicketArray(i,true);var h=ExposureUtil.genFeedingSiteBetTicketArray(f,false);var l=ExposureUtil.genFeedingSiteBetTicketArray(g,true);IBCExposureHandler.initMarketInfo(a,k,e,j);var c=null;var b=null;if(l.length>0){IBCExposureHandler.calculateExposure(l);c=IBCExposureHandler.getMarketExposure();IBCExposureHandler.setMarketExposure(c)}if(h.length>0){IBCExposureHandler.calculateExposure(h);c=IBCExposureHandler.getMarketExposure();IBCExposureHandler.setMarketExposure(c)}if(d.length>0){IBCExposureHandler.calculateExposure(d);b=IBCExposureHandler.getMarketExposure()}return{exposureBeforeBet:c,exposureAfterBet:b}};ExposureUtil.genFeedingSiteBetTicketArray=function(e,d){var b=[];for(var c in e){var f=e[c];var a=(f.lastPrice==null?f.stake:f.lastPrice);var g=IBCExposureHandler.generatorBetTicketObj(f.eventId,f.marketId,f.selectionId,f.odds,a,d);b.push(g)}return b};ExposureUtil.isEnableShowSportsBookExposure=function(a,c,b){if(ApiSiteType.OW.unique()==a&&b){return true}if(ApiSiteType.SPORTRADAR.unique()==a&&c){return true}return false};ExposureUtil.calculateSportsBookExposure=function(b,c,f,e,d,g,a){if(ApiSiteType.SPORTRADAR.unique()==b){return ExposureUtil.calculateSportradarExposure(c,f,e,d,g,a)}if(ApiSiteType.OW.unique()==b){return ExposureUtil.calculateOwExposure(c,f,e,d,g,a)}return null};ExposureUtil.calculateSportradarExposure=function(a,i,e,h,g,f){var d=ExposureUtil.genSportradarTicketArray(g);var j=ExposureUtil.genSportradarTicketArray(f);SportradarExposureHandler.initMarketInfo(a,i,e,h);var c=null;var b=null;if(j.length>0){SportradarExposureHandler.calculateExposure(j);c=SportradarExposureHandler.getMarketExposure();SportradarExposureHandler.setMarketExposure(c)}if(d.length>0){SportradarExposureHandler.calculateExposure(d);b=SportradarExposureHandler.getMarketExposure()}return{exposureBeforeBet:c,exposureAfterBet:b}};ExposureUtil.genSportradarTicketArray=function(d){var b=[];for(var c in d){var e=d[c];var a=(e.lastPrice==null?e.stake:e.lastPrice);var f=SportradarExposureHandler.generatorBetTicketObj(e.eventId,e.marketId,e.selectionId,e.odds,a);b.push(f)}return b};ExposureUtil.calculateOwExposure=function(a,i,e,h,g,f){var d=ExposureUtil.genOwTicketArray(g);var j=ExposureUtil.genOwTicketArray(f);OwExposureHandler.initMarketInfo(a,i,e,h);var c=null;var b=null;if(j.length>0){OwExposureHandler.calculateExposure(j);c=OwExposureHandler.getMarketExposure();OwExposureHandler.setMarketExposure(c)}if(d.length>0){OwExposureHandler.calculateExposure(d);b=OwExposureHandler.getMarketExposure()}return{exposureBeforeBet:c,exposureAfterBet:b}};ExposureUtil.genOwTicketArray=function(d){var b=[];for(var c in d){var e=d[c];var a=(e.lastPrice==null?e.stake:e.lastPrice);var f=OwExposureHandler.generatorBetTicketObj(e.eventType,e.eventId,e.marketId,e.selectionId,e.odds,a);b.push(f)}return b};ExposureUtil.calculateBookMakerExposure=function(a,j,h,g,e,b){var i=parseInt(e.numberOfActiveRunners);var f=ExposureUtil.genBookMakerTicketArray(h,true);var k=ExposureUtil.genBookMakerTicketArray(g,true);BookMakerExposureHandler.initMarketInfo(a,j,i);var d=null;var c=null;if(k.length>0){BookMakerExposureHandler.calculateExposure(k);d=BookMakerExposureHandler.getMarketExposure();BookMakerExposureHandler.setMarketExposure(d)}if(f.length>0){BookMakerExposureHandler.calculateExposure(f);c=BookMakerExposureHandler.getMarketExposure()}return{exposureBeforeBet:d,exposureAfterBet:c}};ExposureUtil.genBookMakerTicketArray=function(d){var b=[];for(var c in d){var e=d[c];var a=e.stake;if(a==0||a==null){continue}var f=BookMakerExposureHandler.generatorBetTicketObj(e.eventType,e.eventId,e.marketId,e.selectionId,e.odds,a,e.sideType,e.status,e.result);b.push(f)}return b}})();