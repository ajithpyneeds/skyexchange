if(typeof BookMakerExposureHandler=="undefined"){BookMakerExposureHandler={}}(function(){MarketExposureObj={eventId:null,marketId:null,defaultActiveRunners:0,numberOfActiveRunners:0,marketExposure:0,betSelections:{}};SelectionExposureObj={minExposure:0,diff:0,selectionWinPL:0,selectionLossPL:0};NotActiveSelectionIds=[];function d(){MarketExposureObj.eventId=null;MarketExposureObj.marketId=null;MarketExposureObj.defaultActiveRunners=0;MarketExposureObj.numberOfActiveRunners=0;MarketExposureObj.marketExposure=0;MarketExposureObj.betSelections={};SelectionExposureObj.minExposure=0;SelectionExposureObj.diff=0;SelectionExposureObj.selectionWinPL=0;SelectionExposureObj.selectionLossPL=0;NotActiveSelectionIds=[]}BookMakerExposureHandler.getMarketExposure=function(){return b(MarketExposureObj)};BookMakerExposureHandler.setMarketExposure=function(g){d();MarketExposureObj=b(g)};BookMakerExposureHandler.initMarketInfo=function(g,i,h){d();MarketExposureObj.eventId=g;MarketExposureObj.marketId=i;MarketExposureObj.defaultActiveRunners=h;MarketExposureObj.numberOfActiveRunners=h;MarketExposureObj.betSelections[0]=b(SelectionExposureObj)};BookMakerExposureHandler.generatorBetTicketObj=function(h,g,o,l,q,i,j,k,p){var n=-1;if(EventType.SOCCER.unique()===h){n=MathUtil.decimal.multiply(j==1?1:-1,MathUtil.decimal.multiply(q-1,i))}else{n=MathUtil.decimal.multiply(j==1?1:-1,MathUtil.decimal.multiply(MathUtil.decimal.divide(q,100),i))}var m=MathUtil.decimal.multiply(j==1?-1:1,i);return{eventId:g,marketId:o,selectionId:l,selectionWinPL:n,selectionLossPL:m}};BookMakerExposureHandler.calculateExposure=function(g){if(!$j.isArray(g)){throw"betTickets must bet array type.[betTicketObj....]"}$j.each(g,function(h,i){f(i)})};function f(k){var i=k.selectionId;MarketExposureObj.betSelections[i]=MarketExposureObj.betSelections[i]||b(MarketExposureObj.betSelections[0]);var j=Object.keys(MarketExposureObj.betSelections).length-1;var h=j==MarketExposureObj.numberOfActiveRunners;var g=0;$j.each(MarketExposureObj.betSelections,function(n,l){var m=l.minExposure;if(i==n){m=MathUtil.decimal.add(m,k.selectionWinPL)}else{m=MathUtil.decimal.add(m,k.selectionLossPL)}l.minExposure=m;if(h&&n==0){return}g=c(g,m)});MarketExposureObj.marketExposure=g}function b(g){return JSON.parse(JSON.stringify(g))}function c(h,g){return h>g?g:h}function a(h,g){return h<g?g:h}function e(){var g=Object.keys(MarketExposureObj.betSelections);var h=0;$j.each(g,function(i,j){if(NotActiveSelectionIds.indexOf(parseInt(j))!=-1){h++}});if(h==0){return}MarketExposureObj.numberOfActiveRunners=MarketExposureObj.defaultActiveRunners+h}})();