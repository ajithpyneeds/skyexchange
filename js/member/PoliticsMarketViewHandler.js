if(typeof(PoliticsMarketViewHandler)=="undefined"){PoliticsMarketViewHandler={}}(function(){PoliticsMarketViewHandler.getMarketsTask=null;PoliticsMarketViewHandler.initTask=function(){if(!PoliticsMarketViewHandler.isEnableUsaPresidentialElection()){return}if(PoliticsMarketViewHandler.getMarketsTask==null){var b=TaskExecuterV2.createTask(PageConfig.getFullMarketsTaskCycleTime,0,function(){a(this)});PoliticsMarketViewHandler.getMarketsTask=b}else{PoliticsMarketViewHandler.getMarketsTask.isStop=false}PoliticsMarketViewHandler.getMarketsTask.run();TaskExecuterV2.execute()};PoliticsMarketViewHandler.abortTask=function(){if(PoliticsMarketViewHandler.getMarketsTask!=null){PoliticsMarketViewHandler.getMarketsTask.stop()}};PoliticsMarketViewHandler.isEnableUsaPresidentialElection=function(){return PageConfig.isEnableUsaPresidentialElection};function a(b){var c=DataBase.politicsMarkets.queryAll();$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.queryPoliticsMultiMarketsPath,data:{marketPks:JSON.stringify(c)},success:function(d){try{JsCache.get("#loading").hide();var g=d.multiMarkets;for(var f=0;f<g.length;f++){var j=g[f];var h=j.eventId;var l=j.market;if(l==null){continue}DataBase.markets.update(h,[l])}PoliticsMarketViewHandler.updateMultiMarketList(d)}catch(k){Trace.printStackTrace(k)}finally{b.check();TaskExecuterV2.execute()}},error:function(){b.check();TaskExecuterV2.execute()}})}PoliticsMarketViewHandler.updateMultiMarketList=function(b){var e=$j("#overWrap");var d=b.multiMarkets;e.find("#refreshButton").unbind("click").click(function(){JsCache.get("#loading").show();PoliticsMarketViewHandler.getMarketsTask.refresh()});for(var c=0;c<d.length;c++){var f=d[c];PoliticsMarketViewHandler.updateMultiMarket(e,f)}};PoliticsMarketViewHandler.updateMultiMarket=function(c,l){var d=l.eventType;var b=l.eventId;var m=l.marketId;var e=b+"_"+m.replace(".","_");var h=l.eventName;var f=l.market;var j=l.gameProductStatus;var i=(MarketUtil.isCloseSite(f.closeSite,PageConfig.webSiteType)||EventUtils.isCloseSite(l.eventCloseSite,PageConfig.webSiteType)||CompetitionUtils.isCloseSite(l.competitionCloseSite,PageConfig.webSiteType));var g=MarketUtil.isBookModeShow(f.bookMode,PageConfig.webSiteType)&&MarketUtil.isBookModeShow(l.eventBookMode,PageConfig.webSiteType);if(DataBase.politicsMarkets.getMarketPk(b,m)==null){return}var k=c.find("#multiMarket_"+e);if(k.length==0){if(MarketUtil.isClosed(f.status)||i||!g){return}k=c.find("#fullMarketBetsWrap").clone();k.attr("id","multiMarket_"+e);k.attr("eventType",d);k.attr("eventId",b);k.attr("marketId",m);BetHandler.addSelectClass();c.find("#politicsMultiMarketsHead").after(k.show())}else{if(MarketUtil.isClosed(f.status)||i||!g){k.hide();return}k.show()}k.find("#marketName").html(f.marketName);if(f.betLimitSetting!=null&&f.betLimitSetting.length!=0){k.find("#min").html(MathUtil.roundp(f.betLimitSetting.minBet,2));k.find("#max").html(MathUtil.roundp(f.betLimitSetting.maxBet,2))}FullMarketUtil.updateFullMarket(k,k.find("#fullMarketBoard"),d,b,m,f,j)}})();if(typeof(DataBase)=="undefined"){DataBase={}}(function(){DataBase.politicsMarkets={};var a=new HashMap();DataBase.politicsMarkets.addMarketPk=function(c,e,f){var b=DataBase.politicsMarkets.generateKey(e,f);var d={eventType:c,eventId:e,marketId:f,selectionTs:-1};a.put(b,d)};DataBase.politicsMarkets.getMarketPk=function(c,d){var b=DataBase.politicsMarkets.generateKey(c,d);return a.get(b)};DataBase.politicsMarkets.generateKey=function(b,c){return b+"_"+c.replace(".","_")};DataBase.politicsMarkets.queryAll=function(){return a.values()}})();