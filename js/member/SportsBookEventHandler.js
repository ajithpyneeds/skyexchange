if(typeof(SportsBookEventHandler)=="undefined"){SportsBookEventHandler={}}(function(){SportsBookEventHandler.queryTasks=[];SportsBookEventHandler.tab="All";var h=new HashMap();var t="/exchange/member/playerService/querySportsBookEvent";var p=false;SportsBookEventHandler.init=function(y,z){if(!AccountUtil.isEnableSportsBook(PageConfig.isAllowSportsbook,y)&&ApiSiteType.OW.value==y&&EventType.SOCCER.value==PageConfig.selectEventType){SportsBookEventHandler.initTask(y,true);return}if(!z){return}r();$j("#overWrap").find("#sportsBookNoBet").show();if(!FancyBetMarketHandler.isShowFancyBet()){SportsBookEventHandler.initTask(y,false)}$j("#showFancyBetBtn").on("click",function(){FullMarketUtil.view("fancyBet");FancyBetMarketHandler.initTask();if(SportsBookEventHandler.isShowSportsBook()){SportsBookEventHandler.abortTask(ApiSiteType.SPORTRADAR.unique())}if(SportsBookEventHandler.isShowOwSportsBook()){SportsBookEventHandler.abortTask(ApiSiteType.OW.unique())}});var x=$j("#sportsBookTab_"+y);x.show();x.find("[id^=tab_]").on("click",function(){var A=$j(this);var C=A.html();SportsBookEventHandler.tab=C;var B=PageConfig.sportsBookEventId;if(ApiSiteType.OW.unique()==y){B=PageConfig.owSportsBookEventId}k(y);d(y,B,null,true);SportsBookBetHandler.resetAllBetBoard();x.find("#moreDropList").hide()});x.find("#moreDropBtn").on("click",function(B){var A=x.find("#moreDropList");$j(document).on("click",function(){$j(document).off("click");A.hide()});if(A.is(":visible")){A.hide()}else{A.show()}B.stopPropagation()});var w=$j("#sportsBookWrap").find("#sportsBookHead");if(ApiSiteType.OW.unique()==y||ApiSiteType.SPORTRADAR.unique()==y){w.find("#sportsBookName").html("Premium "+EventType.getInstanceOf(PageConfig.selectEventType).desc)}w.find("#sportsBookRules").on("click",function(){var A=(EventType.TENNIS.value==PageConfig.selectEventType||EventType.SOCCER.value==PageConfig.selectEventType)?$j("[id^=sportsBookRulesWrap_"+y+"]"):$j("[id^=sportsBookRulesWrap_"+PageConfig.selectEventType+"]");if(ApiSiteType.OW.unique()==y){var B="Rules of Premium "+EventType.getInstanceOf(PageConfig.selectEventType).name;A.find("#owRulesTitle").html(B);if(EventType.TENNIS.value==PageConfig.selectEventType){A.find("#owSoccerRulesContent").hide();A.find("#owTennisRulesContent").show()}else{if(EventType.SOCCER.value==PageConfig.selectEventType){A.find("#owTennisRulesContent").hide();A.find("#owSoccerRulesContent").show()}}}A.fadeIn()});p=true};SportsBookEventHandler.activeSportsBook=function(){FullMarketUtil.view("sportsBookBet");if(SportsBookEventHandler.isShowSportsBook()){SportsBookEventHandler.initTask(ApiSiteType.SPORTRADAR.unique(),false)}if(SportsBookEventHandler.isShowOwSportsBook()){SportsBookEventHandler.initTask(ApiSiteType.OW.unique(),false)}FancyBetMarketHandler.abortTask()};SportsBookEventHandler.isEnableSportsBookBet=function(){return AccountUtil.isEnableSportsBook(PageConfig.isAllowSportsbook,ApiSiteType.SPORTRADAR.unique())};SportsBookEventHandler.isEnableOwSportsBookBet=function(){return AccountUtil.isEnableSportsBook(PageConfig.isAllowSportsbook,ApiSiteType.OW.unique())};SportsBookEventHandler.isShowSportsBook=function(){return SportsBookEventHandler.isEnableSportsBookBet()&&PageConfig.hasSportsBookMarkets};SportsBookEventHandler.isShowOwSportsBook=function(){return SportsBookEventHandler.isEnableOwSportsBookBet()&&PageConfig.hasOwSportsBookMarkets};SportsBookEventHandler.isViewMultiMarket=function(){return location.href.indexOf("multiMarkets")>-1};SportsBookEventHandler.initTask=function(y,z){if(SportsBookEventHandler.queryTasks[y]==null){var x=TaskExecuterV2.createTask(PageConfig.getSportsBookEventTaskCycleTime,0,function(){SportsBookEventHandler.querySportsBookEvent(this,y,z)});x.apiSiteType=y;SportsBookEventHandler.queryTasks[y]=x}else{SportsBookEventHandler.queryTasks[y].isStop=false}var w=0;if(z){w=1}SportsBookEventHandler.queryTasks[y].isInit=true;SportsBookEventHandler.queryTasks[y].version=w;SportsBookEventHandler.queryTasks[y].run();TaskExecuterV2.execute()};SportsBookEventHandler.abortTask=function(w){if(SportsBookEventHandler.queryTasks[w]!=null){SportsBookEventHandler.queryTasks[w].stop()}};SportsBookEventHandler.querySportsBookEvent=function(x,G,C){try{var A={eventId:PageConfig.selectEventId,apiSiteType:x.apiSiteType,version:x.version};if(!x.isInit){var B="";var E="";if(!C){var w=h.get(G);if(w!=null&&w.size()!=0){var y=w.keySet();for(var z=0;z<y.length;z++){var F=y[z].toString();B+=(F+",");var H=w.get(F);if(H==null){H=-1}E+=(H+",")}}}A.marketIds=B;A.selectionTsList=E}q(x,A,G)}catch(D){Trace.printStackTrace(D)}finally{x.check();TaskExecuterV2.execute()}};function q(x,y,w){var z=new Date();$j.ajax({type:"POST",dataType:"JSON",url:t,data:y,success:function(B){try{if(!B){return}if(x!=null){x.isInit=false;if(B.version>x.version){x.version=Math.max(B.version,x.version)}}var A=new Date();var D=A.getTime()-z.getTime();if(D>500){Trace.debug("UPDATE start:"+z.toString()+" end:"+A.toString()+" ms:"+D+" market num: "+(B.sportsBookMarket==null?0:B.sportsBookMarket.length))}SportsBookEventHandler.updateSportsBookEvent(w,B,y)}catch(C){Trace.printStackTrace(C)}},error:function(C,A,B){Trace.log(C.status);Trace.log(B)}})}function o(w,y){var x={eventId:PageConfig.selectEventId,apiSiteType:w,version:SportsBookEventHandler.queryTasks[w].version,marketIds:y+",",selectionTsList:"-1,",isDynamicUpdate:1};q(null,x,w)}function a(w,y){var x=h.get(w);if(x==null){x=new HashMap();h.put(w,x)}x.put(y,-1)}function e(x,A,w){if(w==null){return}var z=h.get(x);if(z==null){z=new HashMap();h.put(x,z)}var y=z.get(A);if(y==null||w<y){return}z.put(A,w)}function v(x,z,w){var y=h.get(x);if(y==null||y.get(z)==null){return}y.remove(z)}function k(w){var x=h.get(w);if(x==null){return}x.clear()}SportsBookEventHandler.updateSportsBookEvent=function(x,w,A){if(w==null){return}var z=w.eventId;f(x,w);if(!SportsBookEventHandler.isViewMultiMarket()&&w.score!=null&&!PageConfig.hasLiveMatchTracker&&!PageConfig.useBetfairScores){var B=JSON.parse(w.score);if(B!=null){MemberPage.view("marketLiveScore");if(ApiSiteType.SPORTRADAR.unique()==x){PageConfig.useSportradarScorecard=true;SportradarScorecardHandler.appendInfo(B,w)}else{if(ApiSiteType.OW.unique()==x){PageConfig.useSportsBookScorecard=true;OwScorecardHandler.appendInfo(B,w)}}UiUtils.appendHeight()}}var y=w.sportsBookMarket;if(y==null||y.length==0){return}DataBase.sportsBookMarkets.update(x,z,y);if(SportsBookEventHandler.isViewMultiMarket()){u(x,z,w,y,false)}else{d(x,z,w,false,A)}};function f(I,E){var C=$j("#sportsBookWrap");var w=E.eventUpdateDate;var K=E.producerUpdateDate;var O=E.mappingUpdateDate;var H=E.settingUpdateDate;var x=E.gameProductUpdateDate;if(C.prop("eventUpdateDate")==w&&C.prop("producerUpdateDate")==K&&C.prop("mappingUpdateDate")==O&&C.prop("settingUpdateDate")==H&&C.prop("gameProductUpdateDate")==x){return}C.prop("eventUpdateDate",w);C.prop("producerUpdateDate",K);C.prop("mappingUpdateDate",O);C.prop("settingUpdateDate",H);C.prop("gameProductUpdateDate",x);var z=C.find("#sportsBookHead");var F=E.eventId;var L=E.eventStatus;var D=E.producerStatus;var J=E.mappingStatus;var M=E.gameProductStatus;var N=EventUtils.isCloseSite(E.closeSite,PageConfig.webSiteType);var y=EventUtils.isBookModeShow(E.bookMode,PageConfig.webSiteType);if(SportsBookEventUtil.isLive(E.live)){z.find("h4").addClass("in-play")}else{z.find("h4").removeClass("in-play")}if(SportradarProducerUtil.isDown(D)||SportsBookEventUtil.isHideEvent(L)||N||J==0||GameProductUtils.isClose(M)||!y){C.hide();$j("#fancyBetHead").find("#showSportsBookBtn").hide();if(PageConfig.isEnableFancyBet){FullMarketUtil.view("fancyBet")}}else{if(SportsBookEventHandler.isShowSportsBook()||SportsBookEventHandler.isShowOwSportsBook()){r()}}if(SportsBookEventUtil.isSuspend(L)){var B=C.find("[id^=sportsBookSuspend_][isActive=1][eventId="+F+"]");if(B.length>0){B.show()}}else{var B=C.find("[id^=sportsBookSuspend_][isActive=1][status="+SportsBookMarketStatusType.OPEN.unique()+"][eventId="+F+"]");if(B.length>0){B.hide()}}var A=CurrencyType.getInstanceOf(PageConfig.playerCurrency);var G={precision:2,separateSign:",",currencySymbol:A.symbol,formatter:CurrencyUtil.DefaultFormatter,"trailingZeros,":false};z.show();z.find("#minMaxWrap_"+I).show();var P;if(ApiSiteType.SPORTRADAR.unique()==I){P=CurrencyUtil.formatter(E.min,G)}if(ApiSiteType.OW.unique()==I){P=CurrencyUtil.formatter(E.min,G)+"/"+CurrencyUtil.formatter(E.max,G)}z.find("#minMaxInfo_"+I).html(P);if(E.rebateRatio==null||E.rebateRatio==0){z.find("#rebateRatio_"+I).hide();z.find("#rebateName_"+I).hide()}else{z.find("#rebateRatio_"+I).html(MathUtil.decimal.multiply(E.rebateRatio,100)+"%");z.find("#rebateRatio_"+I).show();z.find("#rebateName_"+I).show()}}function d(y,A,w,z,B){if(w==null){$j("#sportsBookWrap").find("[id^=sportsBookMarket_]").addClass("close").hide()}var x=(B!=null&&B.version!=0)?w.sportsBookMarket:DataBase.sportsBookMarkets.queryMarkets(y,A);var C;if(ApiSiteType.SPORTRADAR.unique()==y){C=SportsBookMarketUtil.getFilterMarkets(SportsBookEventHandler.tab,x)}if(ApiSiteType.OW.unique()==y){C=SportsBookMarketUtil.getOwFilterMarkets(SportsBookEventHandler.tab,x)}u(y,A,w,C,z)}function u(Q,O,L,z,w){var W=$j("#overWrap");var H=W.find("#sportsBookWrap");var G=CurrencyType.getInstanceOf(PageConfig.playerCurrency);var P={precision:2,separateSign:",",currencySymbol:G.symbol,formatter:CurrencyUtil.DefaultFormatter,"trailingZeros,":false};if(b(z)){H.find("#sportsBookNoBet").hide()}else{H.find("#sportsBookNoBet").show()}var B=SportsBookEventHandler.isViewMultiMarket();var M=false;var x=true;var R=false;if(L!=null){M=EventUtils.isCloseSite(L.closeSite,PageConfig.webSiteType);x=EventUtils.isBookModeShow(L.bookMode,PageConfig.webSiteType);R=GameProductUtils.isClose(L.gameProductStatus)}for(var S in z){var E=z[S];var I=E.eventType;var y=E.id;var O=E.eventId;var A=E.marketStatus;var V=MarketUtil.isCloseSite(E.closeSite,PageConfig.webSiteType);var C=MarketUtil.isBookModeShow(E.bookMode,PageConfig.webSiteType);var K=E.isExpand;var U=E.betfairEventId;var T=DataBase.sportsBookMarkets.getEventMarketKey(Q,O,y);var D=E.apiSiteMarketType;if(B){var N=SportsBookMarketUtil.isHideMarket(A)||V||M||!x||!C||R;K=1;var F=l(H,T,E,L,N);H=F}var J=H.find("#sportsBookMarket_"+T);if(J.length==0){if(SportsBookMarketUtil.isHideMarket(A)||V||!C){v(Q,y);continue}J=s(H,Q,E);if(K==0){J.addClass("close")}else{a(Q,y)}}else{e(Q,y,E.selectionTs)}if(w&&K==1){J.removeClass("close")}MultiMarketsHandler.appendSportsBookPin(I,T,U,y,B,Q);n(H,J,Q,O,y,L,P,D)}if((p||w)&&ApiSiteType.SPORTRADAR.unique()==Q){SportsBookEventHandler.extandMarket(H)}p=false}SportsBookEventHandler.extandMarket=function(x){if(SportsBookEventHandler.isViewMultiMarket()){return}var w=x.find("[id^=sportsBookMarket_]:visible:lt("+PageConfig.sportsBookMarketExtendNumber+")");w.each(function(){var z=$j(this);z.removeClass("close");var B=z.prop("id");var A=B.substring(B.lastIndexOf("_")+1,B.length);var y=z.prop("apiSiteType");a(y,A)})};function s(y,x,z){var w=y.find("#sportsBookMarketTemplate").clone();w.prop("id","sportsBookMarket_"+DataBase.sportsBookMarkets.getEventMarketKey(x,z.eventId,z.id));w.prop("marketId",z.id);w.prop("eventId",z.eventId);w.prop("betfairEventId",z.betfairEventId);w.prop("marketName",z.marketName);w.prop("marketStatus",z.marketStatus);w.prop("apiSiteType",x);w.find("#marketName").html(z.marketName);if(z.marketType!=null){w.prop("sort",z.marketType.sort)}w.find("#marketName").on("click",function(B,A,C,D){return function(){if(B.hasClass("close")){a(A,D);o(A,D);B.removeClass("close")}else{v(A,D);B.addClass("close");SportsBookBetHandler.removeBoardByMarket(A,C,D);SportsBookEventHandler.removeSelectClassByMarket(A,C,D)}}}(w,x,z.eventId,z.id));y.find("#sportsBookNoBet").before(w);return w}function l(D,w,y,z,A){var C=D.find("#sportsBookTable_"+w);if(C.length==0){var x=z.eventType;var B=z.eventName;var E=z.highlightMarketId;C=D.find("#sportsBookTableTemplate").clone();C.attr("id","sportsBookTable_"+w);C.attr("name","multiMarketItem");C.find(".multi_name").unbind("click").click(function(){location.href=PageConfig.fullMarketPath+"?eventType="+x+"&eventId="+y.betfairEventId+"&marketId="+E});C.find("#multiMarketRefresh").unbind("click").click(function(){C.find("#multiMarketLoading").show();setTimeout(function(){C.find("#multiMarketLoading").hide()},500)});if(z.isElectronic==1){C.find("#sportsBookEIcon_"+x).show().css("display","inline-flex")}if(ApiSiteType.SPORTRADAR.unique()==z.apisite){C.find("#icon").text("Premium Cricket")}if(ApiSiteType.OW.unique()==z.apisite){C.find("#icon").text("Premium Tennis")}if(SportsBookEventUtil.isLive(z.live)){C.find("#icon").addClass("in-play")}else{C.find("#icon").removeClass("in-play")}C.find("#eventName").text(B);C.find("#marketName").text(y.marketName);D.append(C);C.show();D.show()}if(A){D.find(C).remove()}else{D.show()}return C}function n(E,G,I,w,H,z,J,D){var y=DataBase.sportsBookMarkets.get(I,w,H);if(y==null){Trace.log("SportsBook market "+H+" is null");return}var x=y.sportsBookSelection;var C=false;if(x!=null){x.sort(function(L,K){return SportsBookMarketUtil.sortSelections(L,K,I,D)});for(var B in x){var F=x[B];var A=G.find("#sportsBookSelection_"+SportsBookEventHandler.getSelectionKey(I,F));if(A.length==0){A=g(E,G,I,F);C=true}j(G,F,z,y,I)}}m(G,I,z,y,C)}function m(z,y,w,D,A){var x=D.marketStatus;var C=MarketUtil.isCloseSite(D.closeSite,PageConfig.webSiteType);var B=MarketUtil.isBookModeShow(D.bookMode,PageConfig.webSiteType);z.prop("updateDate",D.updateDate);if(SportsBookMarketUtil.isHideMarket(x)||C||!B){v(y,D.id);z.hide();SportsBookBetHandler.removeBoardByMarket(y,D.eventId,D.id);SportsBookEventHandler.removeSelectClass();return}else{if(!z.hasClass("close")){a(y,D.id)}z.show()}if(z.hasClass("close")){return}if(A||SportsBookMarketUtil.isSuspend(x)){SportsBookBetHandler.getExposure(y,D.eventId,D.id)}if(SportsBookMarketUtil.isSuspend(x)){SportsBookBetHandler.removeBoardByMarket(y,D.eventId,D.id);SportsBookEventHandler.removeSelectClass()}}SportsBookEventHandler.getSelectionKey=function(w,x){return w+"_"+x.eventId+"_"+x.marketId+"_"+x.id};function g(A,z,y,D){var C=A.find("#sportsBookTemplateTable");var B=DataBase.sportsBookMarkets.getEventMarketKey(y,D.eventId,D.marketId);var w=C.find("#sportsBookSelectionTemplate").clone();w.prop("id","sportsBookSelection_"+SportsBookEventHandler.getSelectionKey(y,D));w.prop("betfairEventId",D.betfairEventId);w.prop("eventType",D.eventType);w.prop("eventId",D.eventId);w.prop("marketId",D.marketId);w.prop("selectionName",D.selectionName);w.prop("handicap",D.handicap);w.prop("updateDate",D.updateDate);w.prop("apiSiteType",y);w.attr("marketPk",B);if(ApiSiteType.OW.unique()==y&&D.handicap!=0){w.find("#selectionName").html(D.selectionName+" <span>"+D.handicap+"</span>")}else{w.find("#selectionName").html(D.selectionName)}w.show();w.prop("style","");i(w,w.find("#back_1"),y,D);var x=C.find("#sportsBookSuspendTemplate").clone();x.prop("id","sportsBookSuspend_"+SportsBookEventHandler.getSelectionKey(y,D));x.attr("eventId",D.eventId);x.prop("marketId",D.marketId);x.prop("selectionId",D.id);z.find("tbody").append(x);z.find("tbody").append(w);return w}function j(F,C,x,w,G){var z=F.find("#sportsBookSelection_"+SportsBookEventHandler.getSelectionKey(G,C));var I=F.find("#sportsBookSuspend_"+SportsBookEventHandler.getSelectionKey(G,C));if(I.length==0||z.length==0){return}var A=w.marketStatus;var E=C.isActive;z.attr("isActive",E);z.attr("status",A);I.attr("isActive",E);I.attr("status",A);if(E==0||F.hasClass("close")){z.hide();I.hide();return}else{if(E==1){z.show()}}var D="Suspend";if(ApiSiteType.SPORTRADAR.unique()==G){D="Ball Run"}if((x!=null&&SportsBookEventUtil.isSuspend(x.eventStatus)||SportsBookMarketUtil.isSuspend(A))&&E==1){I.find("span").html(D);I.show()}else{if(SportsBookMarketUtil.isClosed(A)&&E==1){I.find("span").html("Closed");I.show()}else{I.hide()}}var H=C.odds;var B=C.handicap;if(ApiSiteType.OW.unique()==G&&B!=0){var y=C.selectionName;z.prop("handicap",C.handicap);z.find("#selectionName").html(C.selectionName+" <span>"+C.handicap+"</span>")}z.find("#info").prop("odds",H);z.find("#info").html(H==0?"":H);SparkHandler.addSparkClass(z.find("#back_1"),H)}function i(x,z,y,A){var w=function(B,G,C,E,F,H,D,I){return function(){var J=G.find("#info").prop("odds")||0;if(J==0){return}if(PageConfig.ENABLE_ONE_CLICK_BET=="true"&&OneClickBetHandler.isEnable()&&PageConfig.isOneClickBet==1){if(!PageConfig.ENABLE_ONE_CLICK_BET_ALL_PAGE){}else{if(!OneClickBetHandler.isEnableSubmitOneClickBet()){return}OneClickBetHandler.placeSportsBookBet(B,C,E,F,H,D,J);return}}c(G);SportsBookBetHandler.appendBoard(B,C,E,F,H,D,J)}}(x,z,y,A.eventType,A.eventId,A.marketId,A.id);z.on("click",w)}function c(w){SportsBookEventHandler.removeSelectClass();w.addClass("select")}function r(){$j("#fancyBetHead").find("#showSportsBookBtn").show();if(!FancyBetMarketHandler.isShowFancyBet()){FullMarketUtil.view("sportsBookBet");$j("#sportsBookWrap").find("#showFancyBetBtn").hide()}}SportsBookEventHandler.removeSelectClass=function(){var y=$j("#overWrap");var x=y.find("#sportsBookWrap");var w=x.find("[id^=sportsBookSelection_]");w.find("#back_1").removeClass("select")};SportsBookEventHandler.removeSelectClassByMarket=function(x,A,C){var B=$j("#overWrap");var w=B.find("#sportsBookWrap");var z=DataBase.sportsBookMarkets.getEventMarketKey(x,A,C);var y=w.find("[id^=sportsBookSelection_][marketPk="+z+"]");y.hide();y.find("#back_1").removeClass("select")};function b(x){var z=false;for(var y in x){var A=x[y];var w=A.marketStatus;if(SportsBookMarketUtil.isOpen(w)||SportsBookMarketUtil.isSuspend(w)){z=true;break}}return z}})();if(typeof(DataBase)=="undefined"){DataBase={}}(function(){DataBase.sportsBookMarkets={};var a=new HashMap();DataBase.sportsBookMarkets.update=function(c,f,b){var e=DataBase.sportsBookMarkets.getEventKey(c,f);var g=a.get(e);if(g==null){g=new HashMap();a.put(e,g)}for(var d=0;d<b.length;d++){var j=b[d];var h=g.get(j.id);if(h!=null){if(j.sportsBookSelection==null||j.sportsBookSelection.length==0){j.sportsBookSelection=h.sportsBookSelection}}g.put(j.id,j)}};DataBase.sportsBookMarkets.getEventKey=function(b,c){return b+"_"+c};DataBase.sportsBookMarkets.getEventMarketKey=function(b,c,d){return b+"_"+c+"_"+d};DataBase.sportsBookMarkets.queryAll=function(){return a.values()};DataBase.sportsBookMarkets.get=function(b,d,f){var c=DataBase.sportsBookMarkets.getEventKey(b,d);var e=a.get(c);if(e==null){return null}return e.get(f)};DataBase.sportsBookMarkets.queryMarkets=function(b,d){var c=DataBase.sportsBookMarkets.getEventKey(b,d);var e=a.get(c);if(e==null){e=new HashMap();a.put(c,e)}return e.values()};DataBase.sportsBookMarkets.getSelection=function(b,f,g,d){var h=DataBase.sportsBookMarkets.get(b,f,g);if(h==null){return null}var e=h.sportsBookSelection;if(e==null||e.length==0){return null}for(var c in e){if(e[c]!=null&&e[c].id==d){return e[c]}}return null}})();