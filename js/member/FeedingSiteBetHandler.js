if(typeof(FeedingSiteBetHandler)=="undefined"){FeedingSiteBetHandler={}}(function(){var j=5;FeedingSiteBetHandler.appendBoard=function(z,s,r,D,w,E){FeedingSiteBetHandler.clearBoard();var B=DataBase.feedingSiteBet.generateKey(r,D,w);var A=DataBase.feedingSiteMarkets.getSelection(r,D,w);if(A==null){return}var x=DataBase.feedingSiteBet.add(s,r,D,w,E,A.selectionName,GameType.getInstanceOf(A.gameType).displayName,A.betfairEventId);var C=false;var t=o(B,r,D,w,x);z.after(t.fadeIn());t.find("#odds").html(x.odds);if(PageConfig.userCoin!=null&&PageConfig.userCoin>0){var u=DataBase.feedingSiteMarkets.get(r,D);var y=parseFloat(PageConfig.userCoin);if(u.min&&parseFloat(u.min)>PageConfig.userCoin){y=parseFloat(u.min)}t.find("#inputStake").val(y);C=DataBase.feedingSiteBet.updateStake(r,D,w,y)}else{t.find("#inputStake").val("")}var v=p(t,D);FeedingSiteBetHandler.eventCalculate(t,r,D,w,C);t.find("#odds").select();FeedingSiteBetHandler.updateExposure();CoinHandler.showFeedingSiteBetCoin(t)};FeedingSiteBetHandler.clearBoard=function(){var s=$j("#feedingSiteWrap");var r=s.find("[id^=feedingSiteBetBoard_]");$j.each(r,function(u,w){w=s.find(w);if(w.length>0){var v=w.prop("eventId");var x=w.prop("marketId");var t=w.prop("selectionId");a(w,v,x,t)}});DataBase.feedingSiteBet.clear()};function a(t,s,u,r){t.hide()}function o(t,u,x,s,r){var v=$j("#overWrap");var w=v.find("#feedingSiteBetBoard_"+t);if(w.length==0){w=d(v,t,u,x,s,r)}return w}function d(s,y,r,z,u,v){var t=s.find("#feedingSiteTempTable").find("#feedingSiteBetTemplate").clone();var x=t.find("#feedingSiteBetHeader");var w=t.find("#oddsHeader");t.prop("id","feedingSiteBetBoard_"+y);t.prop("eventId",r);t.prop("marketId",z);t.prop("selectionId",u);x.find("#gameTypeName").before(" "+v.selectionName+" ");x.find("#gameTypeName").html(v.gameTypeName);w.find("#odds").html(v.odds);c(t,r,z,u,y);return t}function c(u,t,v,s,r){u.find("#placeBet").unbind("click").click(function(){if(typeof(LoginHandler)!="undefined"&&!LoginHandler.userIsLogin()){return}var w=p(u,v);e(u,t,v,s,r,w)});u.find("#cancel").unbind("click").click(function(){DataBase.feedingSiteBet.clear();a(u,t,v,s);FeedingSiteMarketHandler.removeSelectClass();FeedingSiteBetHandler.getExposure(t,v)});u.find("#inputStake").click(function(){u.find("#inputStake").select()});u.find("#inputStake").change(function(){var w=parseFloat(u.find("#inputStake").val())||0;var y=p(u,v);var x=DataBase.feedingSiteBet.updateStake(t,v,s,w);FeedingSiteBetHandler.eventCalculate(u,t,v,s,x)});u.find("#inputStake").blur(function(){CoinHandler.hideStakePopupList();var w=parseFloat(u.find("#inputStake").val())||0;var y=p(u,v);var x=DataBase.feedingSiteBet.updateStake(t,v,s,w);FeedingSiteBetHandler.eventCalculate(u,t,v,s,x)});u.find("#inputStake").keydown(function(x){var w=x.which;if(KeyEventUtils.isNumberKey(x)||KeyEventUtils.isBackspaceKey(w)||KeyEventUtils.isDeleteKey(w)||KeyEventUtils.isArrowKey(w)||KeyEventUtils.isTabKey(w)||KeyEventUtils.isEnterKey(w)){return}WindowEventUtil.stopEvent(x)});u.find("#inputStake").keyup(function(z){$j(this).val(function(B,C){return StringUtil.commaSeparateNumber(C)});var w=parseFloat(u.find("#inputStake").val())||0;var A=p(u,v);var x=DataBase.feedingSiteBet.updateStake(t,v,s,w);FeedingSiteBetHandler.eventCalculate(u,t,v,s,x);var y=z.which;if(KeyEventUtils.isEnterKey(y)){u.find("#placeBet").click()}if(KeyEventUtils.isTabKey(y)&&u.find("#inputStake").is(":focus")){u.find("#inputStake").select()}})}FeedingSiteBetHandler.eventCalculate=function(x,w,y,u,v){var r=DataBase.feedingSiteBet.get(w,y,u);var t=n(r);var s=x.find("#placeBet");if(!t){s.addClass("disable")}else{s.removeClass("disable")}FeedingSiteBetHandler.getExposure(w,y)};function n(t){if(t==null){return false}var v=DataBase.feedingSiteMarkets.get(t.eventId,t.marketId);if(v==null){return false}var u=v.min;var r=v.max;if(!u||!r){return false}var s=parseFloat(t.stake||"0");if(s<u||s>r){return false}return true}function e(t,r,E,z,D,y){var s=t.find("#inputStake");var u=parseFloat(s.val())||0;var A=DataBase.feedingSiteBet.get(r,E,z);var F="";var B=n(A);if(!B){var v=DataBase.feedingSiteMarkets.get(A.eventId,A.marketId);var w=v.min;var C=v.max;if(u<w){s.val(w);DataBase.feedingSiteBet.updateStake(r,E,z,w);F+=I18N.get("msg.member.minBet")}else{if(u>C){s.val(C);DataBase.feedingSiteBet.updateStake(r,E,z,C);F+=I18N.get("msg.member.maxBet")}}}if(F!=""&&!B){k(y,"warning",F,true)}FeedingSiteBetHandler.getExposure(r,E);if(!B){t.find("#placeBet").removeClass("disable");return}A=DataBase.feedingSiteBet.getForBet(r,E,z);var x=$j("#feedingSiteBetBar_"+D);if(x.length==0){x=m(D);t.after(x)}FeedingSiteBetHandler.submitBet(A,x,y);a(t,r,E,z)}FeedingSiteBetHandler.submitBet=function(r,t,w,v){var u=0;var s=0;$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.landingPath+"/member/playerService/feedingSiteBet",data:{feedingSiteBets:JSON.stringify([r]),isOneClickBet:v},beforeSend:function(){if(t!=null){t.show();h(t,j)}},complete:function(){},success:function(x){try{if(x.error){if(w!=null){k(w,"error",x.error,true)}else{NoticeHandler.error(x.error)}return}if(x.result.length==0){return}for(var y in x.result){var B=x.result[y];if(B.status=="SUCCESS"){if(u==0&&s==0){u=B.eventId;s=B.marketId}if(B.unMatchTicket!=null){DataBase.unMatchTicket.update([B.unMatchTicket])}if(B.txn!=null){DataBase.txn.update([B.txn]);if(w!=null){k(w,"success",null,true,"txn",B.txn)}}}else{if(B.error){if(w!=null){k(w,"error",B.error,true)}else{NoticeHandler.error(B.error)}}}}if(u!=0&&s!=""){TxnHandler.setEventIdAndMarketId(u,s,CategoryType.OW_SPORTSBOOK.unique());u=0;s=""}TxnHandler.updateOpenBetSelectionBox();TxnHandler.checkToHideOpenBets();var z=BetHandler.calculateTotalLiability();JsCache.get("#betSlipFullBtn").find("#total").html(CurrencyUtil.formatter(z))}catch(A){Trace.printStackTrace(A)}finally{if(t!=null){t.hide()}FeedingSiteMarketHandler.removeSelectClass();DataBase.feedingSiteBet.clear();FeedingSiteBetHandler.getExposure(r.eventId,r.marketId)}},error:function(x){Trace.printStackTrace(x);if(t!=null){t.hide()}}});JsCache.get("#confirmBetList").hide();JsCache.get("#confirmBetFullBtn").hide()};function m(s){var r=$j("#overWrap").find("#feedingSiteTempTable").find("#feedingSiteBetBarTemplate").clone();r.prop("id","feedingSiteBetBar_"+s);return r}function h(s,r){var u=MathUtil.decimal.multiply(r,10);var t=""+MathUtil.decimal.multiply(r,10);if(u>=0){b(u,t,s)}}function b(v,u,s){var r=s.find("#progressBar");var t=l(v,u);r.css("width",t);s.find("#secRemain").html(MathUtil.decimal.divide(v,10)+" sec remainingâ€¦");if(v>0){v--;setTimeout(function(){b(v,u,s)},100)}}function l(u,t){var v=MathUtil.decimal.subtract(t,u);var r=MathUtil.decimal.divide(v,t);if(r>1){r=1}var s=MathUtil.decimal.multiply(r,100);return Math.round(s)+"%"}function p(s,t){var r=$j("#overWrap");var u=r.find("#feedingSiteBetMessage_"+t);if(u.length==0){u=i(t)}s.after(u);return u}function i(r){var s=$j("#overWrap").find("#feedingSiteTempTable").find("#feedingSiteBetMessageTemplate").clone();s.prop("id","feedingSiteBetMessage_"+r);return s}function k(w,z,A,x,u,v){var r=w.find("#header");w.find("#info").contents().filter(function(){return this.nodeType==3}).remove();w.find("#classWrap").removeClass("success").removeClass("error").removeClass("warning").addClass(z);if(A!=null){r.html(A)}if(v!=null){var t=v.stake;var y=CurrencyType.getInstanceOf(PageConfig.playerCurrency);var s=y.name+y.symbol+t+" at odds "+v.odds;CurrencyUtil.updateSetting({currencySymbol:y.symbol});s+=" Profit: ";s+=UnMatchTicketUtil.getPL(v.odds,v.stake);r.html("Bet Matched");r.after(s)}w.find("#close").unbind("click").click(function(){w.fadeOut()});if(x){setTimeout(function(){w.fadeOut()},3000)}w.fadeIn()}FeedingSiteBetHandler.getExposure=function(r,z){try{var t=DataBase.feedingSiteMarkets.get(r,z);if(t==null){Trace.log("FeedingSite market "+z+" is null");return}var x=t.feedingSiteSelections;if(x==null){Trace.log("feedingSiteSelections "+z+" is null");return}var y=DataBase.feedingSiteBet.getByMarketId(r,z);var u=DataBase.unMatchTicket.getByMarketId(r,z,null,CategoryType.OW_SPORTSBOOK.unique());var v=DataBase.txn.getByMarketId(r,z+"",null,null,CategoryType.OW_SPORTSBOOK.unique());if(y.length==0&&u.length==0&&v.length==0){f(r,z);return}var s=ExposureUtil.calculateFeedingSiteBetExposure(r,z,t.numberOfWinner,t.numberOfActiveRunners,y,u,v);g(r,z,x,y,v,s);f(r,z)}catch(w){Trace.printStackTrace(w)}};function g(y,s,D,u,B,I){var x=$j("#feedingSiteWrap");var t=x.find("#feedingSiteMarket_"+s);if(t.length==0){return}var H=WebSiteType.getInstanceOf(PageConfig.webSiteType);var v=CurrencyType.getInstanceOf(PageConfig.playerCurrency);var A={precision:2,separateSign:",",currencySymbol:v.symbol,formatter:CurrencyUtil.DefaultFormatter,"trailingZeros,":false};if(H.isFancyFairGroup()){A.precision=0;A.roundingMode="DOWN"}for(var E in D){var K=D[E];var z=t.find("#feedingSiteSelection_"+FeedingSiteMarketHandler.getSelectionKey(K));if(z.length==0){continue}var C=z.find("#before");var F=z.find("#after");if(I.exposureBeforeBet){var G=I.exposureBeforeBet.betSelections;var r=0;if(G[K.id]==null){r=G[0].minExposure}else{r=G[K.id].minExposure}C.removeClass();if(parseFloat(r)>=0){C.addClass("win")}else{C.addClass("lose")}C.html(CurrencyUtil.formatter(r,A));C.show()}else{C.hide()}if(I.exposureAfterBet){var J=I.exposureAfterBet.betSelections;var w=0;if(J[K.id]==null){w=J[0].minExposure}else{w=J[K.id].minExposure}F.removeClass();if(parseFloat(w)>=0){F.addClass("to-win")}else{F.addClass("to-lose")}F.html(CurrencyUtil.formatter(w,A));F.show()}else{F.hide()}}}function f(u,w){var t=$j("#feedingSiteWrap");var v=t.find("#feedingSiteMarket_"+w);if(v.length==0){return}var r=v.find("[id^=feedingSiteSelection_]");var x=DataBase.feedingSiteBet.getByMarketId(u,w);var s=DataBase.txn.getByMarketId(u,w+"",null,null,CategoryType.OW_SPORTSBOOK.unique());if(x.length>0){r.find("#after").show()}else{r.find("#after").hide()}if(s.length>0){r.find("#before").show()}else{r.find("#before").hide()}}FeedingSiteBetHandler.updateExposure=function(){var t=$j("#feedingSiteWrap");if(t.length==0||!t.is(":visible")){return}var v=t.find("[id^=feedingSiteMarket_]:visible");if(v.length==0){return}for(var s in v){var r=t.find(v[s]);var u=r.prop("eventId");var w=r.prop("marketId");if(r.length==0||u==null||w==null){return}FeedingSiteBetHandler.getExposure(u,w)}};function q(r){r.contents().filter(function(){return this.nodeType==3}).remove()}})();if(typeof(DataBase)=="undefined"){DataBase={}}(function(){DataBase.feedingSiteBet={};var a=new HashMap();DataBase.feedingSiteBet.add=function(c,b,j,e,k,d,g,i){var f={eventType:c,eventId:b,marketId:j,selectionId:e,odds:k,selectionName:d,gameTypeName:g,betfairEventId:i};var h=DataBase.feedingSiteBet.generateKey(b,j,e);a.put(h,f);return f};DataBase.feedingSiteBet.generateKey=function(c,d,b){return c+"_"+d+"_"+b};DataBase.feedingSiteBet.get=function(d,e,c){var b=DataBase.feedingSiteBet.generateKey(d,e,c);return a.get(b)};DataBase.feedingSiteBet.remove=function(d,e,c){var b=DataBase.feedingSiteBet.generateKey(d,e,c);return a.remove(b)};DataBase.feedingSiteBet.queryAll=function(){return a.values()};DataBase.feedingSiteBet.clear=function(){a.clear()};DataBase.feedingSiteBet.updateStake=function(e,g,c,f){var d=false;var b=DataBase.feedingSiteBet.get(e,g,c);if(b==null){return}if(b.stake==null||(b.stake!=null&&b.stake!=f)){d=true}b.stake=f;return d};DataBase.feedingSiteBet.getForBet=function(d,e,c){var b=DataBase.feedingSiteBet.get(d,e,c);return{eventType:b.eventType,eventId:b.eventId,marketId:b.marketId,selectionId:b.selectionId,odds:b.odds,stake:b.stake,betfairEventId:b.betfairEventId,timestamp:new Date().getTime()}};DataBase.feedingSiteBet.getByMarketId=function(c,d){var b=[];$j.each(a.values(),function(f,e){if(c==e.eventId&&d==e.marketId){b.push(e)}});return b}})();