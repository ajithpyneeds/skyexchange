if(typeof(FeedingSiteMarketHandler)=="undefined"){FeedingSiteMarketHandler={}}(function(){FeedingSiteMarketHandler.queryTask=null;FeedingSiteMarketHandler.init=function(){if(!FeedingSiteMarketHandler.isEnableFeedingSiteBet()){return}var k=$j("#overWrap");k.find("#feedingSiteWrap").show();k.find("#feedingSiteHead").show();k.find("#feedingSiteNoBet").show();FeedingSiteMarketHandler.initTask()};FeedingSiteMarketHandler.isEnableFeedingSiteBet=function(){return PageConfig.isEnableFeedingSiteBet};FeedingSiteMarketHandler.initTask=function(){if(FeedingSiteMarketHandler.queryTask==null){var k=TaskExecuter.createTask(PageConfig.getFeedingSiteMarketsTaskCycleTime,0,function(){FeedingSiteMarketHandler.queryFeedingSiteMarkets(this)});k.version=0;FeedingSiteMarketHandler.queryTask=k}else{FeedingSiteMarketHandler.queryTask.isStop=false}FeedingSiteMarketHandler.queryTask.run();TaskExecuter.execute()};FeedingSiteMarketHandler.abortTask=function(){if(FeedingSiteMarketHandler.queryTask!=null){FeedingSiteMarketHandler.queryTask.stop()}};FeedingSiteMarketHandler.queryFeedingSiteMarkets=function(k){$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.landingPath+"/member/playerService/queryFeedingSiteMarkets",data:{eventId:PageConfig.selectEventId,version:k.version},success:function(l){try{if(!l){return}if(l.version>k.version){k.version=Math.max(l.version,k.version)}d(l)}catch(m){Trace.printStackTrace(m)}finally{k.check();TaskExecuter.execute()}},error:function(n,l,m){Trace.log(n.status);Trace.log(m)}})};function d(n){if(!n.feedingSiteMarkets||n.feedingSiteMarkets.length==0){return}DataBase.feedingSiteMarkets.update(n.feedingSiteMarkets);var r=n.feedingSiteMarkets;var k=$j("#overWrap");var t=k.find("#feedingSiteWrap");var p=k.find("#feedingSiteTempTable");var s=CurrencyType.getInstanceOf(PageConfig.playerCurrency);var u={precision:2,separateSign:",",currencySymbol:s.symbol,formatter:CurrencyUtil.DefaultFormatter,"trailingZeros,":false};t.show();if(a(r)){t.find("#feedingSiteNoBet").hide()}else{t.find("#feedingSiteNoBet").show()}for(var q in r){var m=r[q];var o=m.status;var l=t.find("#feedingSiteMarket_"+m.id);if(l.length==0){if(FeedingSiteMarketUtil.isClosed(o)){continue}l=f(t,m)}j(t,p,l,m,u)}}function f(l,m){var k=l.find("#feedingSiteMarketTemplate").clone();k.prop("id","feedingSiteMarket_"+m.id);k.prop("eventType",m.eventType);k.prop("betfairEventId",m.betfairEventId);k.prop("eventId",m.eventId);k.prop("marketId",m.id);k.prop("feedingEventName",m.feedingEventName);k.prop("feedingMarketName",m.feedingMarketName);k.prop("status",m.status);k.prop("isLive",m.isLive);k.prop("updateDate",m.updateDate);k.find("#marketName").html(m.feedingMarketName);l.append(k);return k}function j(q,n,k,l,t){var m=q.find("#feedingSiteHead");var r=l.feedingSiteSelections;m.show();m.find("#minMaxWrap").show();r.sort(function(v,u){return FeedingSiteMarketUtil.sortSelections(v.sortPriority,u.sortPriority)});m.find("#minMaxInfo").html(CurrencyUtil.formatter(l.min,t)+" / "+CurrencyUtil.formatter(l.max,t));if(l.rebateRatio==null||l.rebateRatio==0){m.find("#rebateRatio").hide();m.find("#rebateName").hide()}else{m.find("#rebateRatio").html(MathUtil.decimal.multiply(l.rebateRatio,100)+"%");m.find("#rebateRatio").show();m.find("#rebateName").show()}for(var p in r){var s=r[p];var o=k.find("#feedingSiteSelection_"+FeedingSiteMarketHandler.getSelectionKey(s));if(o.length==0){o=e(n,k,s)}c(k,s,l)}h(k,l)}function b(k,l){FeedingSiteBetHandler.getExposure(k,l);FeedingSiteMarketHandler.removeSelectClass()}function h(l,n){var k=n.status;var m=MarketUtil.isCloseSite(n.closeSite,PageConfig.webSiteType);if(FeedingSiteMarketUtil.isInternal(k)||FeedingSiteMarketUtil.isClosed(k)||m){l.hide();return}else{l.show()}if(FeedingSiteMarketUtil.isSuspend(k)||FeedingSiteMarketUtil.isClosePrice(k)){b(n.eventId,n.id)}}FeedingSiteMarketHandler.getSelectionKey=function(k){return k.eventId+"_"+k.marketId+"_"+k.id};function e(o,m,n){var k=o.find("#feedingSiteSelectionTemplate").clone();k.prop("id","feedingSiteSelection_"+FeedingSiteMarketHandler.getSelectionKey(n));k.prop("betfairEventId",n.betfairEventId);k.prop("eventType",n.eventType);k.prop("eventId",n.eventId);k.prop("marketId",n.marketId);k.prop("selectionName",n.selectionName);k.prop("gameType",n.gameType);k.prop("handicap",n.handicap);k.prop("updateDate",n.updateDate);k.find("#selectionName").html(n.selectionName);k.show();i(k,k.find("#back_1"),n);var l=o.find("#feedingSiteSuspendTemplate").clone();l.prop("id","feedingSiteSuspend_"+FeedingSiteMarketHandler.getSelectionKey(n));l.prop("eventId",n.eventId);l.prop("marketId",n.marketId);l.prop("selectionId",n.id);m.find("tbody").append(l);m.find("tbody").append(k);return k}function c(n,o,p){var k=n.find("#feedingSiteSelection_"+FeedingSiteMarketHandler.getSelectionKey(o));var m=n.find("#feedingSiteSuspend_"+FeedingSiteMarketHandler.getSelectionKey(o));var l=p.status;if(m.length==0){return}if(FeedingSiteMarketUtil.isInternal(l)){m.find("span").html("Internal");m.show()}else{if(FeedingSiteMarketUtil.isSuspend(l)){m.find("span").html("Suspend");m.show()}else{if(FeedingSiteMarketUtil.isClosePrice(l)){m.find("span").html("Close Price");m.show()}else{if(FeedingSiteMarketUtil.isClosed(l)){m.find("span").html("Closed");m.show()}else{m.hide()}}}}if(k.length==0){return}k.find("#info").prop("odds",o.exOdds);k.find("#info").html(o.exOdds==0?"":o.exOdds);SparkHandler.addSparkClass(k.find("#back_1"),o.exOdds)}function i(l,m,n){var k=function(o,s,q,r,t,p,u){return function(){var v=s.find("#info").prop("odds")||0;if(v==0){return}if(PageConfig.ENABLE_ONE_CLICK_BET=="true"&&OneClickBetHandler.isEnable()&&PageConfig.isOneClickBet==1){if(!PageConfig.ENABLE_ONE_CLICK_BET_ALL_PAGE){}else{if(!OneClickBetHandler.isEnableSubmitOneClickBet()){return}OneClickBetHandler.placeFeedingSiteBet(o,q,r,t,p,v);return}}g(s);FeedingSiteBetHandler.appendBoard(o,q,r,t,p,v)}}(l,m,n.eventType,n.eventId,n.marketId,n.id);m.on("click",k)}function g(k){FeedingSiteMarketHandler.removeSelectClass();k.addClass("select")}FeedingSiteMarketHandler.removeSelectClass=function(){var m=$j("#overWrap");var l=m.find("#feedingSiteWrap");var k=l.find("[id^=feedingSiteSelection_]");k.find("#back_1").removeClass("select")};function a(l){var n=false;for(var m in l){var o=l[m];var k=o.status;if(FeedingSiteMarketUtil.isRunning(k)||FeedingSiteMarketUtil.isSuspend(k)||FeedingSiteMarketUtil.isClosePrice(k)){n=true;break}}return n}})();if(typeof(DataBase)=="undefined"){DataBase={}}(function(){DataBase.feedingSiteMarkets={};var a=new TreeMap();DataBase.feedingSiteMarkets.update=function(b){for(var c=0;c<b.length;c++){var f=b[c];var d=f.eventId;var e=a.get(d);if(e==null){e=new TreeMap();a.put(d,e)}e.put(f.id,f)}};DataBase.feedingSiteMarkets.get=function(b,d){var c=a.get(b);if(c==null){return null}return c.get(d)};DataBase.feedingSiteMarkets.queryByEvent=function(b){var c=a.get(b);if(c==null){c=new TreeMap();a.put(b,c)}return c.values()};DataBase.feedingSiteMarkets.getSelection=function(e,f,c){var g=DataBase.feedingSiteMarkets.get(e,f);if(g==null){return null}var d=g.feedingSiteSelections;if(d==null||d.length==0){return null}for(var b in d){if(d[b]!=null&&d[b].id==c){return d[b]}}return null};DataBase.feedingSiteMarkets.queryAll=function(){return a.values()}})();