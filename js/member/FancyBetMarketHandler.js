if(typeof(FancyBetMarketHandler)=="undefined"){FancyBetMarketHandler={}}(function(){FancyBetMarketHandler.queryTask=null;FancyBetMarketHandler.init=function(){if(!FancyBetMarketHandler.isEnableFancyBet()){return}FancyBetMarketHandler.initTask()};FancyBetMarketHandler.isEnableFancyBet=function(){return PageConfig.isEnableFancyBet};FancyBetMarketHandler.isShowFancyBet=function(){return FancyBetMarketHandler.isEnableFancyBet()&&PageConfig.hasFancyBetMarkets};FancyBetMarketHandler.isViewMultiMarket=function(){return location.href.indexOf("multiMarkets")>-1};FancyBetMarketHandler.initTask=function(){if(FancyBetMarketHandler.queryTask==null){var m=TaskExecuter.createTask(PageConfig.getFancyBetMarketsTaskCycleTime,0,function(){FancyBetMarketHandler.queryFancyBetMarkets(this)});m.version=0;m.oddsSettingVersion=0;FancyBetMarketHandler.queryTask=m}else{FancyBetMarketHandler.queryTask.isStop=false}FancyBetMarketHandler.queryTask.run();TaskExecuter.execute()};FancyBetMarketHandler.abortTask=function(){if(FancyBetMarketHandler.queryTask!=null){FancyBetMarketHandler.queryTask.stop()}};FancyBetMarketHandler.queryFancyBetMarkets=function(m){$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.landingPath+"/member/playerService/queryFancyBetMarkets",data:{eventId:PageConfig.selectEventId,version:m.version,oddsSettingVersion:m.oddsSettingVersion},success:function(n){try{if(!n){return}if(n.version>m.version){m.version=Math.max(n.version,m.version)}if(n.oddsSettingVersion>m.oddsSettingVersion){m.oddsSettingVersion=Math.max(n.oddsSettingVersion,m.oddsSettingVersion)}FancyBetMarketHandler.updateFancyBetMarkets(n)}catch(o){Trace.printStackTrace(o)}finally{m.check();TaskExecuter.execute()}},error:function(p,n,o){Trace.log(p.status);Trace.log(o)}})};FancyBetMarketHandler.getFancyBetTable=function(n,m,r,q){var o=(r&&q);var p=o?n.find("#bookMakerTable_"+m):n.find("#fancyBetTable_"+m);if(p.length==0){p=o?n.find("#bookMakerTableTemplate").clone():n.find("#fancyBetTableTemplate").clone();if(o){p.prop("id","bookMakerTable_"+m)}else{p.prop("id","fancyBetTable_"+m)}if(q){n.find("#header").after(p)}else{n.find("#fancyBetPosition").after(p);FullMarketUtil.view("fancyBet")}}p.attr("name","multiMarketItem");return p};FancyBetMarketHandler.updateFancyBetMarkets=function(r){if(!r.fancyBetMarkets||r.fancyBetMarkets.length==0){return}var o=r.fancyBetMarkets[0].eventType;var m=r.eventId;var y=r.highlightMarketId;var p=r.fancyBetMarkets;DataBase.fancyBetMarkets.update(m,r.fancyBetMarkets);var n=$j("#overWrap");var v=FancyBetMarketHandler.getFancyBetTable(n,m,false,FancyBetMarketHandler.isViewMultiMarket());var z=v.find("#fancyBetHead");var x=v.find("#fancyBetMarketList");MultiMarketsHandler.appendFancyBetPin(o,m,FancyBetMarketHandler.isViewMultiMarket());if(FancyBetMarketHandler.isViewMultiMarket()){v.find(".multi_name").unbind("click").click(function(){location.href=PageConfig.fullMarketPath+"?eventType="+o+"&eventId="+m+"&marketId="+y});v.find("#multiMarketRefresh").unbind("click").click(function(){v.find("#multiMarketLoading").show();setTimeout(function(){v.find("#multiMarketLoading").hide()},500)});z.find("#eventName").text(r.fancyBetMarkets[0].eventName);v.show()}var w=CurrencyType.getInstanceOf(PageConfig.playerCurrency);var B={precision:2,separateSign:",",currencySymbol:w.symbol,formatter:CurrencyUtil.DefaultFormatter,"trailingZeros,":false};if(EventType.ELECTION.unique()==o){z.find("#headerName").html("Election Fancy Bet")}if(a(DataBase.fancyBetMarkets.queryByEvent(m))){x.show();if(FancyBetMarketHandler.isViewMultiMarket()){z.find(".game-fancy").addClass("in-play")}}else{if(FancyBetMarketHandler.isViewMultiMarket()){v.hide()}x.hide()}p.sort(function(D,C){return FancyBetMarketUtil.sortMarkets(D.sort,C.sort,D.marketType,C.marketType)});for(var u in p){var t=p[u];var A=t.marketId;var s=t.status;if(FancyBetMarketUtil.isOffline(s)){continue}var q=x.find("#fancyBetMarket_"+A);if(q.length==0){if(FancyBetMarketUtil.isClosed(s)){continue}q=b(x,t)}h(x,q,t,m,B)}FancyBetMarketUtil.checkForAllClose(m);i(x)};function b(o,n){var m=o.find("#fancyBetMarketTemplate").clone();var q=o.find("#suspendTemplate").clone();m.prop("id","fancyBetMarket_"+n.marketId);m.prop("eventId",n.eventId);m.prop("marketId",n.marketId);m.prop("marketType",n.marketType);m.prop("status",n.status);m.prop("summaryStatus",n.summaryStatus);m.prop("updateDate",n.updateDate);m.prop("marketName",n.marketName);m.prop("sort",n.sort);m.find("#marketName").html(n.marketName);if(n.remarkFirstRow!=null&&n.remarkFirstRow.length>0){m.find("#remarkFirstRow").show();m.find("#remarkFirstRow").html(n.remarkFirstRow)}if(n.remarkSecondRow!=null&&n.remarkSecondRow.length>0){m.find("#remarkSecondRow").show();m.find("#remarkSecondRow").html(n.remarkSecondRow)}j(m,m.find("#lay_1"),n,FancySideType.NO.unique());j(m,m.find("#back_1"),n,FancySideType.YES.unique());k(m,n.eventId,n.marketId);q.prop("id","suspend_"+n.marketId);o.append(q);o.append(m);var p=DataBase.txn.getByMarketId(n.eventId,n.marketId+"",null,null,CategoryType.FANCY_BET.unique());if(p.length>0){m.find("#fancyBetBookBtn").show();FancyBetHandler.getExposure(n.eventId,n.marketId)}return m}function h(o,n,m,r,q){n.prop("sort",m.sort);var p=n.find("#lay_1");var s=n.find("#back_1");e(p.find("#runsInfo"));e(s.find("#runsInfo"));f(p,m.runsNo,m.oddsNo);f(s,m.runsYes,m.oddsYes);n.find("#minMax").html(CurrencyUtil.formatter(m.min,q)+" / "+CurrencyUtil.formatter(m.max,q));if(m.rebateRatio==0){n.find("#rebateName").hide();n.find("#rebate").hide()}else{n.find("#rebateName").show();n.find("#rebate").show();n.find("#rebate").html(MathUtil.decimal.multiply(m.rebateRatio,100)+"%")}c(o,n,m,r);d(n,m)}function e(m){m.contents().filter(function(){return this.nodeType==3}).remove()}function f(n,p,m){var o=n.find("#runsInfo");o.find("span").before(p==0?"":p);o.find("span").html(m==0?"":m);o.prop("runs",p);o.prop("odds",m);SparkHandler.addFancyBetSpark(n,p,m)}function c(p,n,m,r){var o=m.status;var q=p.find("#suspend_"+m.marketId);n.prop("status",o);if(FancyBetMarketUtil.isOnline(o)&&!FancyBetMarketUtil.isClosed(o)){n.show();n.prop("timeout",false)}q.find("#suspendClass").removeClass("fancy-suspend").removeClass("fancy-suspend-white");if(FancyBetMarketUtil.isSuspend(o)){q.find("#suspendClass").addClass("fancy-suspend");q.find("#info").html("Suspend");q.fadeIn();l(m.eventId,m.marketId)}else{if(FancyBetMarketUtil.isBallRun(o)){q.find("#suspendClass").addClass("fancy-suspend");q.find("#info").html("Ball Running");q.fadeIn();l(m.eventId,m.marketId)}else{if(FancyBetMarketUtil.isClosed(o)){q.find("#suspendClass").addClass("fancy-suspend-white");q.find("#info").html("Closed");q.fadeIn();l(m.eventId,m.marketId);n.hide();q.hide();n.prop("timeout",true)}else{q.hide()}}}}function l(m,n){FancyBetHandler.hideBetBoardByMarket(m,n);FancyBetHandler.getExposure(m,n);FancyBetMarketHandler.removeSelectClass(m)}FancyBetMarketHandler.getDelayBettingElem=function(q,t){var r=$j("#overWrap");var s=r.find("#fancyBetTable_"+q);var n=s.find("#fancyBetMarketList");var m=n.find("#fancyBetMarket_"+t);if(m.length==0||!m.is(":visible")){return null}var o=n.find("#suspend_"+t);if(o.length==0||o.is(":visible")){return null}var p=n.find("#delayBetting_"+t);if(p.length==0){p=n.find("#delayTemplate").clone();p.prop("id","delayBetting_"+t);m.before(p)}return p};FancyBetMarketHandler.showDelayBetting=function(n,p){var q=DataBase.fancyBetMarkets.get(n,p);var o=q.delayBetting?parseInt(q.delayBetting)*1000:0;if(o==0){return}var m=FancyBetMarketHandler.getDelayBettingElem(n,p);if(m==null||m.length==0){return}m.find("#info").html("");m.fadeIn();setTimeout(function(){m.find("#info").html("");m.fadeOut()},o)};FancyBetMarketHandler.hideDelayBetting=function(n,o){var m=FancyBetMarketHandler.getDelayBettingElem(n,o);if(m==null||m.length==0){return}m.find("#info").html("");m.hide()};function j(o,p,n,q){var m=function(r,w,u,v,x,t,s,y){return function(){var A=w.find("#runsInfo").prop("runs")||0;var z=w.find("#runsInfo").prop("odds")||0;if(A==0||z==0){return}if(PageConfig.ENABLE_ONE_CLICK_BET=="true"&&OneClickBetHandler.isEnable()&&PageConfig.isOneClickBet==1){if(!PageConfig.ENABLE_ONE_CLICK_BET_ALL_PAGE){}else{if(!OneClickBetHandler.isEnableSubmitOneClickBet()){return}OneClickBetHandler.placeFancyBet(r,u,v,x,t,A,z);return}}g(w,v);FancyBetHandler.appendBoard(r,u,v,x,t,A,z,s,y)}}(o,p,n.eventType,n.eventId,n.marketId,q,n.eventName,n.marketName);p.on("click",m)}function k(m,n,o){m.find("#fancyBetBookBtn").off("click").on("click",function(){window.open("/exchange/member/market/fancyBetBook.jsp?eventId="+n+"&marketId="+o,"_blank","resizable=no,width=600,height=650")})}FancyBetMarketHandler.showFancyBetBookBtn=function(p,s){if(!p||!s){return}var q=$j("#overWrap");var r=q.find("#fancyBetTable_"+p);var m=r.find("#fancyBetMarketList");var o=m.find("#fancyBetMarket_"+s+":visible");if(o.length==0){return}var n=DataBase.txn.getByMarketId(p,s,null,null,CategoryType.FANCY_BET.unique());if(n.length==0){o.find("#fancyBetBookBtn").hide();return}o.find("#fancyBetBookBtn").show()};function g(n,m){FancyBetMarketHandler.removeSelectClass(m);n.addClass("select")}FancyBetMarketHandler.removeSelectClass=function(n){var o=$j("#overWrap");var p=o.find("#fancyBetTable_"+n);var m=p.find("[id^=fancyBetMarket_]");m.find("#lay_1").removeClass("select");m.find("#back_1").removeClass("select")};function a(m){var o=false;for(var n in m){var p=m[n];if(FancyBetMarketUtil.isOnline(p.status)&&!FancyBetMarketUtil.isClosed(p.status)){o=true;break}}return o}function i(o){var q=o.find("[id^=fancyBetMarket_]:visible");if(q.length<2){return}var m=false;for(var r=0;r<q.length;r++){if(r+1>=q.length){break}var p=o.find(q[r]);var n=o.find(q[r+1]);if(p.length==0||p.prop("id").indexOf("fancyBetMarket_")<0||n.length==0||n.prop("id").indexOf("fancyBetMarket_")<0){continue}if(p.prop("marketType")==n.prop("marketType")&&p.prop("sort")>n.prop("sort")){m=true;break}}if(!m){return}var s=q.sort(function(u,t){var w=o.find(u);var v=o.find(t);return FancyBetMarketUtil.sortMarkets(w.prop("sort"),v.prop("sort"),w.prop("marketType"),v.prop("marketType"))});o.append(s);$j.each(s,function(x,v){v=o.find(v);var w=v.prop("marketId");var u=o.find("#suspend_"+w);if(u.length>0){o.find("#fancyBetMarket_"+w).before(u)}var t=o.find("[id^=fancyBetBoard_"+v.prop("eventId")+"_"+v.prop("marketId")+"_]");if(t.length>0){o.find("#fancyBetMarket_"+w).after(t)}})}function d(n,m){if(m.remarkFirstRow!=null&&m.remarkFirstRow.length>0){n.find("#remarkFirstRow").show();n.find("#remarkFirstRow").html(m.remarkFirstRow)}else{n.find("#remarkFirstRow").hide();n.find("#remarkFirstRow").html("")}if(m.remarkSecondRow!=null&&m.remarkSecondRow.length>0){n.find("#remarkSecondRow").show();n.find("#remarkSecondRow").html(m.remarkSecondRow)}else{n.find("#remarkSecondRow").hide();n.find("#remarkSecondRow").html("")}}})();if(typeof(DataBase)=="undefined"){DataBase={}}(function(){DataBase.fancyBetMarkets={};var a=new TreeMap();DataBase.fancyBetMarkets.update=function(d,b){var e=a.get(d);if(e==null){e=new TreeMap();a.put(d,e)}for(var c=0;c<b.length;c++){var f=b[c];e.put(f.marketId,f)}};DataBase.fancyBetMarkets.get=function(b,d){var c=a.get(b);if(c==null){return null}return c.get(d)};DataBase.fancyBetMarkets.queryByEvent=function(b){var c=a.get(b);if(c==null){c=new TreeMap();a.put(b,c)}return c.values()}})();