if(typeof(FancyBetHandler)=="undefined"){FancyBetHandler={}}(function(){var k=5;FancyBetHandler.appendBoard=function(x,r,q,E,v,w,F,z,A){FancyBetHandler.clearBoard(q);var C=DataBase.fancyBet.generateKey(q,E,v);var y=DataBase.fancyBet.add(r,q,E,v,w,F,z,A);var D=false;var t=m(C,q,E,v,y);x.after(t.fadeIn());t.find("#runs").html(y.runs);t.find("#odds").html(y.odds);if(PageConfig.userCoin!=null&&PageConfig.userCoin>0){var u=DataBase.fancyBetMarkets.get(q,E);var B=parseFloat(PageConfig.userCoin);if(u.min&&parseFloat(u.min)>PageConfig.userCoin){B=parseFloat(u.min)}t.find("#inputStake").val(B);D=DataBase.fancyBet.updateStake(q,E,v,B)}else{t.find("#inputStake").val("")}var s=p(t,E);FancyBetHandler.eventCalculate(t,q,E,v,D);t.find("#odds").select();FancyBetHandler.updateExposure(q);CoinHandler.showFancyBetCoin(t)};FancyBetHandler.clearBoard=function(r){var s=$j("#fancyBetTable_"+r);var q=s.find("[id^=fancyBetBoard_]");$j.each(q,function(t,w){w=s.find(w);if(w.length>0){var v=w.prop("eventId");var x=w.prop("marketId");var u=w.prop("sideType");b(w,v,x,u)}});DataBase.fancyBet.clearByEventId(r)};FancyBetHandler.hideBetBoardByMarket=function(t,v){var u=$j("#fancyBetTable_"+t);for(var s in FancySideType){if(!FancySideType[s]||!FancySideType[s].value){continue}var r=DataBase.fancyBet.generateKey(t,v,FancySideType[s].unique());var q=u.find("#fancyBetBoard_"+r);if(q.length==0){continue}q.hide();DataBase.fancyBet.remove(t,v,FancySideType[s].unique())}};function b(s,r,t,q){s.hide()}function m(r,t,w,s,q){var u=$j("#overWrap");var v=u.find("#fancyBetBoard_"+r);if(v.length==0){v=i(u,r,t,w,s,q)}v.find("#fancyBetAcceptAnyOdds").prop("checked",TopMenuHandler.isAcceptAnyOdds("fancyBet"));return v}function i(r,y,q,z,t,v){var s=r.find("#fancyBetTemplate").clone();var x=s.find("#fancyBetHeader");var w=s.find("#oddsHeader");var u=FancySideType.YES.unique()==t?SideType.Back.name:SideType.Lay.name;s.find("#classWrap").removeClass("slip-back").removeClass("slip-lay").addClass("slip-"+u.toLowerCase());s.prop("id","fancyBetBoard_"+y);s.prop("eventId",q);s.prop("marketId",z);s.prop("sideType",t);x.find("#acceptCheck").before(StringUtil.ucfirst(FancySideType.getInstanceOf(t).name));w.find("#runs").html(v.runs);w.find("#odds").html(v.odds);d(s,q,z,t,y);return s}function d(t,s,u,r,q){t.find("#placeBet").unbind("click").click(function(){if(typeof(LoginHandler)!="undefined"&&!LoginHandler.userIsLogin()){return}var v=p(t,u);e(t,s,u,r,q,v)});t.find("#cancel").unbind("click").click(function(){DataBase.fancyBet.clearByEventId(s);b(t,s,u,r);FancyBetMarketHandler.removeSelectClass(s);FancyBetHandler.getExposure(s,u)});t.find("#inputStake").click(function(){t.find("#inputStake").select()});t.find("#inputStake").change(function(){var v=parseFloat(t.find("#inputStake").val())||0;var x=p(t,u);var w=DataBase.fancyBet.updateStake(s,u,r,v);FancyBetHandler.eventCalculate(t,s,u,r,w)});t.find("#inputStake").blur(function(){CoinHandler.hideStakePopupList();var v=parseFloat(t.find("#inputStake").val())||0;var x=p(t,u);var w=DataBase.fancyBet.updateStake(s,u,r,v);FancyBetHandler.eventCalculate(t,s,u,r,w)});t.find("#inputStake").keydown(function(w){var v=w.which;if(KeyEventUtils.isNumberKey(w)||KeyEventUtils.isBackspaceKey(v)||KeyEventUtils.isDeleteKey(v)||KeyEventUtils.isArrowKey(v)||KeyEventUtils.isTabKey(v)||KeyEventUtils.isEnterKey(v)){return}WindowEventUtil.stopEvent(w)});t.find("#inputStake").keyup(function(z){$j(this).val(function(A,B){return StringUtil.commaSeparateNumber(B)});var v=parseFloat(t.find("#inputStake").val())||0;var x=p(t,u);var w=DataBase.fancyBet.updateStake(s,u,r,v);FancyBetHandler.eventCalculate(t,s,u,r,w);var y=z.which;if(KeyEventUtils.isEnterKey(y)){t.find("#placeBet").click()}if(KeyEventUtils.isTabKey(y)&&t.find("#inputStake").is(":focus")){t.find("#inputStake").select()}})}FancyBetHandler.eventCalculate=function(w,v,x,u,t){var q=DataBase.fancyBet.get(v,x,u);var s=n(q);var r=w.find("#placeBet");if(!s){r.addClass("disable")}else{r.removeClass("disable")}FancyBetHandler.getExposure(v,x)};function n(s){if(s==null){return false}var u=DataBase.fancyBetMarkets.get(s.eventId,s.marketId);if(u==null){return false}var t=u.min;var q=u.max;if(!t||!q){return false}var r=parseFloat(s.stake||"0");if(r<t||r>q){return false}return true}function e(s,q,E,x,D,t){var r=s.find("#inputStake");var u=parseFloat(r.val())||0;var z=DataBase.fancyBet.get(q,E,x);var F="";var A=n(z);if(!A){var w=DataBase.fancyBetMarkets.get(q,z.marketId);var y=w.min;var B=w.max;if(u<y){r.val(y);DataBase.fancyBet.updateStake(q,E,x,y);F+=I18N.get("msg.member.minBet")}else{if(u>B){r.val(B);DataBase.fancyBet.updateStake(q,E,x,B);F+=I18N.get("msg.member.maxBet")}}}if(F!=""&&!A){a(t,"warning",F,true)}FancyBetHandler.getExposure(q,E);if(!A){s.find("#placeBet").removeClass("disable");return}z=DataBase.fancyBet.getForBet(q,E,x);var v=$j("#fancyBetBar_"+D);if(v.length==0){v=o(D);s.after(v)}var C=s.find("#fancyBetAcceptAnyOdds").is(":checked")?1:0;FancyBetHandler.submitBet(z,v,t,null,C);b(s,q,E,x)}FancyBetHandler.submitBet=function(r,q,w,v,u){var t=0;var s=0;$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.landingPath+"/member/playerService/fancyBet",data:{fancyBets:JSON.stringify([r]),isOneClickBet:v,isAcceptAnyOdds:u},beforeSend:function(){if(q!=null){q.show();h(q,k)}FancyBetMarketHandler.showDelayBetting(r.eventId,r.marketId)},complete:function(){},success:function(x){try{if(x.error){if(w!=null){a(w,"error",x.error,true)}else{NoticeHandler.error(x.error)}FancyBetMarketHandler.hideDelayBetting(r.eventId,r.marketId);return}if(x.result.length==0){FancyBetMarketHandler.hideDelayBetting(r.eventId,r.marketId);return}for(var y in x.result){var B=x.result[y];if(B.status=="SUCCESS"){if(t==0&&s==0){t=B.eventId;s=B.marketId}if(B.unMatchTicket!=null){DataBase.unMatchTicket.update([B.unMatchTicket])}if(B.txn!=null){DataBase.txn.update([B.txn]);if(w!=null){a(w,"success",null,true,"txn",B.txn)}}}else{if(B.error){if(w!=null){a(w,"error",B.error,true)}else{NoticeHandler.error(B.error)}FancyBetMarketHandler.hideDelayBetting(r.eventId,r.marketId)}}}if(t!=0&&s!=""){TxnHandler.setEventIdAndMarketId(t,s,CategoryType.FANCY_BET.unique());t=0;s=""}TxnHandler.updateOpenBetSelectionBox();TxnHandler.checkToHideOpenBets();var z=BetHandler.calculateTotalLiability();JsCache.get("#betSlipFullBtn").find("#total").html(CurrencyUtil.formatter(z))}catch(A){Trace.printStackTrace(A)}finally{if(q!=null){q.hide()}FancyBetMarketHandler.removeSelectClass(r.eventId);DataBase.fancyBet.clearByEventId(r.eventId);FancyBetHandler.getExposure(r.eventId,r.marketId)}},error:function(x){Trace.printStackTrace(x);if(q!=null){q.hide()}FancyBetMarketHandler.hideDelayBetting(r.eventId,r.marketId)}});JsCache.get("#confirmBetList").hide();JsCache.get("#confirmBetFullBtn").hide()};function o(r){var q=$j("#tempTable").find("#fancyBetBarTemplate").clone();q.prop("id","fancyBetBar_"+r);return q}function h(r,q){var t=MathUtil.decimal.multiply(q,10);var s=""+MathUtil.decimal.multiply(q,10);if(t>=0){c(t,s,r)}}function c(u,t,q){var r=q.find("#progressBar");var s=l(u,t);r.css("width",s);q.find("#secRemain").html(MathUtil.decimal.divide(u,10)+" sec remainingâ€¦");if(u>0){u--;setTimeout(function(){c(u,t,q)},100)}}function l(t,s){var u=MathUtil.decimal.subtract(s,t);var q=MathUtil.decimal.divide(u,s);if(q>1){q=1}var r=MathUtil.decimal.multiply(q,100);return Math.round(r)+"%"}function p(s,t){var q=$j("#overWrap");var r=q.find("#fancyBetMessage_"+t);if(r.length==0){r=j(t)}s.after(r);return r}function j(r){var q=$j("#tempTable").find("#fancyBetMessageTemplate").clone();q.prop("id","fancyBetMessage_"+r);return q}function a(r,y,z,w,u,v){var q=r.find("#header");r.find("#info").contents().filter(function(){return this.nodeType==3}).remove();r.find("#classWrap").removeClass("success").removeClass("error").removeClass("warning").addClass(y);if(z!=null){q.html(z)}if(v!=null){var t=v.stake;var x=CurrencyType.getInstanceOf(PageConfig.playerCurrency);var s=x.name+x.symbol+t+" at runs/odds "+v.runs+"/"+v.odds;CurrencyUtil.updateSetting({currencySymbol:x.symbol});if(FancySideType.YES.unique()==v.sideType){s+=" Profit: "}else{s+=" Liability: "}s+=MyTransactionUtils.getFancyBetPL(v.odds,v.stake);q.html("Bet Matched");q.after(s)}r.find("#close").unbind("click").click(function(){r.fadeOut()});if(w){setTimeout(function(){r.fadeOut()},3000)}r.fadeIn()}FancyBetHandler.getExposure=function(r,v){try{var x=DataBase.fancyBetMarkets.get(r,v);if(x==null){Trace.log("fancy market "+v+" is null");return}var w=DataBase.fancyBet.getByMarketId(r,v);var q=DataBase.txn.getByMarketId(r,v+"",null,null,CategoryType.FANCY_BET.unique());if(w.length==0&&q.length==0){f(r,v);return}var t=[MyTransactionStatusType.Active.unique(),MyTransactionStatusType.Void.unique()];q=DataBase.txn.getByMarketId(r,v+"",null,t,CategoryType.FANCY_BET.unique());var s=ExposureUtil.calculateFancyBetExposure(r,v,w,q);g(r,v,w,q,s);f(r,v)}catch(u){Trace.printStackTrace(u)}};function g(r,D,C,y,t){var x=$j("#fancyBetTable_"+r);var A=x.find("#fancyBetMarketList");var u=A.find("#fancyBetMarket_"+D);if(u.length==0){return}var B=WebSiteType.getInstanceOf(PageConfig.webSiteType);var z=CurrencyType.getInstanceOf(PageConfig.playerCurrency);var E={precision:2,separateSign:",",currencySymbol:z.symbol,formatter:CurrencyUtil.DefaultFormatter,"trailingZeros,":false};if(B.isFancyFairGroup()){E.precision=0;E.roundingMode="DOWN"}var v=u.find("#before");if(t.exposureBeforeBet){var s=t.exposureBeforeBet.marketExposure;v.removeClass();if(parseFloat(s)>=0){v.addClass("win")}else{v.addClass("lose")}v.html(CurrencyUtil.formatter(s,E));v.show()}else{v.hide()}var q=u.find("#after");if(t.exposureAfterBet){var w=t.exposureAfterBet.marketExposure;q.removeClass();if(parseFloat(w)>=0){q.addClass("to-win")}else{q.addClass("to-lose")}q.html(CurrencyUtil.formatter(w,E));q.show()}else{q.hide()}}function f(t,v){var u=$j("#fancyBetTable_"+t);var r=u.find("#fancyBetMarketList");var q=r.find("#fancyBetMarket_"+v);if(q.length==0){return}var w=DataBase.fancyBet.getByMarketId(t,v);var s=DataBase.txn.getByMarketId(t,v+"",null,null,CategoryType.FANCY_BET.unique());if(w.length>0){q.find("#after").show()}else{q.find("#after").hide()}if(s.length>0){q.find("#before").show()}else{q.find("#before").hide()}}FancyBetHandler.updateExposure=function(v){var w=$j("#fancyBetTable_"+v);var r=w.find("#fancyBetMarketList");if(r.length==0||!r.is(":visible")){return}var s=r.find("[id^=fancyBetMarket_]:visible");if(s.length==0){return}for(var t in s){var q=r.find(s[t]);var u=q.prop("eventId");var x=q.prop("marketId");if(u==null||x==null){return}FancyBetHandler.getExposure(u,x)}}})();if(typeof(DataBase)=="undefined"){DataBase={}}(function(){DataBase.fancyBet={};var a=new HashMap();DataBase.fancyBet.add=function(c,b,j,d,e,k,g,h){var f={eventType:c,eventId:b,marketId:j,sideType:d,runs:e,odds:k,eventName:g,marketName:h,timestamp:new Date().getTime()};var i=DataBase.fancyBet.generateKey(b,j,d);a.put(i,f);return f};DataBase.fancyBet.generateKey=function(c,d,b){return c+"_"+d+"_"+b};DataBase.fancyBet.get=function(d,e,c){var b=DataBase.fancyBet.generateKey(d,e,c);return a.get(b)};DataBase.fancyBet.remove=function(d,e,c){var b=DataBase.fancyBet.generateKey(d,e,c);return a.remove(b)};DataBase.fancyBet.queryAll=function(){return a.values()};DataBase.fancyBet.clear=function(){a.clear()};DataBase.fancyBet.clearByEventId=function(b){$j.each(a.values(),function(d,c){if(b==c.eventId){DataBase.fancyBet.remove(c.eventId,c.marketId,c.sideType)}})};DataBase.fancyBet.updateStake=function(e,g,d,f){var c=false;var b=DataBase.fancyBet.get(e,g,d);if(b==null){return}if(b.stake==null||(b.stake!=null&&b.stake!=f)){c=true}b.stake=f;return c};DataBase.fancyBet.getForBet=function(d,e,c){var b=DataBase.fancyBet.get(d,e,c);return{eventType:b.eventType,eventId:b.eventId,marketId:b.marketId,sideType:b.sideType,runs:b.runs,odds:b.odds,stake:b.stake,timestamp:b.timestamp}};DataBase.fancyBet.getByMarketId=function(c,d){var b=[];$j.each(a.values(),function(f,e){if(c==e.eventId&&d==e.marketId){b.push(e)}});return b}})();