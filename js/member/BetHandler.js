var CountDownUtils={};(function(){CountDownUtils.isShowCountDown=false;var a=5;CountDownUtils.startCountDown=function(b){var c=a;if(c>=0){CountDownUtils.countDown(c,b)}};CountDownUtils.countDown=function(c,b){if(c>0){b.html(I18N.get("form.button.placeBets")+I18N.get("form.button.placeBets.forNumberSec",[c]));c--;setTimeout(function(){CountDownUtils.countDown(c,b)},1000)}else{b.html(I18N.get("form.button.placeBets")+I18N.get("form.button.placeBets.processing"))}}})();if(typeof(BetHandler)=="undefined"){BetHandler={}}(function(){BetHandler.showSelectionIds=[];BetHandler.isOnBetting=false;var o=0;var q=false;var c=false;BetHandler.lastBetTime=0;var r=3000;BetHandler.init=function(){BetHandler.initCookieBetSlip();BetHandler.checkConfirmBetFromCookie();JsCache.get("#placeBets").click(function(){if(typeof(LoginHandler)!="undefined"&&!LoginHandler.userIsLogin()){return}if(o==1){BetHandler.confirmBets(this)}});JsCache.get("#placeBets").keydown(function(y){if(typeof(LoginHandler)!="undefined"&&!LoginHandler.userIsLogin()){return}var x=y.which;if(KeyEventUtils.isEnterKey(x)){JsCache.get("#placeBets").click()}});JsCache.get("[id^='comfirmBets']").change(function(){if(o==0){o=1;BetHandler.oddsAndStakeCheck();JsCache.get("#placeBets").unbind("click").click(function(){if(typeof(LoginHandler)!="undefined"&&!LoginHandler.userIsLogin()){return}BetHandler.confirmBets(this)});JsCache.get("[id^='comfirmBets']").attr("checked",true)}else{o=0;BetHandler.oddsAndStakeCheck();JsCache.get("[id^='comfirmBets']").attr("checked",false)}BetHandler.addConfirmBetToCookie()});JsCache.get("#editBets").click(function(){BetHandler.editBets(this)});JsCache.get("#cancelAll").mousedown(function(){BetHandler.clickCancelAll(this)});JsCache.get("#cancelAll").keydown(function(y){var x=y.which;if(KeyEventUtils.isEnterKey(x)){JsCache.get("#cancelAll").click()}});JsCache.get("#betList").scroll(function(){if(!PageConfig.ENABLE_CUSTOMIZE_STAKE){CoinHandler.hideStakePopupList()}var z=$j("[id^=bet_]");for(var y=0;y<z.length;y++){var x=$j(z[y]);BetHandler.hideStakeTipsPopup(x);BetHandler.hideOddsTips(x)}});q=true;if(BrowserUtil.isIE()||BrowserUtil.isEdge()){c=true}};BetHandler.initJob=function(){BetHandler.getPlayerInfoTask.run();if(PageConfig.enableBetSlipTimeout){BetHandler.checkBetSlipValidTask.run()}};BetHandler.checkBetSlipValidTask=TaskExecuter.createTask(3,0,function(){var x=this;BetHandler.checkBetSlipValid(x)});BetHandler.checkBetSlipValid=function(x){try{var z=BetHandler.readCookie();if(z==null){return}$j.each(z,function(D,B){if(B.length!=12){return}var A={sideType:B[0],odds:B[1],eventType:B[2],eventId:B[3],runner:B[4],marketId:B[5],selectionId:B[6],eventName:B[7],marketName:B[8],inPlay:B[9],timestamp:B[10],marketType:B[11]};if(!A.sideType||!A.odds||!A.eventType||!A.eventId||!A.runner||!A.marketId||!A.selectionId||!A.eventName){return}var E=A.marketId.replace("_",".");if(DateUtil.compare(new Date(),(A.timestamp+PageConfig.playerBetSlipTimeout*1000))==1){var F="bet_"+DataBase.bet.generateKey(A.eventId,A.marketId,A.selectionId,A.sideType);var C=$j("#"+F);BetHandler.deleteBet(C);BetHandler.getWinLoss(C.attr("eventId"),C.attr("marketId"))}})}catch(y){Trace.printStackTrace(y)}finally{x.check();TaskExecuter.execute()}};BetHandler.getPlayerInfoTask=TaskExecuter.createTask(5,0,function(){var x=this;BetHandler.getPlayerInfo(x)});BetHandler.getPlayerInfo=function(x){$j.ajax({type:"POST",dataType:"JSON",url:"/exchange/member/playerService/queryPlayerInfo",data:{},success:function(z){try{if(z==null){return}if(q&&(z.accountSuspended>0||z.accountSysSuspended>0)){var A=false;var y=DataBase.unMatchTicket.queryAll();$j.each(y,function(D,C){if(UnMatchTicketUtil.isActive(C.status)){A=true;return false}});if(A){NoticeHandler.error(I18N.get("msg.member.suspendedAndCancelUnMatch"));q=false;return}NoticeHandler.error(I18N.get("msg.member.suspended"));q=false}if(z.accountSuspended==0||z.accountSysSuspended==0){q=true}}catch(B){Trace.printStackTrace(B)}finally{x.check();TaskExecuter.execute()}},error:function(){x.check();TaskExecuter.execute()}})};BetHandler.changeBetListHeight=function(){l(169,131)};BetHandler.initBetListHeight=function(){l(189,86)};function l(x,y){if(c){var A=DataBase.unMatchTicket.getByMarketId(null,null);var z=DataBase.txn.getByMarketId(null,null);if($j(".slip-wrap").hasClass("full-bet_slip")||(A.length==0&&z.length==0)){x=($j("#betSlipBoard").height()-y)}$j("#betList").attr("style","max-height:"+x+"px")}else{$j("#betList").attr("style","max-height:calc(100% - "+y+"px);")}}BetHandler.fadeInMsg=function(x,y){JsCache.get(x).html(y).fadeIn();BetHandler.changeBetListHeight();setTimeout(function(){JsCache.get(x).fadeOut();BetHandler.initBetListHeight()},3000)};BetHandler.showMsg=function(x,y){JsCache.get(x).html(y).show();BetHandler.changeBetListHeight()};BetHandler.hideMsg=function(x){JsCache.get(x).hide();BetHandler.initBetListHeight()};BetHandler.checkBetTime=function(){var x=new Date().getTime();if(x&&((x-a())>r)){p(x);return true}return false};function p(x){BetHandler.lastBetTime=x}function a(){return BetHandler.lastBetTime}BetHandler.submitBet=function(){if(typeof(LoginHandler)!="undefined"&&!LoginHandler.userIsLogin()){return}TxnHandler.clickResetBtn();if(!BetHandler.checkBetTime()){return}t();var A=DataBase.bet.queryForBets();if(A.length==0||!A){return}var D=u(A);if(D.length==0||!D){return}if(PageConfig.ENABLE_LINE_MARKET){LineMarketHandler.reverseSideType(D)}var B=0;var z="";var y=$j("#betSlipBoard");var x=y.find("#placeBets");var C=k(D);$j.ajax({type:"POST",dataType:"JSON",url:"/exchange/member/playerService/exchange",data:{bets:JSON.stringify(D)},beforeSend:function(){if(D.length>1||CountDownUtils.isShowCountDown){JsCache.get("#loadingMsg").show()}JsCache.get("#betSlipBoard").hide();if(CountDownUtils.isShowCountDown){CountDownUtils.startCountDown(JsCache.get("#countDownTime"))}BetHandler.isOnBetting=true;x.attr("disable",true);x.addClass("disable");i(C,true)},complete:function(){JsCache.get("#loadingMsg").hide();x.attr("disable",false);x.removeClass("disable");i(C,false)},success:function(G){try{if(G.error){BetHandler.showMsg("#errorMsg",G.error);b();JsCache.get("#placeBets").unbind("click");f();return}if(G.result.length==0){return}JsCache.get("#loadingMsg").hide();BetHandler.isOnBetting=false;var M=[];for(var J in G.result){var E=G.result[J];if(E.status=="SUCCESS"){var I=JsCache.get("#betList").find("[eventId="+E.eventId+'][marketid="'+E.marketId.replace(".","_")+'"][selectionid='+E.selectionId+"][sidetype="+E.sideType+"]");BetHandler.deleteBet(I);if(B==0&&z==""){B=E.eventId;z=E.marketId}if(E.unMatchTicket!=null){DataBase.unMatchTicket.update([E.unMatchTicket])}if(E.txn!=null){DataBase.txn.update([E.txn])}var F=E.eventId+"_"+E.marketId;if(ArrayUtil.indexOf(M,F)==-1){M.push(F)}}else{if(E.error){BetHandler.showMsg("#errorMsg",E.error);b();JsCache.get("#placeBets").unbind("click");f()}}}if(B!=0&&z!=""){TxnHandler.setEventIdAndMarketId(B,z,CategoryType.BETFAIR.unique());B=0;z=""}if(M.length>0){for(var H=0;H<M.length;H++){var F=M[H].split("_");BetHandler.getWinLoss(F[0],F[1])}}setTimeout(function(){TxnHandler.getUnMatchTicketsAndTxns()},250);TxnHandler.updateOpenBetSelectionBox();TxnHandler.addBlankSelectOption(PageConfig.selectEventId,PageConfig.selectMarketId);TxnHandler.checkToHideOpenBets();var L=BetHandler.calculateTotalLiability();JsCache.get("#betSlipFullBtn").find("#total").html(CurrencyUtil.formatter(L))}catch(K){Trace.printStackTrace(K)}finally{CountDownUtils.isShowCountDown=false;JsCache.get("#countDownTime").html(I18N.get("form.button.placeBets"));i(C,false)}},error:function(E){Trace.printStackTrace(E)}});BetHandler.addToCookie();JsCache.get("#confirmBetList").hide();JsCache.get("#confirmBetFullBtn").hide()};BetHandler.confirmBets=function(x){var z=DataBase.bet.queryAll();if(z.length==0){return}var y=u(z);if(y.length==0||!y){return}DataBase.bet.calculatePL();$j("[id^='confirmBet_']").remove();$j("[id^='confirmHeader_']").remove();$j.each(y,function(K,I){if(!I.sideType||!I.eventId||!I.marketId||!I.selectionId||!I.stake||!I.odds||!I.profit||!I.liability){return true}JsCache.get("#betSlipBoard").hide();JsCache.get("#confirmBetList").show();JsCache.get("#confirmBetFullBtn").show();var A=I.eventId;var E=SideType.getInstanceOf(I.sideType);var M="--";var G="--";var P=I.marketId.replace("_",".");var B=DataBase.events.get(I.eventType,I.eventId);if(B!=null){if(B.markets.length>0){var D=null;var O=null;for(var F=0;F<B.markets.length;F++){if(B.markets[F].marketId==P){D=B.markets[F];break}}if(D!=null){M=D.marketName;for(var F=0;F<D.selections.length;F++){if(D.selections[F].selectionId==I.selectionId){O=D.selections[F];break}}if(O!=null){G=O.runnerName}}}}var J=JsCache.get("#confirmBetList");var L;if(SideType.Back.unique()==E.value){L=J.find("#backSlipHeader").show()}else{L=J.find("#laySlipHeader").show()}var N=JsCache.get("#confirmHeader_"+E.name+"_"+A);var H=I.eventName;if(N==null||N==undefined){N=JsCache.clone("#confirmHeader");N.attr("id","confirmHeader_"+E.name+"_"+A).attr("count",0);N.find("h4").html(H);J.prepend(N.show())}var C=JsCache.clone("#confirmBetTemplate");C.attr("id","confirmBet_"+DataBase.bet.generateKey(I.eventId,I.marketId,I.selectionId,I.sideType)).attr("eventId",I.eventId).attr("marketId",I.marketId).attr("selectionId",I.selectionId).attr("class","slip-"+E.name.toLowerCase()).attr("sideType",E.value);C.attr("class","slip-"+E.name.toLowerCase()).find("#slipType").html(StringUtil.ucfirst(E.name));C.find("#selectionName").html(G);C.find("#marketName").html(M);C.find("#price").html(I.odds);C.find("#size").html("$"+I.stake);if(SideType.Back.unique()==E.value){C.find("#profitLiability").html(CurrencyUtil.formatter(I.profit))}else{C.find("#profitLiability").html(CurrencyUtil.formatter(I.liability))}L.after(N.append(C.show()))});$j("#submitBets").unbind("click").click(function(){BetHandler.submitBet()});$j(document).keydown(function(B){var A=B.which;if(KeyEventUtils.isEnterKey(A)){JsCache.get("#submitBets").click();$j(document).unbind("keydown")}});checkIsNoElement(JsCache.get("#confirmBetList"))};function u(x){var y=[];$j.each(x,function(C,A){if(!A.sideType||!A.eventId||!A.marketId||!A.selectionId||!A.stake||!A.odds){return true}if(!OddsUtil.isValidOdds(A.odds)){if(PageConfig.ENABLE_LINE_MARKET){var D=DataBase.markets.get(A.eventId,A.marketId.replace("_","."));if(!MarketUtil.isLineMarket(D.marketType,D.bettingType)){return true}}else{return true}}var z=BetHandler.backOddsIsLessThanLayOdds(A.eventId,A.marketId,A.selectionId,A.sideType);if(z==true){return true}var B=BetHandler.getMinBet(A.eventId,A.marketId);if(A.stake<B||A.odds<1.01){return true}y.push(A)});return y}BetHandler.editBets=function(x){$j("#submitBets").unbind("click");JsCache.get("#betSlipBoard").show();JsCache.get("#confirmBetList").hide();JsCache.get("#confirmBetFullBtn").hide()};function f(){JsCache.get("#placeBets").addClass("disable")}function g(){JsCache.get("#placeBets").removeClass("disable")}function t(){var A=JsCache.get("#betList");var y=A.find("dl");var x=0;var z=0;$j.each(y,function(D,B){var C=$j(B);if(C.hasClass("sum")||C.is(":hidden")){return true}if(BetHandler.isLessThanMinStake(C,A)){return true}x=parseFloat(C.find("#odds").val());if(BetHandler.isLessThanMinOdds(x)){return true}if(MathUtil.isNumeric(x,true,false)){DataBase.bet.updateOdds(C.attr("eventId"),C.attr("marketId"),C.attr("selectionId"),C.attr("sideType"),x)}z=parseInt(C.find("#inputStake").val());if(MathUtil.isNumeric(z,false,false)){DataBase.bet.updateStake(C.attr("eventId"),C.attr("marketId"),C.attr("selectionId"),C.attr("sideType"),z)}var E=DataBase.markets.get(C.attr("eventId"),C.attr("marketId").replace("_","."));if(E!=null&&E.inPlay==1){CountDownUtils.isShowCountDown=true}})}BetHandler.appendBetObj=function(I,J){var M=1.01;if(I.html().replace(/\&nbsp;/g,"")=="--"){return}M=parseFloat(I.html());if(J==true){M=parseFloat(I.attr("fullMarketOdds"))}if(isNaN(M)){M=1.01}var C=SideType.getInstanceByName(I.attr("side"));var y=I.parent().parent();if(J==true){y=I.parent()}var z=y.attr("eventType");var x=y.attr("eventId");var L=y.attr("marketId").replace(".","_");var E=parseInt(I.attr("selectionId"));var K=I.attr("runner");var G=y.attr("eventName");var H=I.attr("marketName");var B=I.attr("inPlay");var A=I.attr("marketType");var D=JsCache.get("#betList").find("[eventId="+x+'][marketid="'+L+'"][selectionid='+E+"][sidetype="+C.value+"]");var F=null;if(D.length==0){F=DataBase.bet.add(C.value,M,z,x,K,L,E,G,H,B,A)}else{BetHandler.deleteBet(D)}return F};BetHandler.clickBtn=function(J,H){if(JsCache.get("#loadingMsg").is(":visible")){return}var E=$j(J);var y=E.parent().parent();if(H==true){y=E.parent()}var z=y.attr("eventType");var x=y.attr("eventId");var I=y.attr("marketId").replace(".","_");var C=parseInt(E.attr("selectionId"));var B=SideType.getInstanceByName(E.attr("side"));var A=DataBase.markets.get(x,I.replace("_","."));if(A!=null){if(A.disableBettingSite!=null&&WebSiteUtil.isDisableBettingSite(A.disableBettingSite,PageConfig.webSiteType)){return}if(A.autoDisableBettingSite!=null&&WebSiteUtil.isDisableBettingSite(A.autoDisableBettingSite,PageConfig.webSiteType)){return}}var G=DataBase.markets.getSelection(x,I.replace("_","."),C);if(G!=null&&G.isAutoSuspend==1){return}if(BetHandler.isEnableCheckLowLiquidity()){if(BetHandler.isLowLiquidity(z,x,I.replace("_","."),true)){return}}if(PageConfig.ENABLE_ONE_CLICK_BET=="true"&&OneClickBetHandler.isEnable()&&PageConfig.isOneClickBet==1){if(!PageConfig.ENABLE_ONE_CLICK_BET_ALL_PAGE&&!H){}else{if(!OneClickBetHandler.isEnableSubmitOneClickBet()){return}OneClickBetHandler.placeBet(E,y,x,I,C,B.unique(),H);return}}var D=BetHandler.appendBetObj(E,H);if(PageConfig.userCoin!=0){DataBase.bet.updateStake(x,I,C,B.unique(),parseFloat(PageConfig.userCoin))}BetHandler.getWinLoss(x,I);if(D==null){return}MarketHandler.checkMarkets(D.eventType,D.eventId,D.marketId);BetHandler.addBets(D);BetHandler.addToCookie();if(PageConfig.userCoin!=0){BetHandler.calculateProfitAndLiability();var F=BetHandler.calculateTotalLiability();JsCache.get("#betSlipFullBtn").find("#total").html(CurrencyUtil.formatter(F))}};BetHandler.isEnableCheckLowLiquidity=function(){return(PageConfig.isEnableLowLiquidity=="true"&&!PageConfig.isPoliticsPage)};BetHandler.isLowLiquidity=function(z,y,G,x){var B=DataBase.markets.get(y,G);if(B==null){return false}var A=B.marketType;var E=0;var C=B.totalMatchedInUSD;if(C==null){return false}if(C==-1){if(x){return true}return false}if(B.isLowLiquidity!=null){return B.isLowLiquidity}if(PageConfig.ENABLE_MARKET_LIQUIDITY_CACHE=="true"){var F=("MATCH_ODDS"==A||"WIN"==A)?"_MATCH_ODDS":"_OTHERS";var D=JSON.parse(PageConfig.marketLiquiditys);E=D[z+F]}else{E=("MATCH_ODDS"==A||"WIN"==A)?PageConfig.LOW_LIQUIDITY_FOR_MATCH_ODDS:PageConfig.LOW_LIQUIDITY_FOR_OTHERS}if(E==0){return false}if(C<E){return true}return false};BetHandler.appendMaxHeightForIE=function(z){var y=86;if(z){y=106}var A=BrowserUtil.getBrowserName();if(A=="Mozilla"||A=="Explorer"||A=="Edge"){var x=$j("#betSlipBoard").height();JsCache.get("#betList").css("max-height",(x-y)+"px")}};BetHandler.betAll=function(I,H,y,x,J){if(BetHandler.isEnableCheckLowLiquidity()){if(BetHandler.isLowLiquidity(y,x,J.replace("_","."))){return}}var z=DataBase.markets.get(x,J);if(z!=null&&z.disableBettingSite!=null&&WebSiteUtil.isDisableBettingSite(z.disableBettingSite,PageConfig.webSiteType)){return}if(z.autoDisableBettingSite!=null&&WebSiteUtil.isDisableBettingSite(z.autoDisableBettingSite,PageConfig.webSiteType)){return}if(PageConfig.ENABLE_ONE_CLICK_BET=="true"&&PageConfig.isOneClickBet==1){return}if(JsCache.get("#loadingMsg").is(":visible")){return}var G=[];for(var A=0;A<I.length;A++){var D=$j(I[A]);if(D.hasClass("sum")||D.is(":hidden")||D.html()==null){continue}var B=parseInt(D.attr("selectionId"));var F=DataBase.markets.getSelection(x,J.replace("_","."),B);if(F!=null&&F.isAutoSuspend==1){continue}var C=BetHandler.appendBetObj(D,H);if(C==null){continue}if(PageConfig.userCoin!=0){DataBase.bet.updateStake(C.eventId,C.marketId,C.selectionId,C.sideType,parseFloat(PageConfig.userCoin))}G.push(C)}if(x!=null&&J!=null){BetHandler.getWinLoss(x,J)}else{BetHandler.getWinLoss(PageConfig.selectEventId,PageConfig.selectMarketId)}if(G.length==0){return}MarketHandler.checkMarkets(G[0].eventType,G[0].eventId,G[0].marketId);BetHandler.addBetsAll(G);BetHandler.addToCookie();if(PageConfig.userCoin!=0){BetHandler.calculateProfitAndLiability();var E=BetHandler.calculateTotalLiability();JsCache.get("#betSlipFullBtn").find("#total").html(CurrencyUtil.formatter(E));BetHandler.oddsAndStakeCheck()}};BetHandler.initCookieBetSlip=function(){if(PageConfig.userID==""){return}var x=BetHandler.readCookie();if(x==null){return}$j.each(x,function(A,z){if(z.length!=12){return true}var y={sideType:z[0],odds:z[1],eventType:z[2],eventId:z[3],runner:z[4],marketId:z[5],selectionId:z[6],eventName:z[7],marketName:z[8],inPlay:z[9],timestamp:z[10],marketType:z[11]};if(!y.sideType||!y.odds||!y.eventType||!y.eventId||!y.runner||!y.marketId||!y.selectionId||!y.eventName){return true}var B=y.marketId.replace("_",".");$j.ajax({type:"POST",dataType:"JSON",url:"/exchange/member/playerService/querySingleMarket",data:{eventId:y.eventId,marketId:B},success:function(C){try{if(C.eventId==y.eventId&&MarketUtil.isOpen(C.status)){DataBase.bet.add(y.sideType,y.odds,y.eventType,y.eventId,y.runner,y.marketId,y.selectionId,y.eventName,y.marketName,y.inPlay,y.marketType);MarketHandler.checkMarkets(y.eventType,y.eventId,y.marketId);BetHandler.addBets(y)}BetHandler.addToCookie()}catch(D){Trace.printStackTrace(D)}finally{}},error:function(C){Trace.printStackTrace(C)}})})};BetHandler.addToCookie=function(){var x=DataBase.bet.queryForCookie();if(x==null){return}if(x.length>parseInt(PageConfig.MAX_BET_RECORDS_IN_COOKIE)){return}CookieUtil.setCookie("betSlips_"+PageConfig.userID,JSON.stringify(x),999)};BetHandler.readCookie=function(){var x=CookieUtil.getCookie("betSlips_"+PageConfig.userID);var y=JSON.parse(x);return y};BetHandler.checkConfirmBetFromCookie=function(){var x=CookieUtil.getCookie("confirmBets_"+PageConfig.userID);if(x==1){o=1;JsCache.get("[id^='comfirmBets']").prop("checked",true)}else{o=0;JsCache.get("[id^='comfirmBets']").prop("checked",false)}};BetHandler.addConfirmBetToCookie=function(){CookieUtil.setCookie("confirmBets_"+PageConfig.userID,o,999)};BetHandler.appendBetTemplate=function(D){var x=D.eventId;var B=SideType.getInstanceOf(D.sideType);JsCache.get("#noBetSlipInfo").hide();JsCache.get("#betSlipBoard").show();var J='<img class="icon-no_play" src="/images/transparent.gif" />';if(D.inPlay!=null&&D.inPlay==1){J='<img class="icon-in_play" src="/images/transparent.gif" />'}var I=JsCache.get("#betList");var y=JsCache.get("#betSlipBoard");var G;if(SideType.Back.unique()==B.value){G=y.find("#backSlipHeader").show()}else{G=y.find("#laySlipHeader").show()}var L=JsCache.get("#header_"+B.name+"_"+x);var C=D.eventName;var H=D.marketName;if(L==null||L==undefined){L=JsCache.clone("#headerTemplate");L.attr("id","header_"+B.name+"_"+x).attr("count",0);L.find("h4").html(J+" "+C);I.prepend(L.show())}var E=parseInt(L.attr("count"));var F=JsCache.clone("#betTemplate");F.attr("id","bet_"+DataBase.bet.generateKey(D.eventId,D.marketId,D.selectionId,D.sideType)).attr("eventId",D.eventId).attr("marketId",D.marketId).attr("selectionId",D.selectionId).attr("class","slip-"+B.name.toLowerCase()).attr("sideType",B.value).attr("marketType",D.marketType);if(D.stake!=null&&D.stake!=0){F.find("#inputStake").val(D.stake)}F.find("#odds").val(D.odds);F.find("#marketName").html(H);F.find("#delete").after('<span class="short-amount">'+D.runner+"</span>");F.find("#profitLiability").html(PageConfig.currencySymbol+"0.00");if("INNINGS_RUNS"==D.marketType){var A=DataBase.markets.get(D.eventId,D.marketId.replace("_","."));var z=F.find("#inningsRuns");if(PageConfig.ENABLE_LINE_MARKET&&A!=null&&MarketUtil.isLineMarket(A.marketType,A.bettingType)){z.find("#ifRuns").html("If "+H+"<"+D.odds);z.find("#ifLess").html("If "+H+">"+D.odds);z.find("#runsPL").html(PageConfig.currencySymbol+"0.00");z.find("#lessPL").html(PageConfig.currencySymbol+"0.00")}else{var K=D.runner.toLowerCase();z.find("#ifRuns").html("If "+K);z.find("#ifLess").html("If less than "+K.replace("or more",""));z.find("#runsPL").html(PageConfig.currencySymbol+"0.00");z.find("#lessPL").html(PageConfig.currencySymbol+"0.00")}z.show()}else{F.find("#inningsRuns").hide()}G.after(L.append(F.show()).attr("count",++E));F.find("#odds").select();F.find("#odds").attr("tabindex",0);F.find("#inputStake").attr("tabindex",0);JsCache.get("#placeBets").addClass("disable");JsCache.get("#betSlipFullBtn").find("#total").html(PageConfig.currencySymbol+"0.00");return F};BetHandler.addBets=function(x){var y=BetHandler.appendBetTemplate(x);e(y);var z=$j("#betList");CoinHandler.buildStakePopupList(y);CoinHandler.clickStakePopupList(y,z,false);BetHandler.addSelectClass();BetHandler.oddsAndStakeCheck(y)};BetHandler.addBetsAll=function(D){var y=[];for(var A in D){var x=D[A];var B=BetHandler.appendBetTemplate(x);y.push(B)}BetHandler.addSelectClass();var C=$j("#betList");for(var z in y){var B=y[z];e(B);CoinHandler.buildStakePopupList(B);CoinHandler.clickStakePopupList(B,C,false)}y[0].find("#odds").select()};BetHandler.addSelectClass=function(){var C=new Date().getTime();var B=$j("[id^=popMarketItem_]").length==0?false:true;var D=DataBase.bet.queryAll();var A=$j("#overWrap");if(PageConfig.ENABLE_QUICK_BET=="true"){var x=DataBase.quickBet.queryAll();for(var z in x){var y=x[z];D.push(y)}}$j.each(D,function(F,E){var I=E.eventId;var J=E.marketId;var G=E.selectionId;var H=SideType.getInstanceOf(E.sideType);s(I,J,G,H,B,A)})};function s(I,x,P,K,y,R){if(MultiMarketsHandler.isViewMultiMarket()==true){var O=$j("#multiMarketsWrap");var Q=O.find("[eventId="+I+"][marketId="+x+"][selectionId="+P+"]");var F=Q.find("#"+K.name.toLowerCase()+"_1");if(F.length!=0){F.addClass("select")}}else{if(PageConfig.selectMarketId==null){var B=$j("#eventBoard");var J=B.find("#highLightEvent_"+I);var A=J.find("[selectionid="+P+"][side="+K.name+"]");if(A.length!=0){A.addClass("select")}var z=$j("#event_"+I);var M=z.find("[selectionid="+P+"][side="+K.name+"]");if(M.length!=0){M.addClass("select")}}if(PageConfig.selectMarketId!=null){var L=$j("#fullMarketBoard");var Q=L.find("[eventId="+I+"][marketId="+x+"][selectionId="+P+"]");var F=Q.find("#"+K.name.toLowerCase()+"_1");if(F.length!=0){F.addClass("select")}if(y==true){var N=$j("#popularMarkets");var G=N.find("[eventId="+I+"][marketId="+x+"][popSelectionitem="+P+"]");var D=G.find("[selectionid="+P+"][side="+K.name+"]");if(D.length!=0){D.addClass("select")}}if(PageConfig.ENABLE_LINE_MARKET){var H=R.find("#lineMarketWrap");var E=H.find("[eventId="+I+"][marketId="+x+"][selectionId="+P+"]");var C=E.find("#"+K.name.toLowerCase()+"_1");if(C.length>0){C.addClass("select")}}}if(PageConfig.isPoliticsPage==true){var R=$j("#overWrap");var Q=R.find("[eventId="+I+"][marketId="+x+"][selectionId="+P+"]");var F=Q.find("#"+K.name.toLowerCase()+"_1");if(F.length!=0){F.addClass("select")}}}}BetHandler.removeSelectClass=function(H,x,N,F){var J=SideType.getInstanceOf(F);var P=$j("#overWrap");if(MultiMarketsHandler.isViewMultiMarket()==true){var M=$j("#multiMarketsWrap");var O=M.find("[eventId="+H+"][marketId="+x+"][selectionId="+N+"]");var D=O.find("#"+J.name.toLowerCase()+"_1");if(D.length!=0){D.removeClass("select")}}else{if(PageConfig.selectMarketId==null){var I=$j("#highLightEvent_"+H);var z=I.find("[selectionid="+N+"][side="+J.name+"]");if(z.length!=0){z.removeClass("select")}var y=$j("#event_"+H);var L=y.find("[selectionid="+N+"][side="+J.name+"]");if(L.length!=0){L.removeClass("select")}}if(PageConfig.selectMarketId!=null){var K=$j("#fullMarketBoard");var O=K.find("[eventId="+H+"][marketId="+x+"][selectionId="+N+"]");var D=O.find("#"+J.name.toLowerCase()+"_1");if(D.length!=0){D.removeClass("select")}var E=$j("[eventId="+H+"][marketId="+x+"][popSelectionitem="+N+"]");var B=E.find("[selectionid="+N+"][side="+J.name+"]");if(B.length!=0){B.removeClass("select")}if(PageConfig.ENABLE_LINE_MARKET){var G=P.find("#lineMarketWrap");var C=G.find("[eventId="+H+"][marketId="+x+"][selectionId="+N+"]");var A=C.find("#"+J.name.toLowerCase()+"_1");if(A.length>0){A.removeClass("select")}}}if(PageConfig.isPoliticsPage==true){var P=$j("#overWrap");var O=P.find("[eventId="+H+"][marketId="+x+"][selectionId="+N+"]");var D=O.find("#"+J.name.toLowerCase()+"_1");if(D.length!=0){D.removeClass("select")}}}};BetHandler.oddsAndStakeCheck=function(x){JsCache.get("#placeBets").unbind("click");f();var z=DataBase.bet.queryAll();var C=false;var y=true;$j.each(z,function(G,E){if(!E.odds||!E.stake){f();C=true;return true}var D=BetHandler.backOddsIsLessThanLayOdds(E.eventId,E.marketId,E.selectionId,E.sideType);if(D==true){BetHandler.showMsg("#errorMsg",I18N.get("msg.member.odds.backOddsIsLessThanLayOdds",[E.eventName,E.marketName,E.runner]));f();C=true;if(y==true){y=false}return true}var H=BetHandler.isLessThanMinOdds(E.odds);if(H==true){f();BetHandler.showMsg("#errorMsg",I18N.get("msg.member.odds.minOdds"));C=true;if(y==true){y=false}return true}var F=BetHandler.getMinBet(E.eventId,E.marketId);if(E.stake<F){BetHandler.showMsg("#errorMsg",I18N.get("msg.member.minBet"));f();C=true;if(y==true){y=false}return true}});if(y==true){BetHandler.hideMsg("#errorMsg")}if(x!=null){var A=BetHandler.isLessThanMinStake(x,JsCache.get("#betList"));if(A==true){f();return}var B=BetHandler.isLessThanMinOdds(x.find("#odds").val());if(B==true){f();BetHandler.showOddsTips(x,JsCache.get("#betList"));return}if(x.find("#odds").val()>1000){x.find("#odds").val(1000);BetHandler.fadeInMsg("#errorMsg",I18N.get("msg.member.editBet.maximumOdds"));return}BetHandler.hideOddsTips(x)}if(C==true){return}g();if(o==0){JsCache.get("#placeBets").unbind("click").click(function(){if(typeof(LoginHandler)!="undefined"&&!LoginHandler.userIsLogin()){return}BetHandler.submitBet()})}else{JsCache.get("#placeBets").unbind("click").click(function(){if(typeof(LoginHandler)!="undefined"&&!LoginHandler.userIsLogin()){return}BetHandler.confirmBets(this)})}};BetHandler.eventCalculate=function(x,y){BetHandler.calculateProfitAndLiability();var z=BetHandler.calculateTotalLiability();JsCache.get("#betSlipFullBtn").find("#total").html(CurrencyUtil.formatter(z));BetHandler.oddsAndStakeCheck(x);if(y==true){BetHandler.getWinLoss(x.attr("eventId"),x.attr("marketId"))}};function e(x){x.find("#delete").click(function(){j(this)});x.find("#oddsUp").click(function(){var y=BetHandler.clickOdds(x.attr("eventId"),x.attr("marketId"),x.attr("selectionId"),x.attr("sideType"),this,x);BetHandler.eventCalculate(x,y);x.find("#odds").select();if(x.find("#odds").val()>1000){x.find("#odds").val(1000);BetHandler.fadeInMsg("#errorMsg",I18N.get("msg.member.editBet.maximumOdds"))}});x.find("#oddsDown").click(function(){var y=BetHandler.clickOdds(x.attr("eventId"),x.attr("marketId"),x.attr("selectionId"),x.attr("sideType"),this,x);BetHandler.eventCalculate(x,y);x.find("#odds").select()});x.find("#odds").change(function(){var y=BetHandler.updateKeyupOdds(x.attr("eventId"),x.attr("marketId"),x.attr("selectionId"),x.attr("sideType"),this);BetHandler.eventCalculate(x,y)});x.find("#odds").blur(function(){BetHandler.blurCheckOddsValidate(this,null,x.attr("eventId"),x.attr("marketId").replace("_","."));var y=BetHandler.updateKeyupOdds(x.attr("eventId"),x.attr("marketId"),x.attr("selectionId"),x.attr("sideType"),this);BetHandler.eventCalculate(x,y)});x.find("#odds").keyup(function(B){var z=$j(this);TxnHandler.validComma(z);if(outOfScale(z.val(),2)){z.val(MathUtil.floorp(z.val(),2))}var y=BetHandler.updateKeyupOdds(x.attr("eventId"),x.attr("marketId"),x.attr("selectionId"),x.attr("sideType"),this);BetHandler.eventCalculate(x,y);var A=B.which;if(KeyEventUtils.isEnterKey(A)){$j("#placeBets").click()}if(KeyEventUtils.isTabKey(A)&&x.find("#odds").is(":focus")){x.find("#odds").select()}});x.find("#odds").click(function(){x.find("#odds").select()});x.find("#inputStake").click(function(){x.find("#inputStake").select()});x.find("#inputStake").change(function(){var y=parseInt(x.find("#inputStake").val());if(isNaN(y)){y=0}var z=DataBase.bet.updateStake(x.attr("eventId"),x.attr("marketId"),x.attr("selectionId"),x.attr("sideType"),y);BetHandler.eventCalculate(x,z)});x.find("#inputStake").blur(function(){CoinHandler.hideStakePopupList();var y=parseInt(x.find("#inputStake").val());if(isNaN(y)){y=0}y=BetHandler.blurCheckStakeValid($j(this),PageConfig.webSiteType,PageConfig.playerCurrency,y,null,x.attr("eventId"),x.attr("marketId"));var z=DataBase.bet.updateStake(x.attr("eventId"),x.attr("marketId"),x.attr("selectionId"),x.attr("sideType"),y);BetHandler.eventCalculate(x,z)});x.find("#inputStake").keydown(function(A){var z=A.which;if(KeyEventUtils.isNumberKey(A)||KeyEventUtils.isBackspaceKey(z)||KeyEventUtils.isDeleteKey(z)||KeyEventUtils.isArrowKey(z)||KeyEventUtils.isTabKey(z)||KeyEventUtils.isEnterKey(z)){var y=x.find("#stakePopupList");return}WindowEventUtil.stopEvent(A)});x.find("#inputStake").keyup(function(D){var B=$j(this);var y=B.parent().parent();$j(this).val(function(E,F){return commaSeparateNumber(F)});var z=parseInt(y.find("#inputStake").val());if(isNaN(z)){z=0}var A=DataBase.bet.updateStake(x.attr("eventId"),x.attr("marketId"),x.attr("selectionId"),x.attr("sideType"),z);BetHandler.eventCalculate(x,A);var C=D.which;if(KeyEventUtils.isEnterKey(C)){$j("#placeBets").click()}if(KeyEventUtils.isTabKey(C)&&x.find("#inputStake").is(":focus")){x.find("#inputStake").select()}})}BetHandler.calculateProfitAndLiability=function(){DataBase.bet.calculatePL();var x=DataBase.bet.queryAll();for(var A in x){var D=x[A];var B=JsCache.get("#betList").find("[eventId="+D.eventId+'][marketid="'+D.marketId.replace(".","_")+'"][selectionid='+D.selectionId+"][sidetype="+D.sideType+"]");var y=0;if(SideType.Back.unique()==D.sideType){y=D.profit}else{y=D.liability}if(isNaN(y)){y=0}B.find("#profitLiability").html(CurrencyUtil.formatter(y));if("INNINGS_RUNS"==D.marketType){var C=B.find("#runsPL");var F=B.find("#lessPL");if(C==null||F==null){return}var z=0;var E=0;if(SideType.Back.unique()==D.sideType){z=D.profit;E=-1*D.liability}else{z=-1*D.liability;E=D.profit}C.html(CurrencyUtil.formatter(z));F.html(CurrencyUtil.formatter(E));C.removeClass("green").removeClass("red");F.removeClass("green").removeClass("red");if(z>=0){C.addClass("green")}else{C.addClass("red")}if(E>=0){F.addClass("green")}else{F.addClass("red")}}}};BetHandler.calculateTotalLiability=function(){var x=DataBase.bet.queryAll();return BetHandler.calculateExposure(x)};BetHandler.calculateExposure=function(B){var Q=0;var P=new HashMap();for(var N in B){var G=B[N];var x=G.eventId+"_"+G.marketId.replace("_",".");var C=P.get(x);if(C==null){C=[]}C.push(G);P.put(x,C)}var J=[];var E=P.entrySet();for(var N in E){var A=E[N];var x=A.key.split("_");var C=A.value;var K=x[0];var z=x[1];var F=DataBase.markets.get(K,z);if(F==null){continue}var D=F.selections;var L=parseInt(F.numberOfWinners);var M=parseInt(F.numberOfActiveRunners);var I=parseInt(F.numberOfRunners);var y=ExposureUtil.getNotActiveSelectionIdArr(D);var H=ExposureUtil.genTicketArray(C,false);ExposureHandler.initMarketInfo(K,z,L,M,y);ExposureHandler.calculateExposure(H);var O=ExposureHandler.getMarketExposure();J.push(O)}for(var N in J){var O=J[N];Q=MathUtil.decimal.add(Q,O.marketExposure)}return Math.abs(Q)};BetHandler.isOneMoreWinnerMarket=function(x){if(x==null){return false}return(parseInt(x.numberOfWinners)>1||"PLACE"==x.marketType||"OTHER_PLACE"==x.marketType)};BetHandler.getWinLoss=function(H,x){BetHandler.showSelectionIds=[];var C=DataBase.markets.get(H,x.replace("_","."));if(C==null){Trace.log("market "+x+" is null");return}var I=parseInt(C.numberOfWinners);var G=[];var B=C.selections;for(var K in B){var N=B[K];G.push(N.selectionId)}var y=$j("[id^=popMarketItem_]").length==0?false:true;var O=$j("#overWrap");var A=DataBase.bet.getByMarketId(H,x.replace(".","_"));var z=DataBase.unMatchTicket.getByMarketId(H,x.replace("_","."),null,CategoryType.BETFAIR.unique());var J=DataBase.txn.getByMarketId(H,x.replace("_","."),null,null,CategoryType.BETFAIR.unique());if(A.length==0&&z.length==0&&J.length==0){m(H,x,G,I,C,y,O);return}var F=new Date().getTime();var D=n(H,x,I);if(D==null){return}var E=new Date().getTime();var O=$j("#overWrap");var L=D.keySet();for(var K in L){var M=L[K];if(I==0||BetHandler.isOneMoreWinnerMarket(C)){if(ArrayUtil.indexOf(BetHandler.showSelectionIds,parseInt(M))==-1){continue}}BetHandler.appendSelectionWinLoss(D,C,H,x,M,y,O)}m(H,x,G,I,C,y,O)};function n(A,C,z){var E=DataBase.markets.get(A,C.replace("_","."));if(E==null){Trace.error("market "+C+" is null");return}var D=DataBase.bet.getByMarketId(A,C.replace(".","_"));var y=DataBase.unMatchTicket.getByMarketId(A,C.replace("_","."),null,CategoryType.BETFAIR.unique());var B=[MyTransactionStatusType.Active.unique()];var x=DataBase.txn.getByMarketId(A,C.replace("_","."),null,B,CategoryType.BETFAIR.unique());return ExposureUtil.calculateExposure(D,y,x,A,C,E,BetHandler.showSelectionIds,PageConfig.ENABLE_FORECAST_NOT_INCLUDE_UNMATCHED)}BetHandler.appendSelectionWinLoss=function(B,A,G,x,Q,y,R){var N=WebSiteType.getInstanceOf(PageConfig.webSiteType);var C=CurrencyType.getInstanceOf(PageConfig.playerCurrency);var J={precision:2,separateSign:",",currencySymbol:C.symbol,formatter:CurrencyUtil.DefaultFormatter,"trailingZeros,":false};if(N.isFancyFairGroup()){J.precision=0;J.roundingMode="DOWN"}var I=parseInt(A.numberOfWinners);var L=DataBase.bet.getBySelectionId(G,x,Q);var K=DataBase.unMatchTicket.getBySelectionId(G,x,Q,CategoryType.BETFAIR.unique());var H=DataBase.txn.getBySelectionId(G,x,Q,CategoryType.BETFAIR.unique());if(PageConfig.selectMarketId!=null){var F=$j("#fullMarketBetsWrap");var M=F.find("[id=fullSelection_"+Q+"][marketId="+x.replace(".","_")+"]");if(M.length!=0){BetHandler.appendFullSelectionWinLoss(M,B,A,Q,I,L,K,H,J)}if(y==true){var z="[marketId="+x.replace(".","_")+"][popSelectionItem="+Q+"]";BetHandler.appendSelectionItemWinLoss(z,x,Q,B,A,L,K,H,J)}}if(PageConfig.selectMarketId==null){var P="[marketId="+x.replace(".","_")+"][selectionItem="+Q+"]";BetHandler.appendSelectionItemWinLoss(P,x,Q,B,A,L,K,H,J)}if(MultiMarketsHandler.isViewMultiMarket()==true){var O=$j("#multiMarketsWrap");var M=O.find("[id=fullSelection_"+Q+"][marketId="+x.replace(".","_")+"]");BetHandler.appendFullSelectionWinLoss(M,B,A,Q,I,L,K,H,J)}if(PageConfig.ENABLE_LINE_MARKET){var E=R.find("#lineMarketWrap");var D=E.find("[eventId="+G+"][marketId="+x.replace(".","_")+"][selectionId="+Q+"]");if(D.length>0){BetHandler.appendFullSelectionWinLoss(D,B,A,Q,I,L,K,H,J)}}if(PageConfig.isPoliticsPage==true){var R=$j("#overWrap");var M=R.find("[id=fullSelection_"+Q+"][marketId="+x.replace(".","_")+"]");BetHandler.appendFullSelectionWinLoss(M,B,A,Q,I,L,K,H,J)}};BetHandler.appendFullSelectionWinLoss=function(G,F,z,C,A,E,D,B,H){G.find("th").addClass("predict");var x=EventType.getInstanceOf(z.eventType);if(x!=null&&x.isRacingEvent()){G.addClass("predict")}var y=F.get(C);if(BetHandler.isOneMoreWinnerMarket(z)||A==0){if(B.length>0){G.find("#withoutBet").attr("class",y.withoutBet>0?"win":"lose");G.find("#withoutBet").html(CurrencyUtil.formatter(y.withoutBet,H)+",");G.find("#withoutBet").show();G.find("#lossWithoutBet").attr("class",y.lossWithoutBet>0?"win":"lose");G.find("#lossWithoutBet").html(CurrencyUtil.formatter(y.lossWithoutBet,H));G.find("#lossWithoutBet").show()}if(D.length>0||E.length>0){G.find("#withBet").attr("class",y.withBet>0?"to-win":"to-lose");G.find("#withBet").html(CurrencyUtil.formatter(y.withBet,H)+",");G.find("#withBet").show();G.find("#lossWithBet").attr("class",y.lossWithBet>0?"win":"lose");G.find("#lossWithBet").html(CurrencyUtil.formatter(y.lossWithBet,H));G.find("#lossWithBet").show()}}else{G.find("#withoutBet").attr("class",y.withoutBet>0?"win":"lose");G.find("#withoutBet").html(CurrencyUtil.formatter(y.withoutBet,H));G.find("#withoutBet").show();G.find("#withBet").attr("class",y.withBet>0?"to-win":"to-lose");G.find("#withBet").html(CurrencyUtil.formatter(y.withBet,H));G.find("#withBet").show()}};BetHandler.appendSelectionItemWinLoss=function(z,H,D,G,A,F,E,C,I){if($j(z).length!=0){var B=parseInt(A.numberOfWinners);var y=$j(z);var x=G.get(D);y.addClass("predict");if(BetHandler.isOneMoreWinnerMarket(A)||B==0){if(C.length>0){y.find("#withoutBet").attr("class",x.withoutBet>0?"win":"lose");y.find("#withoutBet").html(CurrencyUtil.formatter(x.withoutBet,I)+",");y.find("#withoutBet").show();y.find("#lossWithoutBet").attr("class",x.lossWithoutBet>0?"win":"lose");y.find("#lossWithoutBet").html(CurrencyUtil.formatter(x.lossWithoutBet,I));y.find("#lossWithoutBet").show()}if(E.length>0||F.length>0){y.find("#withBet").attr("class",x.withBet>0?"to-win":"to-lose");y.find("#withBet").html(CurrencyUtil.formatter(x.withBet,I)+",");y.find("#withBet").show();y.find("#lossWithBet").attr("class",x.lossWithBet>0?"win":"lose");y.find("#lossWithBet").html(CurrencyUtil.formatter(x.lossWithBet,I));y.find("#lossWithBet").show()}}else{y.find("#withoutBet").attr("class",x.withoutBet>0?"win":"lose");y.find("#withoutBet").html(CurrencyUtil.formatter(x.withoutBet,I));y.find("#withoutBet").show();y.find("#withBet").attr("class",x.withBet>0?"to-win":"to-lose");y.find("#withBet").html(CurrencyUtil.formatter(x.withBet,I));y.find("#withBet").show()}}};function m(G,x,F,H,B,y,O){for(var K in F){var N=F[K];var z=DataBase.bet.getByMarketId(G,x);var I=DataBase.txn.getByMarketId(G,x,null,null,CategoryType.BETFAIR.unique());if(BetHandler.isOneMoreWinnerMarket(B)||H==0){z=DataBase.bet.getBySelectionId(G,x,N);I=DataBase.txn.getBySelectionId(G,x,N,CategoryType.BETFAIR.unique())}if(PageConfig.selectMarketId!=null){var D=$j("#fullMarketBetsWrap");var J=D.find("[id=fullSelection_"+N+"][marketId="+x.replace(".","_")+"]");if(J.length!=0){h(J,G,x,N,z,I,H,B)}if(y==true){var A="[marketId="+x.replace(".","_")+"][popSelectionItem="+N+"]";w(A,N,z,I,H)}}if(PageConfig.selectMarketId==null){var M="[marketId="+x.replace(".","_")+"][selectionItem="+N+"]";w(M,N,z,I,H)}if(MultiMarketsHandler.isViewMultiMarket()==true){var L=$j("#multiMarketsWrap");var J=L.find("[id=fullSelection_"+N+"][marketId="+x.replace(".","_")+"]");if(J.length!=0){h(J,G,x,N,z,I,H,B)}}if(PageConfig.ENABLE_LINE_MARKET){var E=O.find("#lineMarketWrap");var C=E.find("[eventId="+G+"][marketId="+x.replace(".","_")+"][selectionId="+N+"]");if(C.length>0){h(C,G,x,N,z,I,H,B)}}if(PageConfig.isPoliticsPage==true){var O=$j("#overWrap");var J=O.find("[id=fullSelection_"+N+"][marketId="+x.replace(".","_")+"]");if(J.length!=0){h(J,G,x,N,z,I,H,B)}}}}function h(C,x,F,B,E,D,A,z){if(D.length==0){C.find("#withoutBet").hide();C.find("#lossWithoutBet").hide()}if(E.length==0){C.find("#withBet").hide();C.find("#lossWithBet").hide()}if(D.length==0&&E.length==0){C.find("th").removeClass("predict");var y=EventType.getInstanceOf(z.eventType);if(y!=null&&y.isRacingEvent()){C.removeClass("predict")}}}function w(y,z,C,B,A){var x=$j(y);if(x.length!=0){if(B.length==0){x.find("#withoutBet").hide();x.find("#lossWithoutBet").hide()}if(C.length==0){x.find("#withBet").hide();x.find("#lossWithBet").hide()}if(B.length==0&&C.length==0){x.removeClass("predict")}}}BetHandler.clickCancelAll=function(y){v();var x=BetHandler.calculateTotalLiability();JsCache.get("#betSlipFullBtn").find("#total").html(CurrencyUtil.formatter(x));BetHandler.hideMsg("#errorMsg");g()};BetHandler.clickOdds=function(y,J,D,C,K,E){var G=$j(K);var z=G.attr("id");var L=E.find("#odds");var x=parseFloat(L.val())||0;var F=0;var B=DataBase.markets.get(y,J.replace("_","."));if(z=="oddsUp"){var H=OddsUtil.getIncrement(x,"increase");var I=H.increment;F=MathUtil.decimal.add(x,I);F=d(F,H.lowerBound,H.upperBound,I,null,B);if(MarketUtil.isLineMarket(B.marketType,B.bettingType)){F=MathUtil.decimal.add(x,1)}if(x==0){F=1.01}L.val(F)}else{if(z=="oddsDown"){var H=OddsUtil.getIncrement(x,"decrease");var A=H.increment;if(BetHandler.isLessThanMinOdds(x-A)){return}F=MathUtil.decimal.subtract(x,A);F=d(F,H.lowerBound,H.upperBound,A,null,B);if(MarketUtil.isLineMarket(B.marketType,B.bettingType)){F=MathUtil.decimal.subtract(x,1)}L.val(F)}}return DataBase.bet.updateOdds(y,J,D,C,F)};BetHandler.blurCheckStakeValid=function(z,C,A,B,E,x,G){var F=JsCache.get("#betMsg");if(E!=null){F=E}if(UnMatchTicketUtil.isValidStake(C,A,B)){F.hide();return B}var y=UnMatchTicketUtil.getValidStake(C,A,B);var D=BetHandler.getMinBet(x,G);z.val(y);F.html(I18N.get("msg.member.stake.increments",[D,CurrencyType.getInstanceOf(A).stakeMin]));F.show();return y};BetHandler.blurCheckOddsValidate=function(F,D,x,E){var z=DataBase.markets.get(x,E);var B=$j(F);var y=parseFloat(B.val())||0;var C=OddsUtil.getIncrement(y);var A=d(y,C.lowerBound,C.upperBound,C.increment,D,z);B.val(A)};function d(A,F,z,D,C,y){if(y!=null&&MarketUtil.isLineMarket(y.marketType,y.bettingType)){return A}var E=JsCache.get("#betMsg");if(C!=null){E=C}if(A>=2){var x=MathUtil.decimal.subtract(A,F);if(A<100){var B=MathUtil.decimal.multiply(x,100);var G=MathUtil.decimal.multiply(D,100);if((B%G)==0){E.hide();return A}E.html(I18N.get("msg.member.odds.increments",[F,z,D]));E.show();return MathUtil.decimal.add(F,MathUtil.decimal.multiply(D,Math.floor(B/G)))}if((x%D)==0){E.hide();return A}E.html(I18N.get("msg.member.odds.increments",[F,z,D]));E.show();return MathUtil.decimal.add(F,MathUtil.decimal.multiply(D,Math.floor(x/D)))}E.hide();return A}BetHandler.updateKeyupOdds=function(z,D,x,y,B){var A=$j(B);var C=parseFloat(A.val())||0;return DataBase.bet.updateOdds(z,D,x,y,C)};BetHandler.isLessThanMinOdds=function(x){if(x==undefined||x==null||isNaN(x)){return true}x=parseFloat(x);if(x<1.01){return true}return false};BetHandler.backOddsIsLessThanLayOdds=function(C,E,A,B){var x=DataBase.bet.get(C,E,A,B);var z=getAnotherSideType(B);var D=DataBase.bet.get(C,E,A,z);if(D!=null){var y=parseFloat(D.odds);if(isNaN(y)){y=1.01}if(SideType.Back.unique()==B){if(x.odds>y){return false}return true}if(x.odds<y){return false}return true}return false};BetHandler.getMinBet=function(y,z){var x=parseFloat(PageConfig.minBet);if(PageConfig.ENABLE_MARKET_BET_LIMIT_SETTING&&PageConfig.isCheckMarketBetLimitSetting&&y!=null&&z!=null){z=z.replace("_",".");var A=DataBase.markets.get(y,z);if(A!=null&&A.betLimitSetting!=null){x=parseFloat(A.betLimitSetting.minBet)}}return x};BetHandler.isLessThanMinStake=function(z,y){var A=parseInt(z.find("#inputStake").val());var x=BetHandler.getMinBet(z.attr("eventId"),z.attr("marketId"));if(A<x){BetHandler.showLessThanMinBetTips(z,x,y);return true}BetHandler.hideStakeTipsPopup(z);return false};BetHandler.showLessThanMinBetTips=function(B,A,z){var D=$j("[id=stakeTipsPopup][bet="+B.attr("id")+"]");if(D.length==0){D=JsCache.clone("#stakeTipsPopup");z.before(D);D.attr("bet",B.attr("id"));D.attr("stakeTipsPopupType","extended")}var y=CurrencyType.getInstanceOf(PageConfig.playerCurrency);var C={precision:2,separateSign:",",currencySymbol:y.symbol,formatter:CurrencyUtil.DefaultFormatter,"trailingZeros,":false};var x=PositionUtils.getPosition([B.find("#listPoint"),B.find("#listPoint").parent()]);D.css(x);D.html("Min "+CurrencyUtil.formatter(A,C)).show()};BetHandler.hideStakeTipsPopup=function(x){$j("[id=stakeTipsPopup][bet="+x.attr("id")+"]").remove()};BetHandler.showOddsTips=function(z,y){var A=$j("[id=oddsTipsPopup][bet="+z.attr("id")+"]");if(A.length==0){A=JsCache.clone("#oddsTipsPopup");y.before(A);A.attr("bet",z.attr("id"));A.attr("oddsTipsPopupType","extended")}var x=PositionUtils.getPosition([z.find("#oddsTipsPoint"),z.find("#oddsTipsPoint").parent()]);A.css(x);A.show()};BetHandler.hideOddsTips=function(x){$j("[id=oddsTipsPopup][bet="+x.attr("id")+"]").remove()};function j(z){var y=$j(z);var x=y.parent().parent();BetHandler.deleteBet(x);BetHandler.getWinLoss(x.attr("eventId"),x.attr("marketId"))}BetHandler.deleteBet=function(x){var A=x.parent();var z=parseInt(A.attr("count"));BetHandler.removeSelectClass(x.attr("eventId"),x.attr("marketId"),x.attr("selectionId"),x.attr("sideType"));DataBase.bet.remove(x.attr("eventId"),x.attr("marketId"),x.attr("selectionId"),x.attr("sideType"));x.remove();BetHandler.hideStakeTipsPopup(x);BetHandler.hideOddsTips(x);A.attr("count",--z);if(z==0){A.remove()}BetHandler.addToCookie();b();JsCache.get("#betMsg").hide();BetHandler.oddsAndStakeCheck();var y=BetHandler.calculateTotalLiability();JsCache.get("#betSlipFullBtn").find("#total").html(CurrencyUtil.formatter(y))};function v(){var B=JsCache.get("#betList");var x=B.find("dl");var A=[];$j.each(x,function(E,C){var D=$j(C);var H=D.parent();var F=parseInt(H.attr("count"));if(D.hasClass("sum")||D.is(":hidden")){return true}BetHandler.removeSelectClass(D.attr("eventId"),D.attr("marketId"),D.attr("selectionId"),D.attr("sideType"));DataBase.bet.remove(D.attr("eventId"),D.attr("marketId"),D.attr("selectionId"),D.attr("sideType"));D.remove();var G=D.attr("eventId")+"_"+D.attr("marketId").replace("_",".");if(ArrayUtil.indexOf(A,G)==-1){A.push(G)}H.attr("count",--F);if(F==0){H.remove()}BetHandler.hideStakeTipsPopup(D);BetHandler.hideOddsTips(D)});if(A.length>0){for(var y=0;y<A.length;y++){var z=A[y].split("_");BetHandler.getWinLoss(z[0],z[1])}}BetHandler.addToCookie();b();JsCache.get("#betMsg").hide();BetHandler.oddsAndStakeCheck()}function b(){var z=JsCache.get("#betList");var y=z.find("[id^=header_]");var x=0;$j.each(y,function(D,F){var C=$j(F);var E=C.find("[id^=bet_]");if(E.length!=0){x++}});if(x==0){JsCache.get("#betSlipBoard").hide();JsCache.get("#noBetSlipInfo").show()}else{JsCache.get("#betSlipBoard").show();JsCache.get("#noBetSlipInfo").hide()}var B=z.find('dl[sideType="1"]');if(B.length==0){z.find("#backSlipHeader").hide()}var A=z.find('dl[sideType="2"]');if(A.length==0){z.find("#laySlipHeader").hide()}}function k(z){var y=[];if(MultiMarketsHandler.isViewMultiMarket()||PageConfig.isPoliticsPage==true){z.forEach(function(A){y.push($j("[id^=multiMarket_"+A.eventId+"_"+A.marketId.replace(".","_")+"]"))})}else{if(PageConfig.selectEventId==-1){z.forEach(function(A){if(location.hash=="#InPlay"){y.push($j("#event_"+A.eventId))}else{y.push($j("#highLightEvent_"+A.eventId))}})}else{var x=$j("#fullMarketBetsWrap:visible");z.forEach(function(A){if(A.eventId==x.attr("eventid")&&A.marketId==x.attr("marketid")){y.push(x)}if($j("#popMarketItem_"+A.marketId.replace(".","_")).length>0){y.push($j("#popMarketItem_"+A.marketId.replace(".","_")))}})}}return y}function i(y,x){if(y.length>0){y.forEach(function(z){if(x){z.addClass("disabled");z.addClass("cooldown")}else{z.removeClass("cooldown");z.removeClass("disabled")}})}}BetHandler.openCallBack=function(){$j(".slip-wrap").removeClass("full-bet_slip");if(c){BetHandler.initBetListHeight()}};BetHandler.closeCallBack=function(){$j(".slip-wrap").addClass("full-bet_slip");if(c){BetHandler.initBetListHeight()}}})();if(typeof(DataBase)=="undefined"){DataBase={}}(function(){DataBase.bet={};var a=new HashMap();DataBase.bet.add=function(f,m,c,b,k,l,g,i,j,e,d){var h={sideType:f,odds:m,eventType:c,eventId:b,runner:k,marketId:l.replace(".","_"),selectionId:g,eventName:i,marketName:j,inPlay:e,timestamp:new Date().getTime(),marketType:d};a.put(DataBase.bet.generateKey(b,l,g,f),h);return h};DataBase.bet.generateKey=function(d,e,b,c){return d+"_"+e.replace(".","_")+"_"+b+"_"+c};DataBase.bet.updateOdds=function(f,h,c,e,g){var d=false;var b=DataBase.bet.get(f,h,c,e);if(b==null){return}if(b.odds==null||(b.odds!=null&&b.odds!=g)){d=true}b.odds=g;return d};DataBase.bet.updateStake=function(f,h,c,e,g){var d=false;var b=DataBase.bet.get(f,h,c,e);if(b==null){return}if(b.stake==null||(b.stake!=null&&b.stake!=g)){d=true}b.stake=g;return d};DataBase.bet.calculatePL=function(){var c=a.values();for(var d in c){var b=c[d];if(!b.sideType||!b.eventId||!b.marketId||!b.selectionId||!b.odds||!b.timestamp){continue}if(isNaN(b.stake)||b.stake==0){b.stake=0;b.profit=0;b.liability=0;continue}var e=b.sideType;if(SideType.Back.unique()==e){b.profit=UnMatchTicketUtil.getPL(b.odds,b.stake);b.liability=b.stake}else{if(SideType.Lay.unique()==e){b.profit=b.stake;b.liability=UnMatchTicketUtil.getPL(b.odds,b.stake)}}}};DataBase.bet.get=function(e,f,c,d){var b=DataBase.bet.generateKey(e,f,c,d);if(a.get(b)==null){return null}return a.get(b)};DataBase.bet.getByMarketId=function(c,d){var b=[];$j.each(a.values(),function(f,e){if(c==e.eventId&&d.replace(".","_")==e.marketId){b.push(e)}});return b};DataBase.bet.getBySelectionId=function(d,e,c){var b=[];$j.each(a.values(),function(g,f){if(d==f.eventId&&e.replace(".","_")==f.marketId&&c==f.selectionId){b.push(f)}});return b};DataBase.bet.remove=function(e,f,c,d){var b=DataBase.bet.generateKey(e,f,c,d);return a.remove(b)};DataBase.bet.queryAll=function(){return a.values()};DataBase.bet.queryForBets=function(){var b=[];$j.each(a.values(),function(d,c){if(!c.sideType||!c.eventId||!c.marketId||!c.selectionId||!c.stake||!c.odds||!c.timestamp){return true}b.push({sideType:c.sideType,odds:c.odds,stake:c.stake,eventType:c.eventType,eventId:c.eventId,marketId:c.marketId.replace("_","."),selectionId:c.selectionId,timestamp:c.timestamp})});return b};DataBase.bet.queryForCookie=function(){var b=[];$j.each(a.values(),function(d,c){var e=[c.sideType,c.odds,c.eventType,c.eventId,c.runner,c.marketId.replace(".","_"),c.selectionId,c.eventName,c.marketName,c.inPlay,c.timestamp,c.marketType];b.push(e)});return b};DataBase.bet.size=function(){return a.length};DataBase.bet.keySet=function(){return a.keySet()};DataBase.bet.entrySet=function(){return a.entrySet()}})();function checkIsNoElement(b){var c=0;$j.each(b,function(f,g){var e=$j(g);if(e.hasClass("sum")||e.is(":hidden")){return true}c++});if(c==0){b.find("#backSlipHeader").hide();b.find("#laySlipHeader").hide();return true}var d=b.find('dl[sideType="1"]');if(d.length==0){b.find("#backSlipHeader").hide()}var a=b.find('dl[sideType="2"]');if(a.length==0){b.find("#laySlipHeader").hide()}if(c!=0){return false}}function getAnotherSideType(a){if(SideType.Back.unique()==a){return SideType.Lay.unique()}return SideType.Back.unique()}function commaSeparateNumber(a){return a.toString().replace(/\D/g,"").replace(/\B(?=(\d{3})+(?!\d))/g,"")};