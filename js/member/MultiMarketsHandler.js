if(typeof(MultiMarketsHandler)=="undefined"){MultiMarketsHandler={}}(function(){var d={ADDPIN:"ADDPIN",BTNPIN:"BTNPIN"};MultiMarketsHandler.init=function(){MultiMarketsHandler.initFromCookie()};MultiMarketsHandler.bindPinEvent=function(k,h,i,j){var g=k.find("#multiMarketPin");MultiMarketsHandler.clickEvent(g,h,CategoryType.BETFAIR.unique(),i,j,k)};MultiMarketsHandler.clickEvent=function(h,g,m,i,l,k,j){h.unbind("click").click(function(){if(typeof(LoginHandler)!="undefined"&&!LoginHandler.userIsLogin()){return}if(f(h,j)){b(h,j);h.attr("title",I18N.get("msg.member.multiMarkets.removeFrom"));DataBase.multiMarkets.addMarketPk(g,m,i,l);MultiMarketsHandler.addToCookie()}else{a(h,j);h.attr("title",I18N.get("msg.member.multiMarkets.addTo"));DataBase.multiMarkets.removeMarketPk(g,m,i,l);MultiMarketsHandler.addToCookie();if(MultiMarketsHandler.isViewMultiMarket()==true&&k!=null){MultiMarketsHandler.removeMarketElemFromMultiMarket(k)}}})};function f(g,h){if(d.BTNPIN==h){return !g.hasClass("select")}return g.hasClass("add-pin")}function b(g,h){if(d.BTNPIN==h){g.addClass("select");return}g.attr("class","delete-pin")}function a(g,h){if(d.BTNPIN==h){g.removeClass("select");return}g.attr("class","add-pin")}MultiMarketsHandler.removeMarketElemFromMultiMarket=function(l){if(l.attr("name")!="multiMarketItem"){return}l.fadeOut();setTimeout(function(){l.remove()},1000);var j=DataBase.multiMarkets.queryAllByCategoryType(CategoryType.BETFAIR.unique());var h=DataBase.multiMarkets.queryAllByCategoryType(CategoryType.FANCY_BET.unique());var k=DataBase.multiMarkets.queryAllByCategoryType(CategoryType.SPORTRADAR_SPORTSBOOK.unique());var i=DataBase.multiMarkets.queryAllByCategoryType(CategoryType.OW_SPORTSBOOK.unique());var g=DataBase.multiMarkets.queryAllByCategoryType(CategoryType.BOOK_MAKER.unique());if(j.length==0&&h.length==0&&k.length==0&&i.length==0&&g.length==0){MemberPage.multiMarkets()}};MultiMarketsHandler.checkIsMultiMarket=function(h,j,g,p,l,o){if(typeof(o)=="undefined"){o=CategoryType.BETFAIR.unique()}var n=DataBase.multiMarkets.queryAllByCategoryType(o);for(var m=0;m<n.length;m++){var k=n[m];if(j==k.eventType&&g==k.eventId&&p==k.marketId){b(h,l);h.attr("title",I18N.get("msg.member.multiMarkets.removeFrom"));break}a(h,l);h.attr("title",I18N.get("msg.member.multiMarkets.addTo"))}};MultiMarketsHandler.appendGameHeadPin=function(h,i,l,k){var j=$j("#gameHead");var g=j.find("#multiMarketPin");MultiMarketsHandler.bindHeadPinEvent(g,h,i,l);g.show();if(k!=null){k.find("#gameHeadPinSpace").show()}};MultiMarketsHandler.appendLiveMatchTrackerPin=function(h,i,k){var j=$j("#overWrap");var g=j.find("#liveMultiMarketPin");MultiMarketsHandler.bindHeadPinEvent(g,h,i,k,d.BTNPIN);g.show()};MultiMarketsHandler.appendFancyBetPin=function(h,i,l){var k=$j("#fancyBetTable_"+i);var j=l?k.find("#fancyBetHead"):k.find("#fancyBetSpecialBet");var g=j.find("#multiMarketPin");MultiMarketsHandler.clickEvent(g,h,CategoryType.FANCY_BET.unique(),i,CategoryType.FANCY_BET.name,k);MultiMarketsHandler.checkIsMultiMarket(g,h,i,CategoryType.FANCY_BET.name,null,CategoryType.FANCY_BET.unique())};MultiMarketsHandler.appendSportsBookPin=function(g,h,o,j,l,p){var i;var m;var k;if(l){m=$j("#sportsBookTable_"+h);k=m.find("#sportsBookHead");i=k.find("#multiMarketPin")}else{m=$j("#sportsBookMarket_"+h);k=m.find("#marketHeader");i=k.find("#multiMarketPin")}var n=(ApiSiteType.SPORTRADAR.unique()==p)?CategoryType.SPORTRADAR_SPORTSBOOK.unique():CategoryType.OW_SPORTSBOOK.unique();MultiMarketsHandler.clickEvent(i,g,n,o,j,m);MultiMarketsHandler.checkIsMultiMarket(i,g,o,j,null,n)};MultiMarketsHandler.appendBookMakerPin=function(h,i,m,k){var l=k?$j("#bookMakerTable_"+i):$j("#bookMakerWrap");var j=k?l.find("#bookMakerHead"):l.find("#bookMakerSpecialBet");var g=j.find("#multiMarketPin");MultiMarketsHandler.clickEvent(g,h,CategoryType.BOOK_MAKER.unique(),i,m,l);MultiMarketsHandler.checkIsMultiMarket(g,h,i,m,null,CategoryType.BOOK_MAKER.unique())};MultiMarketsHandler.bindHeadPinEvent=function(h,g,i,k,j){MultiMarketsHandler.clickEvent(h,g,CategoryType.BETFAIR.unique(),i,k,null,j);MultiMarketsHandler.checkIsMultiMarket(h,g,i,k,j);h.attr("eventType",g);h.attr("eventId",i);h.attr("marketId",k)};MultiMarketsHandler.isHasMultiMarket=function(){var k=MultiMarketsHandler.readCookie();if(k==null){return false}var j=k[CategoryType.BETFAIR.unique()];var i=k[CategoryType.FANCY_BET.unique()];var h=k[CategoryType.SPORTRADAR_SPORTSBOOK.unique()];var g=k[CategoryType.OW_SPORTSBOOK.unique()];var l=k[CategoryType.BOOK_MAKER.unique()];if((j==null||j.length==0)&&(i==null||i.length==0)&&(h==null||h.length==0)&&(g==null||g.length==0)&&(l==null||l.length==0)){return false}else{return true}};MultiMarketsHandler.isHasFancybetMultiMarket=function(){var h=MultiMarketsHandler.readCookie();if(h==null){return false}var g=h[CategoryType.FANCY_BET.unique()];if(g!=null&&g.length>0){return true}else{return false}};MultiMarketsHandler.isHasSportsBookMultiMarket=function(){var h=MultiMarketsHandler.readCookie();if(h==null){return false}var g=h[CategoryType.SPORTRADAR_SPORTSBOOK.unique()];if(g!=null&&g.length>0){return true}else{return false}};MultiMarketsHandler.isHasOwSportsBookMultiMarket=function(){var h=MultiMarketsHandler.readCookie();if(h==null){return false}var g=h[CategoryType.OW_SPORTSBOOK.unique()];if(g!=null&&g.length>0){return true}else{return false}};MultiMarketsHandler.isHasBookMakerMultiMarket=function(){var g=MultiMarketsHandler.readCookie();if(g==null){return false}var h=g[CategoryType.BOOK_MAKER.unique()];if(h!=null&&h.length>0){return true}else{return false}};MultiMarketsHandler.isViewMultiMarket=function(){return location.href.indexOf("multiMarkets")>-1};MultiMarketsHandler.addToCookie=function(){var h=DataBase.multiMarkets.queryForCookie();if((h[CategoryType.BETFAIR.unique()].length+h[CategoryType.FANCY_BET.unique()].length+h[CategoryType.SPORTRADAR_SPORTSBOOK.unique()].length+h[CategoryType.OW_SPORTSBOOK.unique()].length+h[CategoryType.BOOK_MAKER.unique()].length)>20){return}var g=CookieUtil.getCookieDomainFormat(window.location.hostname);CookieUtil.setCookie("multiMarket_"+PageConfig.userID,JSON.stringify(h),999,null,g);MultiMarketsHandler.sendWebSocketParameter()};MultiMarketsHandler.readCookie=function(){var g=CookieUtil.getCookie("multiMarket_"+PageConfig.userID);var h=JSON.parse(g);return h};MultiMarketsHandler.initDataBase=function(){if(!MultiMarketsHandler.isHasMultiMarket()){return}var k=MultiMarketsHandler.readCookie();var j=k[CategoryType.BETFAIR.unique()];var i=k[CategoryType.FANCY_BET.unique()];var h=k[CategoryType.SPORTRADAR_SPORTSBOOK.unique()];var g=k[CategoryType.OW_SPORTSBOOK.unique()];var l=k[CategoryType.BOOK_MAKER.unique()];if(j!=null&&j.length>0){$j.each(j,function(m,n){if(n.length!=3){return true}DataBase.multiMarkets.addMarketPk(n[0],CategoryType.BETFAIR.unique(),n[1],n[2])})}if(i!=null&&i.length>0){$j.each(i,function(m,n){if(n.length!=2){return true}DataBase.multiMarkets.addMarketPk(n[0],CategoryType.FANCY_BET.unique(),n[1],CategoryType.FANCY_BET.name)})}if(h!=null&&h.length>0){$j.each(h,function(m,n){if(n.length!=3){return true}DataBase.multiMarkets.addMarketPk(n[0],CategoryType.SPORTRADAR_SPORTSBOOK.unique(),n[1],n[2])})}if(g!=null&&g.length>0){$j.each(g,function(m,n){if(n.length!=3){return true}DataBase.multiMarkets.addMarketPk(n[0],CategoryType.OW_SPORTSBOOK.unique(),n[1],n[2])})}if(l!=null&&l.length>0){$j.each(l,function(m,n){if(n.length!=3){return true}DataBase.multiMarkets.addMarketPk(n[0],CategoryType.BOOK_MAKER.unique(),n[1],n[2])})}};MultiMarketsHandler.checkAndAddBetfairDataBase=function(g,h){if(g!=null&&g.length>0){var i=[];$j.each(g,function(j,l){if(l.length!=3){return true}var k={eventType:l[0],eventId:l[1],marketId:l[2],selectionTs:-1};i.push(k)});$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.queryMultiMarketsPath,data:{marketPks:JSON.stringify(i)},success:function(m){try{var r=m.multiMarkets;if(r.length!=i.length){DataBase.multiMarkets.removeAllByCategoryType(CategoryType.BETFAIR.unique())}for(var n=0;n<r.length;n++){var q=r[n];var k=q.eventType;var j=q.eventId;var t=q.marketId;var l=q.market;if(l==null){continue}DataBase.markets.update(j,[l]);DataBase.multiMarkets.addMarketPk(k,CategoryType.BETFAIR.unique(),j,t);var s=null;if(h==true&&n==(r.length-1)){s=function(){return function(){MemberPage.multiMarkets()}}()}var p=true;EventHandler.checkEvents(k,j,p,s)}MultiMarketsHandler.addToCookie()}catch(o){Trace.printStackTrace(o)}},error:function(j){Trace.printStackTrace(j)}})}};MultiMarketsHandler.checkAndAddFancybetDataBase=function(h,i){if(h!=null&&h.length>0){var g=[];$j.each(h,function(j,l){if(l.length!=2){return true}var k={eventType:l[0],eventId:l[1],version:-1,oddsSettingVersion:-1};g.push(k)});$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.landingPath+"/member/playerService/queryFancyBetMultiMarkets",data:{marketPks:JSON.stringify(g)},success:function(m){try{var o=m.fancyBets;if(o.length!=g.length){DataBase.multiMarkets.removeAllByCategoryType(CategoryType.FANCY_BET.unique())}for(var n=0;n<o.length;n++){var k=o[n];var l=k.fancyBetMarkets[0].eventType;var j=k.fancyBetMarkets[0].eventId;var s=CategoryType.FANCY_BET.name;DataBase.fancyBetMarkets.update(j,k.fancyBetMarkets);DataBase.multiMarkets.addMarketPk(l,CategoryType.FANCY_BET.unique(),j,s);var r=null;if(i==true&&n==(o.length-1)){r=function(){return function(){MemberPage.multiMarkets()}}()}var q=true;EventHandler.checkEvents(l,j,q,r)}MultiMarketsHandler.addToCookie()}catch(p){Trace.printStackTrace(p)}},error:function(j){Trace.printStackTrace(j)}})}};MultiMarketsHandler.checkAndAddSportsBookDataBase=function(h,i,g){if(h!=null&&h.length>0){var j=[];$j.each(h,function(k,m){if(m.length!=3){return true}var l={eventType:m[0],betfairEventId:m[1],marketId:m[2],selectionTs:-1,apiSiteType:g};j.push(l)});$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.landingPath+"/member/playerService/querySportsBookMultiMarkets",data:{marketPks:JSON.stringify(j)},success:function(o){try{var r=o.sportsBookEvents;var x=(ApiSiteType.SPORTRADAR.unique()==g)?CategoryType.SPORTRADAR_SPORTSBOOK.unique():CategoryType.OW_SPORTSBOOK.unique();if(j.length!=r.length){DataBase.multiMarkets.removeAllByCategoryType(x)}for(var s=0;s<r.length;s++){var p=r[s];var k=p.eventId;var l=p.sportsBookMarket;DataBase.sportsBookMarkets.update(g,k,l);for(var q in l){var n=l[q];var y=n.id;var m=n.eventType;var w=n.betfairEventId;DataBase.multiMarkets.addMarketPk(m,x,w,y)}var v=null;if(i==true&&s==(r.length-1)){v=function(){return function(){MemberPage.multiMarkets()}}()}var u=true;EventHandler.checkEvents(m,k,u,v)}MultiMarketsHandler.addToCookie()}catch(t){Trace.printStackTrace(t)}},error:function(k){Trace.printStackTrace(k)}})}};MultiMarketsHandler.checkAndAddBookMakerDataBase=function(i,h){if(i!=null&&i.length>0){var g=[];$j.each(i,function(j,l){if(l.length!=3){return true}var k={eventType:l[0],eventId:l[1],marketId:l[2],version:-1,oddsSettingVersion:-1};g.push(k)});$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.landingPath+"/member/playerService/queryBookMakerMultiMarkets",data:{marketPks:JSON.stringify(g)},success:function(p){try{var v=p.bookMakerInfos;var x=CategoryType.BOOK_MAKER.unique();if(g.length!=v.length){DataBase.multiMarkets.removeAllByCategoryType(x)}for(var r=0,s=v.length;r<s;r++){var n=v[r];var k=n.bookMakerEvent.eventId;var m=n.bookMakerEvent.eventType;var l=n.bookMakerMarket.markets;DataBase.bookMakerMarkets.update(k,l);for(var q in l){var o=l[q];var y=o.marketId;DataBase.multiMarkets.addMarketPk(m,x,k,y)}var w=null;if(h==true&&r==(v.length-1)){w=function(){return function(){MemberPage.multiMarkets()}}()}var u=true;EventHandler.checkEvents(m,k,u,w)}MultiMarketsHandler.addToCookie()}catch(t){Trace.printStackTrace(t)}},error:function(j){Trace.printStackTrace(j)}})}};MultiMarketsHandler.initFromCookie=function(l){if(!MultiMarketsHandler.isHasMultiMarket()){if(l==true){MemberPage.multiMarkets()}return}var i=MultiMarketsHandler.readCookie();var k=i[CategoryType.BETFAIR.unique()];var j=i[CategoryType.FANCY_BET.unique()];var h=i[CategoryType.SPORTRADAR_SPORTSBOOK.unique()];var g=i[CategoryType.OW_SPORTSBOOK.unique()];var m=i[CategoryType.BOOK_MAKER.unique()];MultiMarketsHandler.checkAndAddBetfairDataBase(k,l);MultiMarketsHandler.checkAndAddFancybetDataBase(j,l);MultiMarketsHandler.checkAndAddSportsBookDataBase(h,l,ApiSiteType.SPORTRADAR.unique());MultiMarketsHandler.checkAndAddSportsBookDataBase(g,l,ApiSiteType.OW.unique());MultiMarketsHandler.checkAndAddBookMakerDataBase(m,l)};MultiMarketsHandler.webSocketUtil=null;MultiMarketsHandler.initWebSocket=function(){var i=DataBase.multiMarkets.queryMarketPks(true);if(i.length==0){return}if(MultiMarketsHandler.webSocketUtil==null){MultiMarketsHandler.webSocketUtil=new WebSocketUtil()}if(!MultiMarketsHandler.webSocketUtil.isSupportWebSocket()){return}var h="/member/marketOddsService?isMultiMarket=true";var g=function(j){try{j=JSON.parse(j)}catch(k){Trace.log(k);return}MultiMarketsHandler.updateMultiMarketList(j,true)};if(MultiMarketsHandler.webSocketUtil.getReadyState()==null||MultiMarketsHandler.webSocketUtil.getReadyState()==3){MultiMarketsHandler.webSocketUtil.initialize(h,g)}MultiMarketsHandler.sendWebSocketParameter()};function e(){var h=DataBase.multiMarkets.queryMarketPks(true);var g={};g.multiMarketKey=[];if(h.length==0){return JSON.stringify(g)}g.multiMarketKey=h;return JSON.stringify(g)}MultiMarketsHandler.sendWebSocketParameter=function(){try{if(MultiMarketsHandler.webSocketUtil!=null){var h=e();MultiMarketsHandler.webSocketUtil.send(h);MultiMarketsHandler.webSocketUtil.parameter=h}}catch(g){Trace.printStackTrace(g)}};MultiMarketsHandler.isWebSocketUpdateMarket=function(j,k){var l=DataBase.multiMarkets.queryMarketPks(true);for(var g in l){var h=l[g];if(h.eventId==j&&h.marketId==k){return true;break}}return false};MultiMarketsHandler.isEnableMultiMarketWebSocket=function(){if(PageConfig.ENABLE_MULTI_MARKET_WEBSOCKET=="true"){if(PageConfig.ENABLE_WEBSOCKET_ONLY_MAZAPLAY=="true"){if(PageConfig.webSiteType==WebSiteType.MAZAPLAY.unique()){return true}else{return false}}else{return true}}return false};MultiMarketsHandler.getMultiMarketsTask=null;MultiMarketsHandler.initTask=function(){if(MultiMarketsHandler.getMultiMarketsTask==null){var g=TaskExecuterV2.createTask(PageConfig.getMultiMarketsTaskCycleTime,0,function(){c(this)});MultiMarketsHandler.getMultiMarketsTask=g}else{MultiMarketsHandler.getMultiMarketsTask.isStop=false}MultiMarketsHandler.getMultiMarketsTask.run();TaskExecuterV2.execute()};MultiMarketsHandler.abortTask=function(){if(MultiMarketsHandler.getMultiMarketsTask!=null){MultiMarketsHandler.getMultiMarketsTask.stop()}};function c(g){var h=DataBase.multiMarkets.queryAllByCategoryType(CategoryType.BETFAIR.unique());if(PageConfig.highlightEventType!=-1||PageConfig.selectEventId!=-1||PageConfig.selectMarketId!=null||h==null||h.length==0){g.check();TaskExecuterV2.execute();return}$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.queryMultiMarketsPath,data:{marketPks:JSON.stringify(h)},success:function(l){try{var r=l.multiMarkets;for(var m=0;m<r.length;m++){var q=r[m];var j=q.eventId;var k=q.market;if(k==null){continue}DataBase.markets.update(j,[k])}MultiMarketsHandler.updateMultiMarketList(l,false);if(MultiMarketsHandler.isEnableMultiMarketWebSocket()){var n=DataBase.multiMarkets.queryMarketPks(true);if(n.length==0){return}var p=e();if(MultiMarketsHandler.webSocketUtil==null||MultiMarketsHandler.webSocketUtil.parameter!=p){if(MultiMarketsHandler.webSocketUtil==null||MultiMarketsHandler.webSocketUtil.getReadyState()==3){MultiMarketsHandler.initWebSocket()}MultiMarketsHandler.sendWebSocketParameter()}}}catch(o){Trace.printStackTrace(o)}finally{g.check();TaskExecuterV2.execute()}},error:function(){g.check();TaskExecuterV2.execute()}})}MultiMarketsHandler.updateMultiMarketList=function(g,m){var h=$j("#multiMarketsWrap");var k=g.multiMarkets;for(var j=0;j<k.length;j++){var l=k[j];if(m){MultiMarketsHandler.updateMultiMarketByWebSocket(h,l)}else{MultiMarketsHandler.updateMultiMarket(h,l)}}};MultiMarketsHandler.updateMultiMarket=function(m,s){var h=s.eventType;var g=s.eventId;var t=s.marketId;var j=g+"_"+t.replace(".","_");var n=s.eventName;var l=s.market;var p=s.gameProductStatus;var o=(MarketUtil.isCloseSite(l.closeSite,PageConfig.webSiteType)||EventUtils.isCloseSite(s.eventCloseSite,PageConfig.webSiteType)||CompetitionUtils.isCloseSite(s.competitionCloseSite,PageConfig.webSiteType));if(DataBase.multiMarkets.getMarketPk(h,CategoryType.BETFAIR.unique(),g,t)==null){return}var r=m.find("#multiMarket_"+j);if(r.length==0){if(MarketUtil.isClosed(l.status)||o){DataBase.multiMarkets.removeMarketPk(h,CategoryType.BETFAIR.unique(),g,t);MultiMarketsHandler.addToCookie();return}r=m.find("#multiMarketsTemplate").clone();r.attr("id","multiMarket_"+j);r.attr("eventType",h);r.attr("eventId",g);r.attr("marketId",t);r.attr("name","multiMarketItem");r.find("#multiMarketPin").attr("class","delete-pin");r.find("#multiMarketPin").attr("title",I18N.get("msg.member.multiMarkets.removeFrom"));MultiMarketsHandler.bindPinEvent(r,h,g,t);BetHandler.addSelectClass();m.find("#header").after(r.show())}else{if(MarketUtil.isClosed(l.status)||o){DataBase.multiMarkets.removeMarketPk(h,CategoryType.BETFAIR.unique(),g,t);MultiMarketsHandler.addToCookie();r.hide();return}r.show()}MultiMarketsHandler.appendMultiMarketInfo(r,g,n,l,h);FullMarketUtil.updateFullMarket(r,r.find("#multiMarketBoard"),h,g,t,l,p);if(PageConfig.ENABLE_JOCKEY_COLOR){if(EventType.GREYHOUND_RACING.unique()==h){r.find("#multiMarketBoard").removeClass("bets").addClass("bets-GH")}var i=l.selections;if(i==null||i.length==0||i[0]==null||i[0].runnerMetadata==null){return}var k=DataBase.multiMarkets.getMarketPk(h,CategoryType.BETFAIR.unique(),g,t);k.isGetRunnerMetadata=false;try{var u=JSON.parse(i[0].runnerMetadata);if(u!=null&&u.COLOURS_FILENAME!=null){r.find("#multiMarketBoard").removeClass("bets").addClass("bets-HS")}}catch(q){Trace.log(q)}}};MultiMarketsHandler.updateMultiMarketByWebSocket=function(h,l){var i=l.eventType;var k=l.eventId;var m=l.marketId;var j=k+"_"+m.replace(".","_");var g=h.find("#multiMarket_"+j);if(g.length>0){FullMarketUtil.updateSelection(g,g.find("#multiMarketBoard"),i,k,m,l.selections,true,l.gameProductStatus)}};MultiMarketsHandler.appendMultiMarketInfo=function(m,g,l,i,h){var k=m.find("#eventHeader");var n="";var q="";var o="";var p=i.marketId;if(i.inPlay==1&&!MarketUtil.isClosed(i.status)){o='<img class="icon-irun" src="/images/transparent.gif" />'}n=l;q='<span id="marketName" class="multi-event_type">'+i.marketName+"</span>"+o;var j=function(s,r){return function(){location.href=PageConfig.fullMarketPath+"?eventType="+h+"&eventId="+g+"&marketId="+p}}(g,p,h);k.html(n+q);k.click(j);if(BetHandler.isEnableCheckLowLiquidity()){if(BetHandler.isLowLiquidity(h,g,i.marketId.replace("_","."))){FullMarketUtil.showLowLiquidityTag(m.find("#lowLiquidityTag"),true)}else{FullMarketUtil.showLowLiquidityTag(m.find("#lowLiquidityTag"),false)}}};MultiMarketsHandler.getMultiMarket=function(){var g=DataBase.multiMarkets.queryAllByCategoryType(CategoryType.BETFAIR.unique());if(PageConfig.highlightEventType!=-1||PageConfig.selectEventId!=-1||PageConfig.selectMarketId!=null||g==null||g.length==0){return}$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.queryMultiMarketsPath,data:{marketPks:JSON.stringify(g)},success:function(h){try{MultiMarketsHandler.updateMultiMarketList(h,false)}catch(i){Trace.printStackTrace(i)}},error:function(h){Trace.printStackTrace(h)}})}})();if(typeof(DataBase)=="undefined"){DataBase={}}(function(){DataBase.multiMarkets={};var a=new HashMap();a.put(CategoryType.BETFAIR.unique(),new HashMap());a.put(CategoryType.FANCY_BET.unique(),new HashMap());a.put(CategoryType.SPORTRADAR_SPORTSBOOK.unique(),new HashMap());a.put(CategoryType.OW_SPORTSBOOK.unique(),new HashMap());a.put(CategoryType.BOOK_MAKER.unique(),new HashMap());DataBase.multiMarkets.addMarketPk=function(d,i,g,h){var f=a.get(i);var b=f.keySet();var c=DataBase.multiMarkets.generateKey(g,h);var e={eventType:d,eventId:g,marketId:h,selectionTs:-1};if(CategoryType.BETFAIR.unique()==i&&EventType.HORSE_RACING.unique()==d){e.isGetRunnerMetadata=true}if(ArrayUtil.indexOf(b,c)==-1){f.put(c,e)}};DataBase.multiMarkets.getMarketPk=function(c,f,d,e){var b=DataBase.multiMarkets.generateKey(d,e);return a.get(f).get(b)};DataBase.multiMarkets.removeMarketPk=function(c,f,d,e){var b=DataBase.multiMarkets.generateKey(d,e);a.get(f).remove(b)};DataBase.multiMarkets.queryAllByCategoryType=function(b){return a.get(b).values()};DataBase.multiMarkets.queryMarketPks=function(f){var b=[];var c=a.get(CategoryType.BETFAIR.unique()).values();for(var d in c){var e=c[d];var g=DataBase.markets.get(e.eventId,e.marketId);if(g==null){continue}if(f){if(g.inPlay==1&&g.marketType=="MATCH_ODDS"){b.push(e)}}else{if(g.inPlay==1&&g.marketType=="MATCH_ODDS"){continue}b.push(e)}}return b};DataBase.multiMarkets.queryForCookie=function(){var f={};var e=[];var d=[];var c=[];var b=[];var g=[];$j.each(DataBase.multiMarkets.queryAllByCategoryType(CategoryType.BETFAIR.unique()),function(h,i){e.push([i.eventType,i.eventId,i.marketId])});$j.each(DataBase.multiMarkets.queryAllByCategoryType(CategoryType.FANCY_BET.unique()),function(h,i){d.push([i.eventType,i.eventId])});$j.each(DataBase.multiMarkets.queryAllByCategoryType(CategoryType.SPORTRADAR_SPORTSBOOK.unique()),function(h,i){c.push([i.eventType,i.eventId,i.marketId])});$j.each(DataBase.multiMarkets.queryAllByCategoryType(CategoryType.OW_SPORTSBOOK.unique()),function(h,i){b.push([i.eventType,i.eventId,i.marketId])});$j.each(DataBase.multiMarkets.queryAllByCategoryType(CategoryType.BOOK_MAKER.unique()),function(h,i){g.push([i.eventType,i.eventId,i.marketId])});f[CategoryType.BETFAIR.unique()]=e;f[CategoryType.FANCY_BET.unique()]=d;f[CategoryType.SPORTRADAR_SPORTSBOOK.unique()]=c;f[CategoryType.OW_SPORTSBOOK.unique()]=b;f[CategoryType.BOOK_MAKER.unique()]=g;return f};DataBase.multiMarkets.generateKey=function(b,c){return b+"_"+c.replace(".","_")};DataBase.multiMarkets.updateSelectionTs=function(b,d,e,f){var c=DataBase.multiMarkets.getMarketPk(b,CategoryType.BETFAIR.unique(),d,e);c.selectionTs=f};DataBase.multiMarkets.removeAllByCategoryType=function(b){a.put(b,new HashMap())}})();