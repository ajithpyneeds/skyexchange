if(typeof(MarketHandler)=="undefined"){MarketHandler={}}(function(){MarketHandler.getMarketsTask=null;MarketHandler.initGetMarketsTask=function(){MarketHandler.getMarketsTask=TaskExecuter.createTask(PageConfig.queryMarketsWithoutSelectionCycleTimes,0,function(){a(this)});MarketHandler.getMarketsTask.run();TaskExecuter.execute()};function a(b){if(PageConfig.selectEventId==-1||PageConfig.selectMarketId!=null){b.check();TaskExecuter.execute();return}$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.queryMarketsWithoutSelectionPath,data:{eventType:PageConfig.selectEventType,eventId:PageConfig.selectEventId},success:function(c){try{if(!c){return}JsCache.get("#listBoardLoading").hide();JsCache.get("#loading").hide();if(c.eventId==null||c.markets.length==0){return}DataBase.markets.update(c.eventId,c.markets);MarketHandler.updateMarkets(c.eventId,c.markets)}catch(d){Trace.printStackTrace(d)}finally{b.check();TaskExecuter.execute()}},error:function(){b.check();TaskExecuter.execute()}})}MarketHandler.updateMarkets=function(e,b){var h=$j("#listBoard");var f=DataBase.events.get(PageConfig.selectEventType,e);if(f==null){return}for(var c=0;c<b.length;c++){var j=b[c];if(j==null||j.marketId==null){continue}var d=h.find("#naviMenu_"+j.marketId.replace(".","_"));if(MarketUtil.isClosed(j.status)||MarketUtil.isCloseSite(j.closeSite,PageConfig.webSiteType)){if(d.length>0){d.remove()}}if(j.inPlay==1){if(d.length>0){var g=d.find("#name").find("img");g.removeClass("icon-no_play");g.addClass("icon-in_play")}}else{if(d.length>0){var g=d.find("#name").find("img");g.removeClass("icon-in_play");g.addClass("icon-no_play")}}}};MarketHandler.checkMarkets=function(c,d,e,b){if(b==true){return}if(e.indexOf("_")>=0){e=e.replace("_",".")}var f=DataBase.markets.get(d,e);if(f==null&&d!=-1){$j.ajax({type:"POST",dataType:"JSON",url:"/member/playerService/queryMarkets",data:{eventType:c,eventId:d,selectionTs:-1},success:function(g){try{if(g.markets.length>0){DataBase.markets.update(g.eventId,g.markets)}}catch(h){Trace.printStackTrace(h)}},error:function(g){Trace.error("eventId: "+d+" marketId: "+e+g)}})}};MarketHandler.sortRule=function(h,c,b,e,g,f){var d=h.localeCompare(c);if(h=="Match Odds"){return -1}if(c=="Match Odds"){return 1}if(h=="Moneyline"){return -1}if(c=="Moneyline"){return 1}if(b!=e){return e-b}if(EventType.SOCCER.unique()==EventType.getInstanceOf(PageConfig.selectEventType).unique()){if(h=="Correct Score"){return -1}if(c=="Correct Score"){return 1}if(h=="Over/Under 2.5 Goals"){return -1}if(c=="Over/Under 2.5 Goals"){return 1}if(h.indexOf("Over/Under")>=0&&c.indexOf("Over/Under")>=0){return d}if(h.indexOf("Over/Under")>=0){return -1}if(c.indexOf("Over/Under")>=0){return 1}}return g.localeCompare(f)}})();if(typeof(DataBase)=="undefined"){DataBase={}}(function(){DataBase.markets={};var a=new TreeMap();DataBase.markets.update=function(c,n){var d=a.get(c);if(d==null){d=new TreeMap();a.put(c,d)}for(var l=0;l<n.length;l++){var f=n[l];var g=d.get(f.marketId);if(g==null){d.put(f.marketId,f)}else{if(f.selections.length==0){f.selections=g.selections;d.put(f.marketId,f)}else{for(var h=0;h<f.selections.length;h++){var m=f.selections[h];for(var e=0;e<g.selections.length;e++){var b=g.selections[e];if(b.selectionId==m.selectionId){g.selections[e]=m}}}if(g.selections==0){g.selections=f.selections}else{f.selections=g.selections}d.put(f.marketId,f)}}}};DataBase.markets.get=function(b,d){var c=a.get(b);if(c==null){return null}return c.get(d)};DataBase.markets.queryByEvent=function(b){var c=a.get(b);if(c==null){c=new TreeMap();a.put(b,c)}return c.values()};DataBase.markets.getSelection=function(b,l,g){var c=a.get(b);if(c==null){return null}var e=c.get(l);var d=e.selections;var j=null;for(var f=0,h=d.length;f<h;f++){var k=d[f];if(k.selectionId!=g){continue}j=k}return j}})();