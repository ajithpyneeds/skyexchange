if(typeof(TxnHandler)=="undefined"){TxnHandler={}}(function(){TxnHandler.unTask;var i=0;var q="";var y="";TxnHandler.isShowBetInfo=false;TxnHandler.isShowAverageOdds=false;TxnHandler.isShowConsolidate=false;var t=true;TxnHandler.marketPks=[];TxnHandler.userIsEditPersistence=false;var f=false;TxnHandler.init=function(){UiUtils.bindToExpand($j(".slip-wrap .to-expand"),function(){$j(".matched-wrap").css("height","calc(100% - 301px)")},function(){$j(".matched-wrap").css("height","calc(100% - 26px)")});UiUtils.bindToExpand($j(".matched-wrap .to-expand"),BetHandler.openCallBack,BetHandler.closeCallBack);$j(".main_wrap > ul > li > a").removeClass("select");TxnHandler.checkOpenOptionFromCookie();JsCache.get("#selectMenu").change(function(){TxnHandler.getEventIdAndMarketId(this);TxnHandler.refreshOpenBets();TxnHandler.userIsEditPersistence=false});JsCache.get("#openBetsRefresh").click(function(){JsCache.get("#processingImg").show();JsCache.get("#matchSection").hide();TxnHandler.unTask.reset();TxnHandler.unTask.refresh();setTimeout(function(){JsCache.get("#processingImg").hide();JsCache.get("#matchSection").show()},1000)});JsCache.get("#showBetInfo").click(function(){if(TxnHandler.isShowBetInfo==true){TxnHandler.isShowBetInfo=false;TxnHandler.addOpenOptionToCookie(0)}else{TxnHandler.isShowBetInfo=true;TxnHandler.addOpenOptionToCookie(1)}TxnHandler.isShowAverageOdds=false;TxnHandler.isShowConsolidate=false;TxnHandler.clickOpenOption();TxnHandler.refreshOpenBets()});JsCache.get("#consolidate").click(function(){if(TxnHandler.isShowConsolidate==true){TxnHandler.isShowConsolidate=false;TxnHandler.addOpenOptionToCookie(0)}else{TxnHandler.isShowConsolidate=true;TxnHandler.addOpenOptionToCookie(2)}TxnHandler.isShowBetInfo=false;TxnHandler.isShowAverageOdds=false;TxnHandler.clickOpenOption();TxnHandler.refreshOpenBets()});JsCache.get("#averageOdds").click(function(){if(TxnHandler.isShowAverageOdds==true){TxnHandler.isShowAverageOdds=false;TxnHandler.addOpenOptionToCookie(0)}else{TxnHandler.isShowAverageOdds=true;TxnHandler.addOpenOptionToCookie(3)}TxnHandler.isShowBetInfo=false;TxnHandler.isShowConsolidate=false;TxnHandler.clickOpenOption();TxnHandler.refreshOpenBets()});JsCache.get("#okBtn").click(function(){TxnHandler.updateUnMatchTicketList()});JsCache.get("#okBtn").keydown(function(L){var K=L.which;if(KeyEventUtils.isEnterKey(K)){JsCache.get("#okBtn").click()}});JsCache.get("#editAllBets").click(function(){TxnHandler.userIsEditPersistence=true;TxnHandler.clickEditBetBtn()});JsCache.get("#editAllBets").keyup(function(L){var K=L.which;if(KeyEventUtils.isEnterKey(K)){JsCache.get("#editAllBets").click()}});JsCache.get("#resetBtn").click(function(){TxnHandler.clickResetBtn()});JsCache.get("#resetBtn").keyup(function(L){var K=L.which;if(KeyEventUtils.isEnterKey(K)){JsCache.get("#resetBtn").click()}});JsCache.get("[id^=cancelAllUnMatch]").click(function(){TxnHandler.cancelAllUnMatchTickets(this)});JsCache.get("[id^=cancelAllUnMatch]").keydown(function(L){var K=L.which;if(KeyEventUtils.isEnterKey(K)){TxnHandler.cancelAllUnMatchTickets(this)}});JsCache.get("#openBetSlip").scroll(function(){CoinHandler.hideStakePopupList();var L=$j("[id^=editUnMatched_]");for(var K=0;K<L.length;K++){var M=$j(L[K]);BetHandler.hideStakeTipsPopup(M);BetHandler.hideOddsTips(M)}});TxnHandler.userIsEditPersistence=false;TxnHandler.checkToHideOpenBets();f=true};TxnHandler.getEventIdAndMarketId=function(L){var K=$j("#openBetSelectionBox").find("select :selected");i=parseInt(K.attr("eventId"));q=K.attr("marketId");y=parseInt(K.attr("categorytype"))};TxnHandler.setEventIdAndMarketId=function(K,M,L){i=K;q=M.replace("_",".");y=L};TxnHandler.getBettingMarketIdFromEventId=function(M){var L=DataBase.unMatchTicket.getByEventId(M,CategoryType.BETFAIR.unique());var K=DataBase.txn.getByEventId(M,CategoryType.BETFAIR.unique());if(L.length==0&&K.length==0){return null}if(L.length>0){return L[0].marketId}else{if(K.length>0){return K[0].marketId}}};TxnHandler.changeOpenBetInFullMarkets=function(M,N){var L=DataBase.unMatchTicket.getByMarketId(M,N,null,CategoryType.BETFAIR.unique());var K=DataBase.txn.getByMarketId(M,N,null,null,CategoryType.BETFAIR.unique());if(L.length>0||K.length>0){TxnHandler.setEventIdAndMarketId(M,N,CategoryType.BETFAIR.unique());TxnHandler.updateOpenBetSelectionBox();TxnHandler.addBlankSelectOption(PageConfig.selectEventId,PageConfig.selectMarketId);TxnHandler.refreshOpenBets()}};TxnHandler.addBlankSelectOption=function(K,S){if(K==-1&&S==null){TxnHandler.removeBlankSelectOption();return}var P=$j("#openBetSelectionBox");var O=true;var R=true;if(S==null){O=TxnHandler.getBettingMarketIdFromEventId(K)==null?true:false}else{var L=DataBase.unMatchTicket.getByMarketId(K,S,null,CategoryType.BETFAIR.unique());var M=DataBase.txn.getByMarketId(K,S,null,null,CategoryType.BETFAIR.unique());if(L.length>0||M.length>0){R=false}}if(O&&R){var Q=P.find("option:selected");Q.prop("selected",false);if(P.find("#option0").length==0){var N=JsCache.clone("#optionTemplate");N.attr("id","option0");N.attr("eventType",0).attr("eventId",0).attr("marketId",0);N.html(" -- "+I18N.get("form.text.bet.select")+" -- ");N.attr("date",-1);N.prop("selected","selected");P.find("#selectMenu").append(N.show())}TxnHandler.refreshOpenBets()}else{if(!PageConfig.isPoliticsPage){TxnHandler.removeBlankSelectOption()}}};TxnHandler.removeBlankSelectOption=function(){var K=$j("#openBetSelectionBox");if(K.find("#option0").length!=0){K.find("#option0").remove()}if(PageConfig.selectEventId!=null&&PageConfig.selectMarketId!=null){TxnHandler.setEventIdAndMarketId(PageConfig.selectEventId,PageConfig.selectMarketId,CategoryType.BETFAIR.unique())}else{if(PageConfig.selectEventId!=null&&PageConfig.selectMarketId==null){var L=TxnHandler.getBettingMarketIdFromEventId(PageConfig.selectEventId);if(L!=null){TxnHandler.setEventIdAndMarketId(PageConfig.selectEventId,L,CategoryType.BETFAIR.unique())}}}TxnHandler.updateOpenBetSelectionBox()};TxnHandler.refreshOpenBets=function(){var P=null;var L=null;if(TxnHandler.userIsEditPersistence){k();P=JsCache.get("#editUnMatchedList");L=JsCache.get("#editUnMatchFullBtn")}else{I();P=JsCache.get("#unMatchTicketList");L=JsCache.get("#unMatchFullBtn")}z();var N=DataBase.unMatchTicket.getByMarketId(i,q,null,y);var O=TxnHandler.getMarketTxnByCategoryType(i,q,null,null,y);var R=DataBase.unMatchTicket.getByMarketId(i,q,SideType.Back.unique(),y);var M=DataBase.unMatchTicket.getByMarketId(i,q,SideType.Lay.unique(),y);var K=TxnHandler.getMarketTxnByCategoryType(i,q,SideType.Back.unique(),null,y);var T=TxnHandler.getMarketTxnByCategoryType(i,q,SideType.Lay.unique(),null,y);if(N.length==0){JsCache.get("#unMatchTicketHead").hide();JsCache.get("#unMatchTicketList").hide();JsCache.get("#unMatchFullBtn").hide();JsCache.get("#editUnMatchedList").hide();JsCache.get("#editUnMatchFullBtn").hide()}else{JsCache.get("#unMatchTicketHead").show();P.show();L.show()}if(R.length==0){JsCache.get("#editUnMatchedList").find("#backSlipHeader").hide();JsCache.get("#unMatchTicketList").find("#backSlipHeader").hide()}else{P.find("#backSlipHeader").show()}if(M.length==0){JsCache.get("#editUnMatchedList").find("#laySlipHeader").hide();JsCache.get("#unMatchTicketList").find("#laySlipHeader").hide()}else{P.find("#laySlipHeader").show()}var S=$j("#openBetSlip");if(O.length==0){JsCache.get("#txnHead").hide();JsCache.get("#txnList").hide()}else{JsCache.get("#txnHead").show();JsCache.get("#txnList").show();if((O[0]!=null&&O[0].categoryType&&CategoryType.BETFAIR.unique()==O[0].categoryType)){S.find("[name=txnOption]").show()}else{S.find("[name=txnOption]").hide()}}if(K.length==0){JsCache.get("#txnList").find("#backSlipHeader").hide();JsCache.get("#txnList").find("#fancyYesHeader").hide()}else{if(K[0]!=null&&K[0].categoryType&&CategoryType.FANCY_BET.unique()==K[0].categoryType){JsCache.get("#txnList").find("#backSlipHeader").hide();JsCache.get("#txnList").find("#fancyYesHeader").show()}else{JsCache.get("#txnList").find("#backSlipHeader").show();JsCache.get("#txnList").find("#fancyYesHeader").hide()}}if(T.length==0){JsCache.get("#txnList").find("#laySlipHeader").hide();JsCache.get("#txnList").find("#fancyNoHeader").hide()}else{if(T[0]!=null&&T[0].categoryType&&CategoryType.FANCY_BET.unique()==T[0].categoryType){JsCache.get("#txnList").find("#laySlipHeader").hide();JsCache.get("#txnList").find("#fancyNoHeader").show()}else{JsCache.get("#txnList").find("#laySlipHeader").show();JsCache.get("#txnList").find("#fancyNoHeader").hide()}}var Q=$j("#openBetSelectionBox");if(Q.find("#option0").prop("selected")==true){JsCache.get("#openBetSlip").hide()}else{JsCache.get("#openBetSlip").show()}};TxnHandler.clickOpenOption=function(){var M=JsCache.get("#showBetInfo");var K=JsCache.get("#averageOdds");var L=JsCache.get("#consolidate");JsCache.get("[name^=openOption]").removeAttr("checked");if(TxnHandler.isShowBetInfo==true){M.prop("checked",true);return}else{if(TxnHandler.isShowAverageOdds==true){K.prop("checked",true);return}else{if(TxnHandler.isShowConsolidate==true){L.prop("checked",true);return}}}};TxnHandler.checkOpenOptionFromCookie=function(){var K=CookieUtil.getCookie("openOption_"+PageConfig.userID);TxnHandler.isShowBetInfo=false;TxnHandler.isShowAverageOdds=false;TxnHandler.isShowConsolidate=false;if(K==1){TxnHandler.isShowBetInfo=true}else{if(K==2){TxnHandler.isShowConsolidate=true}else{if(K==3){TxnHandler.isShowAverageOdds=true}}}TxnHandler.clickOpenOption()};TxnHandler.addOpenOptionToCookie=function(K){CookieUtil.setCookie("openOption_"+PageConfig.userID,K,999)};TxnHandler.updateOpenBetSelectionBox=function(){$j("[id^='option_']").remove();s(DataBase.txn.queryAll(),"txn");s(DataBase.unMatchTicket.queryAll(),"unMatchTicket");s(DataBase.bookMakerTxn.queryAll(),"bookMakerTxn");var K=false;if(!isNaN(i)&&q!=undefined){if($j("#option_"+n(i,q,y)).length==0){K=true}}if(t==true||K==true){TxnHandler.getEventIdAndMarketId();t=false}if(!isNaN(i)&&q!=undefined){$j("#option_"+n(i,q,y)).prop("selected","selected");TxnHandler.refreshOpenBets()}else{$j("#selectMenu option").remove()}};function n(K,M,L){return K+"_"+M.replace(".","_")+"_"+L}function s(O,M){var W=$j("#openBetSelectionBox");for(var S=0;S<=O.length-1;S++){var P=O[S];var Q=P.status;if("txn"==M||"bookMakerTxn"==M){if(MyTransactionUtils.isSettle(Q)){continue}}else{if("unMatchTicket"==M){if(UnMatchTicketUtil.isDelete(Q)||UnMatchTicketUtil.isLapsed(Q)){continue}}}var N=P.eventType;var Y=P.categoryType;var L=P.eventId;var R=P.eventName.replace("v","vs");var Z=P.marketId;var V=P.marketName;var X=Z.replace(".","_");var K=$j("#option_"+n(L,X,Y));if(K.length==0){if((isNaN(i)||i==0)&&(q==undefined||q=="")){i=L;q=Z;y=Y}var U=JsCache.clone("#optionTemplate");U.attr("id","option_"+n(L,X,Y));U.attr("eventType",N).attr("eventId",L).attr("marketId",Z);U.attr("categoryType",Y);U.html(R+" - "+V);if(L==i&&Z==q&&Y==y){U.prop("selected","selected")}if("txn"==M||"bookMakerTxn"==M){U.attr("date",P.transactionDate)}else{if("unMatchTicket"==M){U.attr("date",P.createDate)}}W.find("select").append(U.show())}}var T=$j("[id^='option_']");T.sort(function(ab,aa){var ac=$j(ab);var ad=$j(aa);return -1*ac.attr("date").localeCompare(ad.attr("date"))});W.find("select").append(T)}function b(L,K){return L+"_"+K}function d(M,L,K){return M+"_"+L+"_"+K}TxnHandler.checkToHideOpenBets=function(){var L=DataBase.unMatchTicket.getByMarketId(null,null);var K=DataBase.txn.getByMarketId(null,null);var M=DataBase.bookMakerTxn.getByMarketId(null,null);if(L.length==0&&K.length==0&&M.length==0){JsCache.get(".matched-wrap").hide();JsCache.get(".slip-wrap").addClass("no-open-bet_slip");return}JsCache.get(".matched-wrap").show();JsCache.get(".slip-wrap").removeClass("no-open-bet_slip");return};TxnHandler.getUnMatchTicketsAndTxnsTask=function(){this.task=TaskExecuter.createTask(1,0,function(){var K=this;g(K)});this.task.unMatchTicketVersion=0;this.task.txnVersion=0;this.task.bookMakerTxnVersion=0;this.task.refresh=function(){this.cycleTick=0};this.task.reset=function(){this.unMatchTicketVersion=0;this.txnVersion=0;this.bookMakerTxnVersion=0};this.refresh=function(){this.task.refresh()};this.reset=function(){this.task.reset()}};function g(K){$j.ajax({type:"POST",dataType:"JSON",url:"/member/playerService/queryUnMatchTicketsAndTxns",data:{unMatchTicketVersion:K.unMatchTicketVersion,txnVersion:K.txnVersion,bookMakerTxnVersion:K.bookMakerTxnVersion},success:function(M){try{if(M==null){return}var T=false;var Q=[];if(M.unMatchTicketVersion>K.unMatchTicketVersion&&M.unMatchTickets.length>0){var S=DataBase.unMatchTicket.update(M.unMatchTickets);I();K.unMatchTicketVersion=Math.max(M.unMatchTicketVersion,K.unMatchTicketVersion);if(S==true){T=true}m(M.unMatchTickets,Q)}if(M.txnVersion>K.txnVersion&&M.txns.length>0){DataBase.txn.update(M.txns);z();K.txnVersion=Math.max(M.txnVersion,K.txnVersion);T=true;m(M.txns,Q)}if(M.bookMakerTxnVersion>K.bookMakerTxnVersion&&M.bookMakerTxns.length>0){DataBase.bookMakerTxn.update(M.bookMakerTxns);z();K.bookMakerTxnVersion=Math.max(M.bookMakerTxnVersion,K.bookMakerTxnVersion);T=true;m(M.bookMakerTxns,Q)}if(T){var O=false;if(Q.length>0){for(var N=0;N<Q.length;N++){var L=Q[N].split("_");var R=L[2];if(CategoryType.BETFAIR.unique()==R){BetHandler.getWinLoss(L[0],L[1]);O=true}else{if(CategoryType.FANCY_BET.unique()==R){FancyBetHandler.getExposure(L[0],L[1]);FancyBetMarketHandler.showFancyBetBookBtn(L[0],L[1])}else{if(CategoryType.BOOK_MAKER.unique()==R){BookMakerBetHandler.getExposure(L[0],L[1])}}}}}TxnHandler.updateOpenBetSelectionBox();if(O){TxnHandler.addBlankSelectOption(PageConfig.selectEventId,PageConfig.selectMarketId)}TxnHandler.checkToHideOpenBets()}if(f&&PageConfig.selectMarketId!=null){TxnHandler.changeOpenBetInFullMarkets(PageConfig.selectEventId,PageConfig.selectMarketId);f=false}}catch(P){Trace.printStackTrace(P)}finally{K.check();TaskExecuter.execute()}},error:function(){K.check();TaskExecuter.execute()}})}function m(K,O){for(var L in K){var M=K[L];var N=M.eventId+"_"+M.marketId+"_"+M.categoryType;if(ArrayUtil.indexOf(O,N)==-1){O.push(N)}}}TxnHandler.getUnMatchTicketsAndTxns=function(){$j.ajax({type:"POST",dataType:"JSON",url:"/member/playerService/queryUnMatchTicketsAndTxns",data:{unMatchTicketVersion:TxnHandler.unTask.task.unMatchTicketVersion,txnVersion:TxnHandler.unTask.task.txnVersion,bookMakerTxnVersion:TxnHandler.unTask.task.bookMakerTxnVersion},success:function(K){try{if(K==null){return}var L=false;if(K.unMatchTickets.length>0){DataBase.unMatchTicket.update(K.unMatchTickets);I();L=true}if(K.txns.length>0){DataBase.txn.update(K.txns);z();L=true}if(K.bookMakerTxns.length>0){DataBase.bookMakerTxn.update(K.bookMakerTxns);z();L=true}if(L&&!BetHandler.isOnBetting){TxnHandler.updateOpenBetSelectionBox();TxnHandler.addBlankSelectOption(PageConfig.selectEventId,PageConfig.selectMarketId);TxnHandler.checkToHideOpenBets()}}catch(M){Trace.printStackTrace(M)}finally{}},error:function(){}})};function I(){var L=TxnHandler.isShowBetInfo;DataBase.unMatchTicket.calculatePL();var K=DataBase.unMatchTicket.queryAll();B(K,L)}function B(L,O){var N=p();for(var M=0;M<=L.length-1;M++){var K=L[M];if(K.eventId!=i||K.marketId!=q||K.categoryType!=y){continue}j(K,O,N)}}function p(){var L=false;var K=$j("[id^='unMatchTicket_']");$j.each(K,function(N,M){M=$j(M);if(M.attr("eventId")!=i||M.attr("marketId")!=q||M.attr("categoryType")!=y||UnMatchTicketUtil.isDelete(M.attr("status"))||UnMatchTicketUtil.isLapsed(M.attr("status"))){M.remove();L=true}});return L}function j(V,N,P){var S=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:S.symbol});var U=JsCache.get("#unMatchTicketList");var Q=SideType.getInstanceOf(V.sideType);var K=V.persistenceType;var R;if(SideType.Back.unique()==Q.value){R=U.find("#backSlipHeader")}else{R=U.find("#laySlipHeader")}var T=$j("#unMatchTicket_"+V.id);if(T.length==0){if(UnMatchTicketUtil.isDelete(V.status)||UnMatchTicketUtil.isLapsed(V.status)||V.summary==1||V.lastPrice==0){return}T=JsCache.clone("#unMatchTicketTemplate");T.attr("class","slip-"+Q.name.toLowerCase()).find("#slipType").html(StringUtil.ucfirst(Q.name));T.attr("id","unMatchTicket_"+V.id).attr("unMatchTicketId",V.id).attr("eventId",V.eventId).attr("marketId",V.marketId).attr("betfairBetId",V.betfairBetId).attr("sideType",V.sideType).attr("status",V.status).attr("categoryType",V.categoryType);T.find("#slipType").after('<span class="short-amount">'+V.selectionName+"</span>");if(V.marketType!=null&&"INNINGS_RUNS"==V.marketType){T.find("#marketNameDt").addClass("slip-inline");T.find("#marketName").html()}else{T.find("#marketNameDt").removeClass("slip-inline");T.find("#marketName").html(V.marketName)}E(T);R.after(T.show())}else{if(UnMatchTicketUtil.isDelete(V.status)||UnMatchTicketUtil.isLapsed(V.status)||V.summary==1||V.lastPrice==0){T.remove();return}}R.show();T.find("#price").html("").html(V.odds);T.find("#size").html("").html(CurrencyUtil.formatter(V.lastPrice)).attr("title","$"+V.lastPrice);if(SideType.Back.unique()==Q.value){T.find("#profitLiability").html("").html(CurrencyUtil.formatter(V.profit))}else{T.find("#profitLiability").html("").html(CurrencyUtil.formatter(V.liability))}if(N){T.find("#betId").html("").html("Ref:"+V.id);T.find("#placeDate").html("").html(V.createDateStr);T.find("#betInfo").show()}else{T.find("#betInfo").hide()}if(V.marketType!=null&&"INNINGS_RUNS"==V.marketType){TxnHandler.appendInningRuns(T,V)}else{T.find("#inningsRuns").hide()}if(!TxnHandler.userIsEditPersistence||P){var O=$j("#editUnMatched_"+V.id);if(O.length!=0){CurrencyUtil.updateSetting({currencySymbol:""});O.find("#odds").val(0).val(V.odds);O.find("#inputStake").val(0).val(MathUtil.roundp(V.lastPrice,2)).attr("title","$"+V.lastPrice);O.find("[name=keepOption]").removeAttr("checked").removeAttr("tabindex");if(PersistenceType.Lapse.unique()==K){O.find("#cancel").prop("checked",true);O.find("#keep").prop("tabindex",-1)}else{if(PersistenceType.Persist.unique()==K){O.find("#keep").prop("checked",true);O.find("#cancel").prop("tabindex",-1)}}var S=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:S.symbol});if(SideType.Back.unique()==Q.value){O.find("#profitLiability").html("").html(CurrencyUtil.formatter(V.profit))}else{O.find("#profitLiability").html("").html(CurrencyUtil.formatter(V.liability))}}}if(UnMatchTicketUtil.isShowKeepCancel(V)){T.find("#keepOption").show();JsCache.get("#editAllBets").show()}else{T.find("#keepOption").hide()}T.find("#keepOptionBox").hide();T.find("[name=keepOption]").removeAttr("checked");if(PersistenceType.Lapse.unique()==K){T.find("#cancel").attr("checked",true);T.find("#editKeepOption").html("").html(I18N.get("form.text.inPlay.atInPlay.cancel"))}else{if(PersistenceType.Persist.unique()==K){T.find("#keep").attr("checked",true);T.find("#editKeepOption").html("").html(I18N.get("form.text.inPlay.atInPlay.keep"))}}T.attr("persistenceType",K);var M=$j("#unMatchTicketHead");var L=$j("#unMatchFullBtn");if(UnMatchTicketUtil.isReady(V.status)){if(CategoryType.BETFAIR.unique()==V.categoryType){T.attr("class","slip-book")}else{T.attr("class","slip-"+SideType.Lay.name.toLowerCase())}T.find("#delete").hide();M.find("#headerInfo").html("Pending");L.find("#cancelAllUnMatch").hide();L.find("#editAllBets").hide()}else{T.find("#delete").show();M.find("#headerInfo").html(I18N.get("form.text.unmatched"));L.find("#cancelAllUnMatch").show();L.find("#editAllBets").show()}}function E(K){K.find("#delete").click(function(){c(this)})}TxnHandler.clickEditBetBtn=function(){k();JsCache.get("#unMatchTicketList").hide();JsCache.get("#editUnMatchedList").show();JsCache.get("#unMatchFullBtn").hide();JsCache.get("#editUnMatchFullBtn").show();var K=$j("[id^=editUnMatched_]");if(K!=null&&K.length>0){$j(K[0]).find("#odds").select()}var L=$j("#editUnMatchedList");$j.each(K,function(N,O){O=L.find(O);var M=DataBase.unMatchTicket.get(O.attr("unMatchTicketId"));O.prop("lastPriceBeforeEditBet",M.lastPrice)})};TxnHandler.clickResetBtn=function(){TxnHandler.userIsEditPersistence=false;TxnHandler.listEnableInput();JsCache.get("#unMatchTicketList").show();JsCache.get("#editUnMatchedList").hide();JsCache.get("#unMatchFullBtn").show();JsCache.get("#editUnMatchFullBtn").hide();TxnHandler.refreshOpenBets();TxnHandler.resetMessage()};function k(){var L=TxnHandler.isShowBetInfo;DataBase.unMatchTicket.calculatePL();var K=DataBase.unMatchTicket.queryAll();e(K,L)}function e(L,O){var N=F();for(var M=0;M<=L.length-1;M++){var K=L[M];if(K.eventId!=i||K.marketId!=q||K.categoryType!=CategoryType.BETFAIR.unique()){continue}x(K,O,N)}}function F(){var L=false;var K=$j("[id^='editUnMatched_']");$j.each(K,function(N,M){M=$j(M);if(M.attr("eventId")!=i||M.attr("marketId")!=q||M.attr("categoryType")!=y||UnMatchTicketUtil.isDelete(M.attr("status"))||UnMatchTicketUtil.isLapsed(M.attr("status"))){M.remove();L=true}});return L}function x(S,L,N){var R=JsCache.get("#editUnMatchedList");var O=SideType.getInstanceOf(S.sideType);var K=S.persistenceType;var Q;if(SideType.Back.unique()==O.value){Q=R.find("#backSlipHeader")}else{Q=R.find("#laySlipHeader")}var M=$j("#editUnMatched_"+S.id);if(M.length==0){if(UnMatchTicketUtil.isDelete(S.status)||UnMatchTicketUtil.isLapsed(S.status)||S.summary==1||S.lastPrice==0){return}M=JsCache.clone("#editUnMatchedTemplate");M.attr("class","slip-"+O.name.toLowerCase()).find("#slipType").html(StringUtil.ucfirst(O.name));M.attr("id","editUnMatched_"+S.id).attr("unMatchTicketId",S.id).attr("eventId",S.eventId).attr("marketId",S.marketId).attr("betfairBetId",S.betfairBetId).attr("sideType",S.sideType).attr("status",S.status).attr("categoryType",S.categoryType);M.find("#slipType").after('<span class="short-amount">'+S.selectionName+"</span>");if(S.marketType!=null&&"INNINGS_RUNS"==S.marketType){M.find("#marketNameDt").addClass("slip-inline");M.find("#marketName").html()}else{M.find("#marketNameDt").removeClass("slip-inline");M.find("#marketName").html(S.marketName)}o(M);CurrencyUtil.updateSetting({currencySymbol:""});M.find("#odds").val(0).val(S.odds);M.find("#inputStake").val(0).val(MathUtil.roundp(S.lastPrice,2)).attr("title","$"+S.lastPrice);M.find("#odds").prop("tabindex",0);M.find("#inputStake").prop("tabindex",0);M.find("[name=keepOption]").removeAttr("checked").removeAttr("tabindex");if(PersistenceType.Lapse.unique()==K){M.find("#cancel").prop("checked",true);M.find("#keep").prop("tabindex",-1)}else{if(PersistenceType.Persist.unique()==K){M.find("#keep").prop("checked",true);M.find("#cancel").prop("tabindex",-1)}}var P=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:P.symbol});if(SideType.Back.unique()==O.value){M.find("#profitLiability").html("").html(CurrencyUtil.formatter(S.profit))}else{M.find("#profitLiability").html("").html(CurrencyUtil.formatter(S.liability))}Q.after(M.show())}else{if(UnMatchTicketUtil.isDelete(S.status)||UnMatchTicketUtil.isLapsed(S.status)||S.summary==1||S.lastPrice==0){M.remove();return}}Q.show();if(L){M.find("#betId").html("").html("Ref:"+S.id);M.find("#placeDate").html("").html(S.createDateStr);M.find("#betInfo").show()}else{M.find("#betInfo").hide()}if(S.marketType!=null&&"INNINGS_RUNS"==S.marketType){TxnHandler.appendInningRuns(M,S)}else{M.find("#inningsRuns").hide()}if(UnMatchTicketUtil.isShowKeepCancel(S)){M.find("#keepOptionBox").show()}else{M.find("#keepOptionBox").hide()}M.attr("persistenceType",K);CoinHandler.clickStakePopupList(M,R,true)}function o(K){K.find("#delete").click(function(){c(this)});K.find("#odds").change(function(){TxnHandler.commonEvent(K)});K.find("#inputStake").change(function(){TxnHandler.commonEvent(K)});K.find("#oddsUp").click(function(){if(K.find("ul").hasClass("disable")){return}BetHandler.clickOdds(K.attr("eventId"),K.attr("marketId"),K.attr("selectionId"),K.attr("sideType"),this,K);TxnHandler.commonEvent(K);if(K.find("#odds").val()>1000){K.find("#odds").val(1000);TxnHandler.showEditErrorMsg(I18N.get("msg.member.editBet.maximumOdds"))}});K.find("#oddsDown").click(function(){if(K.find("ul").hasClass("disable")){return}BetHandler.clickOdds(K.attr("eventId"),K.attr("marketId"),K.attr("selectionId"),K.attr("sideType"),this,K);TxnHandler.commonEvent(K)});K.find("#odds").change(function(){TxnHandler.commonEvent(K)});K.find("#odds").blur(function(){BetHandler.blurCheckOddsValidate(this,JsCache.get("#editBetMsg"),K.attr("eventId"),K.attr("marketId").replace("_","."));TxnHandler.commonEvent(K);var L=$j(this);if(L.val()>1000){K.find("#odds").val(1000);TxnHandler.showEditErrorMsg(I18N.get("msg.member.editBet.maximumOdds"))}});K.find("#odds").keyup(function(N){var L=$j(this);TxnHandler.validComma(L);if(outOfScale(L.val(),2)){L.val(MathUtil.floorp(L.val(),2))}TxnHandler.commonEvent(K);var M=N.which;if(KeyEventUtils.isEnterKey(M)){$j("#okBtn").click()}if(KeyEventUtils.isTabKey(M)&&K.find("#odds").is(":focus")){K.find("#odds").select()}});K.find("#odds").click(function(){K.find("#odds").select()});K.find("#inputStake").click(function(){K.find("#inputStake").select()});K.find("#inputStake").blur(function(){CoinHandler.hideStakePopupList();TxnHandler.validComma($j(this));BetHandler.blurCheckStakeValid($j(this),PageConfig.webSiteType,PageConfig.playerCurrency,parseFloat(K.find("#inputStake").val()),JsCache.get("#editBetMsg"),K.attr("eventId"),K.attr("marketId").replace("_","."));TxnHandler.commonEvent(K);if(!MathUtil.isNumeric($j(this).val(),true,false)){$j(this).val("")}});K.find("#inputStake").keydown(function(M){var L=M.which;if(KeyEventUtils.isNumberKey(M)||KeyEventUtils.isBackspaceKey(L)||KeyEventUtils.isDeleteKey(L)||KeyEventUtils.isArrowKey(L)||KeyEventUtils.isTabKey(L)||KeyEventUtils.isEnterKey(L)){return}WindowEventUtil.stopEvent(M)});K.find("#inputStake").keyup(function(Q){var N=$j(this);var P=$j(this).parents("[id^=editUnMatched_]").attr("unmatchticketid");var L=DataBase.unMatchTicket.get(P);if($j(this).val()!=L.lastPrice){$j(this).val(function(R,S){return commaSeparateNumber(S)})}TxnHandler.validComma(N);if(N.val()<1){N.val("")}if(outOfScale(N.val(),2)){N.val(MathUtil.floorp(N.val(),2))}TxnHandler.commonEvent(K);var O=Q.which;if(KeyEventUtils.isEnterKey(O)){var M=K.find("#inputStake").val();K.find("#inputStake").blur();if(M==K.find("#inputStake").val()){$j("#okBtn").click()}}if(KeyEventUtils.isTabKey(O)&&K.find("#inputStake").is(":focus")){K.find("#inputStake").select()}});K.find("#cancel").click(function(){TxnHandler.selectKeepOption(K,PersistenceType.Lapse.unique());TxnHandler.disableOtherInput(K);if(TxnHandler.checkDataIsEdited(K)==0){TxnHandler.enableInput(K)}});K.find("#keep").click(function(){TxnHandler.selectKeepOption(K,PersistenceType.Persist.unique());TxnHandler.disableOtherInput(K);if(TxnHandler.checkDataIsEdited(K)==0){TxnHandler.enableInput(K)}})}TxnHandler.validEditBetMin=function(P,N){var M=CurrencyType.getInstanceOf(PageConfig.playerCurrency);if(M==null){return false}var L=M.editBetMin;var K=DataBase.unMatchTicket.get(P);if(K==null||L==null){return false}if(N==K.lastPrice){return true}var O=MathUtil.decimal.subtract(N,K.lastPrice);if(O<0){O=MathUtil.decimal.multiply(-1,O)}if(O<L){return false}return true};TxnHandler.validComma=function(K){K.val(K.val().replace(/[^\d.]/g,"").replace(/^\./g,""))};TxnHandler.commonEvent=function(K){TxnHandler.oddsAndStakeCheck(K);TxnHandler.disableOtherInput(K);if(TxnHandler.checkDataIsEdited(K)==0){TxnHandler.enableInput(K);TxnHandler.resetMessage()}TxnHandler.calculateEditLiability(K)};TxnHandler.resetMessage=function(){JsCache.get("#editErrorMsg").hide();JsCache.get("#editBetMsg").hide();JsCache.get("#openBetSlip").find("[id^='stakeTipsPopup']").hide();JsCache.get("#openBetSlip").find("[id^='oddsTipsPopup']").hide()};TxnHandler.calculateEditLiability=function(M){var O=M.find("#odds").val();var L=M.find("#inputStake").val();var N=UnMatchTicketUtil.getPL(O,L);var K=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:K.symbol});M.find("#profitLiability").html(CurrencyUtil.formatter(N))};TxnHandler.oddsAndStakeCheck=function(N){var L=$j("[id^='editUnMatched_']");var R=false;var O=true;$j.each(L,function(X,W){W=$j(W);if(W.hasClass("sum")||W.is(":hidden")){return true}if(TxnHandler.checkDataIsEdited(W)==0){return true}var U=W.find("#odds").val();var T=W.find("#inputStake").val();if(!U||!T){R=true;return true}var Y=BetHandler.isLessThanMinOdds(U);if(Y==true){JsCache.get("#editErrorMsg").html(I18N.get("msg.member.odds.minOdds")).show();R=true;if(O==true){O=false}return true}var S=DataBase.unMatchTicket.get(W.attr("unMatchTicketId"));if(S==null){return true}var V=BetHandler.getMinBet(S.eventId,S.marketId);if(S.lastPrice<V){return true}if(T<V){JsCache.get("#editErrorMsg").html(I18N.get("msg.member.minBet")).show();R=true;if(O==true){O=false}return true}});if(O==true){JsCache.get("#editErrorMsg").hide()}if(N!=null){var K=DataBase.unMatchTicket.get(N.attr("unMatchTicketId"));var M=BetHandler.getMinBet(K.eventId,K.marketId);if(K.lastPrice>=M){var P=BetHandler.isLessThanMinStake(N,JsCache.get("#editUnMatchedList"));if(P==true){return}}var Q=BetHandler.isLessThanMinOdds(N.find("#odds").val());if(Q==true){BetHandler.showOddsTips(N,JsCache.get("#editUnMatchedList"));return}BetHandler.hideOddsTips(N)}if(R==true){return}};TxnHandler.disableOtherInput=function(N){var O=TxnHandler.getNewPersistenceType(N);var M=N.find("#odds").val();var L=N.find("#inputStake").val();var K=DataBase.unMatchTicket.get(N.attr("unMatchTicketId"));if(O!=N.attr("persistenceType")){N.find("#inputStake").prop("disabled",true).addClass("disable");N.find("#odds").prop("disabled",true).addClass("disable");N.find("ul").addClass("disable");return}else{if(M!=K.odds){N.find("#inputStake").prop("disabled",true).addClass("disable");N.find("[name=keepOption]").prop("disabled",true).addClass("disable");return}else{if(L!=K.lastPrice){N.find("#odds").prop("disabled",true).addClass("disable");N.find("ul").addClass("disable");N.find("[name=keepOption]").prop("disabled",true).addClass("disable");return}}}};TxnHandler.enableInput=function(K){K.find("#odds").prop("disabled",false).removeClass("disable");K.find("ul").removeClass("disable");K.find("#inputStake").prop("disabled",false).removeClass("disable");K.find("[name=keepOption]").prop("disabled",false).removeClass("disable")};TxnHandler.listEnableInput=function(){var K=$j("[id^='editUnMatched_']");$j.each(K,function(M,L){L=$j(L);TxnHandler.enableInput(L)})};TxnHandler.checkDataIsEdited=function(N){var M=N.find("#odds").val();var L=N.find("#inputStake").val();var K=DataBase.unMatchTicket.get(N.attr("unMatchTicketId"));var O=TxnHandler.getNewPersistenceType(N);if(K==null){return false}return(M!=K.odds)|(L!=K.lastPrice)|(O!=K.persistenceType)};TxnHandler.getNewPersistenceType=function(K){if(K.find("#cancel").prop("checked")==true){return PersistenceType.Lapse.unique()}else{if(K.find("#keep").prop("checked")==true){return PersistenceType.Persist.unique()}}};TxnHandler.selectKeepOption=function(M,L){var K=M.find("#keepOptionBox");K.find("[name=keepOption]").removeAttr("checked").removeAttr("tabindex");if(PersistenceType.Lapse.unique()==L){K.find("#cancel").attr("checked",true);K.find("#keep").attr("tabindex",-1)}else{if(PersistenceType.Persist.unique()==L){K.find("#keep").attr("checked",true);K.find("#cancel").attr("tabindex",-1)}}};TxnHandler.updateUnMatchTicketList=function(){TxnHandler.userIsEditPersistence=false;TxnHandler.listEnableInput();JsCache.get("#editAllBets").show();JsCache.get("#editErrorMsg").hide();JsCache.get("#unMatchTicketList").show();JsCache.get("#editUnMatchedList").hide();JsCache.get("#unMatchFullBtn").show();JsCache.get("#editUnMatchFullBtn").hide();var M=JsCache.get("#editUnMatchedList");var K=M.find("[id^=editUnMatched_]");var L=[];$j.each(K,function(T,O){O=$j(O);if(O.attr("unMatchTicketId")==null||O.find("#odds")==null||O.find("#inputStake")==null){return true}var U=false;var Z=false;var X=false;var P=O.attr("unMatchTicketId");var N=O.attr("persistenceType");var S=parseFloat(O.find("#odds").val())||0;var R=parseFloat(O.find("#inputStake").val())||0;if(!MathUtil.isNumeric(O.find("#odds").val(),true,false)||S<1.01){O.find("#odds").val(1.01);return true}if(S>1000){S=1000;O.find("#odds").val(1000);TxnHandler.showEditErrorMsg(I18N.get("msg.member.editBet.maximumOdds"));return true}if(!MathUtil.isNumeric(O.find("#inputStake").val(),true,false)||R==0){O.find("#inputStake").val("");return true}if(!TxnHandler.validEditBetMin(O.attr("unMatchTicketId"),R)){TxnHandler.showEditBetMsg(I18N.get("msg.member.editBet.warning"));return true}var Q=TxnHandler.getNewPersistenceType(O);var W=DataBase.unMatchTicket.get(P);var V=BetHandler.getMinBet(O.attr("eventId"),O.attr("marketId"));if(W.lastPrice>=V&&R<V){return true}if(Q!=N){U=true}else{if(S!=W.odds){Z=true}else{if(R!=W.lastPrice){X=true}}}if(!U&&!Z&&!X){return true}var Y={unMatchTicketId:P,eventId:O.attr("eventId"),marketId:O.attr("marketId")};Y.lastPriceBeforeEditBet=parseFloat(O.prop("lastPriceBeforeEditBet"))||0;if(U){Y.newPersistenceType=Q}else{if(Z){Y.newOdds=S}else{if(X){Y.newStake=R}}}L.push(Y)});TxnHandler.submitUpdate(L);TxnHandler.unTask.reset();TxnHandler.unTask.refresh()};TxnHandler.showEditErrorMsg=function(K){JsCache.get("#editErrorMsg").html(K).fadeIn();setTimeout(function(){JsCache.get("#editErrorMsg").fadeOut()},3000)};TxnHandler.showEditBetMsg=function(K){JsCache.get("#editBetMsg").html(K).fadeIn();setTimeout(function(){JsCache.get("#editBetMsg").fadeOut()},3000)};TxnHandler.submitUpdate=function(K){JsCache.get("#editBetMsg").hide();JsCache.get("#openBetSlip").find("[id^='stakeTipsPopup']").hide();JsCache.get("#openBetSlip").find("[id^='oddsTipsPopup']").hide();if(K.length==0){return}$j.ajax({type:"POST",dataType:"JSON",url:"/member/playerService/updateUnMatchTicket",data:{updateUnMatchTickets:JSON.stringify(K)},beforeSend:function(){JsCache.get("#processingImg").show();JsCache.get("#matchSection").hide()},success:function(L){try{if(L.error){TxnHandler.showEditErrorMsg(L.error);return}if(L.result.length==0){return}for(var M in L.result){var O=L.result[M];if(O.status=="SUCCESS"){if(O.unMatchTicket!=null){DataBase.unMatchTicket.update([O.unMatchTicket])}if(O.txn!=null){DataBase.txn.update([O.txn])}}else{if(O.error){TxnHandler.showEditErrorMsg(O.error)}}}}catch(N){Trace.printStackTrace(N)}finally{TxnHandler.unTask.reset();TxnHandler.unTask.refresh();setTimeout(function(){JsCache.get("#processingImg").hide();JsCache.get("#matchSection").show();TxnHandler.refreshOpenBets()},1000);TxnHandler.listEnableInput()}},error:function(L){Trace.printStackTrace(L)}})};function c(O){var N=$j(O);var L=N.parent().parent();var M=L.attr("eventId");var P=L.attr("marketId");var K=L.attr("unMatchTicketId");h([{eventId:M,marketId:P,unMatchTicketId:K}])}TxnHandler.cancelAllUnMatchTickets=function(M){var N=JsCache.get("#unMatchTicketList");var L=N.find("dl");var K=[];$j.each(L,function(P,O){var Q=$j(O);if(Q.hasClass("sum")||Q.is(":hidden")||Q.attr("unMatchTicketId")==null||Q.attr("eventId")==null||Q.attr("marketId")==null){return true}K.push({unMatchTicketId:Q.attr("unMatchTicketId"),eventId:Q.attr("eventId"),marketId:Q.attr("marketId")})});TxnHandler.userIsEditPersistence=false;h(K)};function h(K){TxnHandler.clickResetBtn();if(K.length==0){return}$j.ajax({type:"POST",dataType:"JSON",url:"/member/playerService/cancelUnMatchTicket",data:{cancelUnMatchTickets:JSON.stringify(K)},beforeSend:function(){JsCache.get("#processingImg").show();JsCache.get("#matchSection").hide()},success:function(L){try{if(L.result.length==0){return}for(var M in L.result){var O=L.result[M];if(O.unMatchTicket!=null){DataBase.unMatchTicket.update([O.unMatchTicket])}if(O.totalCancelPrice!=null){BetHandler.fadeInMsg("#betMsg",I18N.get("msg.member.betting.cancelUnMatchTicketSuccess",[CurrencyUtil.formatter(O.totalCancelPrice)]))}else{if(O.error!=null){BetHandler.fadeInMsg("#errorMsg",O.error)}}}TxnHandler.updateOpenBetSelectionBox();TxnHandler.addBlankSelectOption(PageConfig.selectEventId,PageConfig.selectMarketId);TxnHandler.checkToHideOpenBets()}catch(N){Trace.printStackTrace(N)}finally{TxnHandler.unTask.reset();TxnHandler.unTask.refresh();setTimeout(function(){JsCache.get("#processingImg").hide();JsCache.get("#matchSection").show()},1000)}},error:function(L){Trace.printStackTrace(L);JsCache.get("#processingImg").hide();JsCache.get("#matchSection").show()}})}TxnHandler.appendInningRuns=function(P,K){var N=P.find("#inningsRuns");var O=K.selectionName.toLowerCase();N.find("#ifRuns").html("If "+O);N.find("#ifLess").html("If less than "+O.replace("or more",""));N.show();var Q=N.find("#runsPL");var L=N.find("#lessPL");if(Q==null||L==null){return}var R=0;var M=0;if(SideType.Back.unique()==SideType.getInstanceOf(K.sideType).unique()){R=K.profit;M=-1*K.liability}else{R=-1*K.liability;M=K.profit}Q.html(CurrencyUtil.formatter(R));L.html(CurrencyUtil.formatter(M));Q.removeClass("green").removeClass("red");L.removeClass("green").removeClass("red");if(R>=0){Q.addClass("green")}else{Q.addClass("red")}if(M>=0){L.addClass("green")}else{L.addClass("red")}};function z(){var N=TxnHandler.isShowBetInfo;var M=TxnHandler.isShowAverageOdds;var K=TxnHandler.isShowConsolidate;var L=null;if(CategoryType.BOOK_MAKER.unique()==y){DataBase.bookMakerTxn.calculatePL()}else{DataBase.txn.calculatePL()}L=TxnHandler.getMarketTxnByCategoryType(i,q,null,null,y);if(M){a(L)}else{if(K){D(L)}else{if(N){u(L,N)}else{u(L,N)}}}}function a(M){$j("[id^='txn_']").remove();var N=H("Txn",M);var Q=false;var L=N.keySet();for(var P in L){var O=L[P];var K=N.get(O);l(K,Q,K.averageOdds,K.totalStake,K.totalProfit)}}function D(M){$j("[id^='txn_']").remove();var N=v("Txn",M);var Q=false;var L=N.keySet();for(var P in L){var O=L[P];var K=N.get(O);l(K,Q,K.averageOdds,K.totalStake,K.totalProfit)}}function u(M,O){$j("[id^='txn_']").remove();for(var N=0;N<=M.length-1;N++){var K=M[N];var L=K.status;if(MyTransactionUtils.isSettle(L)){continue}l(K,O)}}function l(U,L,M,O,S){if(U.summary==1){return}var T=CategoryType.BETFAIR.unique();if(U.categoryType){T=U.categoryType}var R=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:R.symbol});if(CategoryType.BETFAIR.unique()==T){var Q=JsCache.get("#txnList");var N=SideType.getInstanceOf(U.sideType);var P;if(SideType.Back.unique()==N.value){P=Q.find("#backSlipHeader").show()}else{P=Q.find("#laySlipHeader").show()}var K=JsCache.clone("#txnTemplate");K.attr("class","slip-"+N.name.toLowerCase()).find("#slipType").html(StringUtil.ucfirst(N.name));K.attr("id","txn_"+U.id).attr("betfairBetId",U.betfairBetId).attr("sideType",U.sideType);K.find("#slipType").after('<span class="short-amount">'+U.selectionName+"</span>");if(U.marketType!=null&&"INNINGS_RUNS"==U.marketType){K.find("dt").addClass("slip-inline");K.find("#marketName").html("")}else{K.find("dt").removeClass("slip-inline");K.find("#marketName").html(U.marketName)}K.find("#price").html(M==null?U.odds:MathUtil.roundp(M,2));K.find("#size").html(O==null?CurrencyUtil.formatter(U.stake):CurrencyUtil.formatter(O)).attr("title",O==null?"$"+U.stake:"$"+O);if(S==null){if(SideType.Back.unique()==N.value){K.find("#profitLiability").html(CurrencyUtil.formatter(U.profit))}else{K.find("#profitLiability").html(CurrencyUtil.formatter(U.liability))}}else{K.find("#profitLiability").html(CurrencyUtil.formatter(U.totalProfit))}if(L){K.find("#betId").html(U.betId==null?"Ref: 0":"Ref: "+U.betId);K.find("#placeDate").html(U.transactionDateStr);K.find("#betInfo").show()}else{K.find("#betInfo").hide()}P.after(K.show())}else{if(CategoryType.FANCY_BET.unique()==T){G(U,L)}else{if(CategoryType.OW_SPORTSBOOK.unique()==T){A(U,L)}else{if(CategoryType.SPORTRADAR_SPORTSBOOK.unique()==T){w(U,L)}else{if(CategoryType.BOOK_MAKER.unique()==T){C(U,L)}}}}}}function G(L,P){var K=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:K.symbol});var N=$j("#txnList");var M=null;if(FancySideType.YES.unique()==L.sideType){M=N.find("#fancyYesHeader").show()}else{M=N.find("#fancyNoHeader").show()}if(EventType.ELECTION.unique()==L.eventType){M.find("#runsOdds").html("Seats/Odds")}else{M.find("#runsOdds").html("Runs/Odds")}N.find("#backSlipHeader").hide();N.find("#laySlipHeader").hide();var O=N.find("#txnTemplate").clone();O.prop("class","slip-"+SideType.getInstanceOf(L.sideType).name.toLowerCase());O.prop("id","txn_"+L.id);O.prop("betfairBetId",L.betfairBetId);O.prop("sideType",L.sideType);O.prop("title","$"+L.stake);O.find("#slipType").html(StringUtil.ucfirst(FancySideType.getInstanceOf(L.sideType).name));O.find("#slipType").after('<span class="short-amount">'+L.marketName+"</span>");O.find("dt").addClass("slip-inline");O.find("#marketName").html("");O.find("#price").html(L.runs+"/"+L.odds);O.find("#size").html(CurrencyUtil.formatter(L.stake));if(FancySideType.YES.unique()==L.sideType){O.find("#profitLiability").html(CurrencyUtil.formatter(L.profit))}else{O.find("#profitLiability").html(CurrencyUtil.formatter(L.liability))}if(P){O.find("#betId").html(L.betId==null?"Ref: 0":"Ref: "+L.betId);O.find("#placeDate").html(L.transactionDateStr);O.find("#betInfo").show()}else{O.find("#betInfo").hide()}M.after(O.show())}function A(L,P){var K=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:K.symbol});var N=$j("#txnList");var M=N.find("#backSlipHeader").show();var O=N.find("#txnTemplate").clone();O.prop("class","slip-"+SideType.Back.name.toLowerCase());O.prop("id","txn_"+L.id);O.prop("betfairBetId",L.betfairBetId);O.prop("sideType",L.sideType);O.prop("title","$"+L.stake);O.find("#slipType").html(StringUtil.ucfirst(SideType.Back.name));O.find("#slipType").after('<span class="short-amount">'+L.selectionName+"</span>");O.find("dt").removeClass("slip-inline");O.find("#marketName").html(L.marketName);O.find("#price").html(L.odds);O.find("#size").html(CurrencyUtil.formatter(L.stake));O.find("#profitLiability").html(CurrencyUtil.formatter(L.profit));if(P){O.find("#betId").html(L.betId==null?"Ref: 0":"Ref: "+L.betId);O.find("#placeDate").html(L.transactionDateStr);O.find("#betInfo").show()}else{O.find("#betInfo").hide()}M.after(O.show())}function w(L,P){var K=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:K.symbol});var N=$j("#txnList");var M=N.find("#backSlipHeader").show();var O=N.find("#txnTemplate").clone();O.prop("class","slip-"+SideType.Back.name.toLowerCase());O.prop("id","txn_"+L.id);O.prop("betfairBetId",L.betfairBetId);O.prop("sideType",L.sideType);O.prop("title","$"+L.stake);O.find("#slipType").html(StringUtil.ucfirst(SideType.Back.name));O.find("#slipType").after('<span class="short-amount">'+L.selectionName+"</span>");O.find("dt").removeClass("slip-inline");O.find("#marketName").html(L.marketName);O.find("#price").html(L.odds);O.find("#size").html(CurrencyUtil.formatter(L.stake));O.find("#profitLiability").html(CurrencyUtil.formatter(L.profit));if(P){O.find("#betId").html(L.betId==null?"Ref: 0":"Ref: "+L.betId);O.find("#placeDate").html(L.transactionDateStr);O.find("#betInfo").show()}else{O.find("#betInfo").hide()}M.after(O.show())}function C(L,P){var K=CurrencyType.getInstanceOf(PageConfig.playerCurrency);CurrencyUtil.updateSetting({currencySymbol:K.symbol});var N=$j("#txnList");var M=N.find("#"+SideType.getInstanceOf(L.sideType).name.toLowerCase()+"SlipHeader").show();M.find("#runsOdds").html("Odds");var O=N.find("#txnTemplate").clone();O.prop("class","slip-"+SideType.getInstanceOf(L.sideType).name.toLowerCase());O.prop("id","txn_"+L.id);O.prop("sideType",L.sideType);O.prop("title","$"+L.stake);O.find("#slipType").html(StringUtil.ucfirst(SideType.getInstanceOf(L.sideType).name));O.find("#slipType").after('<span class="short-amount">'+L.selectionName+"</span>");O.find("dt").addClass("slip-inline");O.find("#marketName").html("");O.find("#price").html(L.odds);O.find("#size").html(CurrencyUtil.formatter(L.stake));if(SideType.Back.unique()==L.sideType){O.find("#profitLiability").html(CurrencyUtil.formatter(L.profit))}else{O.find("#profitLiability").html(CurrencyUtil.formatter(L.liability))}if(P){O.find("#betId").html(L.id==null?"Ref: 0":"Ref: "+L.id);O.find("#placeDate").html(L.transactionDateStr);O.find("#betInfo").show()}else{O.find("#betInfo").hide()}M.after(O.show())}function H(L,X){var M=new HashMap();var ab=new HashMap();for(var O=0;O<=X.length-1;O++){var Q=X[O];var U=Q.status;if("UnMatchTicket"==L){if(UnMatchTicketUtil.isDelete(U)){continue}}else{if("Txn"==L){if(MyTransactionUtils.isSettle(U)){continue}}}var Y=M.get(b(Q.sideType,Q.selectionId));if(Y==null){Y=[]}Y.push(Q);M.put(b(Q.sideType,Q.selectionId),Y)}var N=M.keySet();for(var W in N){var K=N[W];var T=0;var aa=0;var S=0;var P=0;var R={};var Z=M.get(K);for(var V in Z){R=Z[V];if("UnMatchTicket"==L){T=MathUtil.decimal.add(T,parseFloat(R.lastPrice))}else{if("Txn"==L){T=MathUtil.decimal.add(T,parseFloat(R.stake))}}P=MathUtil.decimal.add(P,parseFloat(R.stakeOdds))}aa=MathUtil.decimal.divide(P,T);aa=MathUtil.roundp(aa,2);S=MathUtil.decimal.multiply(MathUtil.decimal.subtract(aa,1),T);R.averageOdds=aa;R.totalStake=T;R.totalProfit=S;ab.put(K,R)}return ab}function v(W,O){var M=new HashMap();var K=new HashMap();for(var V=0;V<=O.length-1;V++){var Z=O[V];var S=Z.status;if("UnMatchTicket"==W){if(UnMatchTicketUtil.isDelete(S)){continue}}else{if("Txn"==W){if(MyTransactionUtils.isSettle(S)){continue}}}var L=M.get(d(Z.sideType,Z.selectionId,Z.odds));if(L==null){L=[]}L.push(Z);M.put(d(Z.sideType,Z.selectionId,Z.odds),L)}var P=M.keySet();for(var T in P){var N=P[T];var U=0;var Y=0;var R={};var X=M.get(N);for(var Q in X){R=X[Q];if("UnMatchTicket"==W){U=MathUtil.decimal.add(U,parseFloat(R.lastPrice))}else{if("Txn"==W){U=MathUtil.decimal.add(U,parseFloat(R.stake))}}}Y=MathUtil.decimal.multiply(MathUtil.decimal.subtract(R.odds,1),U);R.averageOdds=R.odds;R.totalStake=U;R.totalProfit=Y;K.put(N,R)}return K}TxnHandler.getRemovedMarketsTask=TaskExecuter.createTask(5,0,function(){var K=this;J(K)});function J(K){if(TxnHandler.marketPks.length==0){K.check();TaskExecuter.execute();return}$j.ajax({type:"POST",dataType:"JSON",url:"/member/playerService/queryRemovedMarkets",data:{marketPks:TxnHandler.marketPks},success:function(M){try{if(M.marketPks.length==0){return}var L=false;for(var O in M.marketPks){var P=M.marketPks[O];if(P.inPlay==1){DataBase.unMatchTicket.marketChangeToInPlay(P)}if(P.removed==1){DataBase.unMatchTicket.summaryByMarketPk(P);DataBase.txn.summaryByMarketPk(P);DataBase.bookMakerTxn.summaryByMarketPk(P);var N=P.eventId+";"+P.marketId;r(N);L=true}}if(L){TxnHandler.refreshOpenBets();TxnHandler.updateOpenBetSelectionBox();TxnHandler.checkToHideOpenBets()}}catch(Q){Trace.printStackTrace(Q)}finally{K.check();TaskExecuter.execute()}},error:function(){K.check();TaskExecuter.execute()}})}function r(K){TxnHandler.marketPks=$j.grep(TxnHandler.marketPks,function(L){return L!=K})}TxnHandler.getMarketTxnByCategoryType=function(L,O,K,M,N){if(CategoryType.BOOK_MAKER.unique()==N){return DataBase.bookMakerTxn.getByMarketId(L,O,K,M,N)}return DataBase.txn.getByMarketId(L,O,K,M,N)}})();if(typeof(DataBase)=="undefined"){DataBase={}}(function(){DataBase.unMatchTicket={};var b=new TreeMap();DataBase.unMatchTicket.update=function(g){var f=false;for(var h in g){var d=g[h];var e=b.get(d.id);if(e==null){f=true}if(e!=null){if(e.status!=d.status){f=true}b.remove(d.id)}if(UnMatchTicketUtil.isActive(d.status)){var i=d.eventId+";"+d.marketId.replace("_",".")+";"+d.categoryType;if(ArrayUtil.indexOf(TxnHandler.marketPks,i)==-1){TxnHandler.marketPks.push(i)}}b.put(d.id,d)}return f};DataBase.unMatchTicket.add=function(d){return b.put(d.id,d)};DataBase.unMatchTicket.get=function(d){return b.get(d)};DataBase.unMatchTicket.getByEventId=function(d,e){var f=[];$j.each(b.values(),function(h,g){if(UnMatchTicketUtil.isDelete(g.status)||UnMatchTicketUtil.isLapsed(g.status)||g.summary==1||g.lastPrice==0){return true}if(d==g.eventId&&e==g.categoryType){f.push(g)}});return f};DataBase.unMatchTicket.getByMarketId=function(e,g,d,f){var h=[];$j.each(b.values(),function(j,i){if(UnMatchTicketUtil.isDelete(i.status)||UnMatchTicketUtil.isLapsed(i.status)||i.summary==1||i.lastPrice==0){return true}if(e==null&&g==null){h.push(i)}else{if(d!=null){if(i.sideType!=d){return true}}if((e==i.eventId)&&(g.replace("_",".")==i.marketId.replace("_","."))&&f==i.categoryType){h.push(i)}}});return h};DataBase.unMatchTicket.getBySelectionId=function(e,g,d,f){var h=[];$j.each(b.values(),function(j,i){if(UnMatchTicketUtil.isDelete(i.status)||UnMatchTicketUtil.isLapsed(i.status)){return true}if((e==i.eventId)&&(g.replace("_",".")==i.marketId.replace("_","."))&&(d==i.selectionId)&&f==i.categoryType){h.push(i)}});return h};DataBase.unMatchTicket.calculatePL=function(){var f=b.keySet();for(var j in f){var h=f[j];var e=b.get(h);var g=MathUtil.roundp(e.lastPrice,2);var k=SideType.getInstanceOf(e.sideType);if(SideType.Back.unique()==k.value){e.profit=UnMatchTicketUtil.getPL(e.odds,g);e.liability=g}else{if(SideType.Lay.unique()==k.value){e.profit=g;e.liability=UnMatchTicketUtil.getPL(e.odds,g)}}var d=MathUtil.decimal.multiply(e.odds,g);if(isNaN(d)){d=0}e.stakeOdds=d}};DataBase.unMatchTicket.summaryByMarketPk=function(e){var d=DataBase.unMatchTicket.getByMarketId(e.eventId,e.marketId,null,e.categoryType);$j.each(d,function(h,g){var f=b.get(g.id);f.summary=1;f.status=UnMatchTicketStatusType.Delete.unique()})};DataBase.unMatchTicket.marketChangeToInPlay=function(e){var d=DataBase.unMatchTicket.getByMarketId(e.eventId,e.marketId,null,e.categoryType);$j.each(d,function(g,f){var h=b.get(f.id);h.inPlay=1})};DataBase.unMatchTicket.queryAll=function(){return b.values()};DataBase.unMatchTicket.size=function(){return b.length};DataBase.txn={};var a=new TreeMap();DataBase.txn.update=function(g){for(var e in g){var h=g[e];var d=a.get(h.id);if(d!=null){a.remove(h.id)}if(MyTransactionUtils.isActive(h.status)){var f=h.eventId+";"+h.marketId.replace("_",".")+";"+h.categoryType;if(ArrayUtil.indexOf(TxnHandler.marketPks,f)==-1){TxnHandler.marketPks.push(f)}}a.put(h.id,h)}};DataBase.txn.add=function(d){return a.put(d.id,d)};DataBase.txn.get=function(d){return a.get(d)};DataBase.txn.getByEventId=function(d,e){var f=[];$j.each(a.values(),function(g,h){if(MyTransactionStatusType.Active.unique()!=h.status||h.summary==1){return true}if(d==h.eventId&&e==h.categoryType){f.push(h)}});return f};DataBase.txn.getByMarketId=function(e,h,d,f,g){var i=[];$j.each(a.values(),function(j,k){if(f==null||f.length==0){if(MyTransactionStatusType.Active.unique()!=k.status){return true}}else{if(!MyTransactionUtils.isContainsStatus(f,k.status)){return true}}if(k.summary==1){return true}if(e==null&&h==null){i.push(k)}else{if(d!=null){if(k.sideType!=d){return true}}if((e==k.eventId)&&(h.replace("_",".")==k.marketId.replace("_","."))&&g==k.categoryType){i.push(k)}}});return i};DataBase.txn.getBySelectionId=function(e,g,d,f){var h=[];$j.each(a.values(),function(i,j){if(MyTransactionStatusType.Active.unique()!=j.status){return true}if((e==j.eventId)&&(g.replace("_",".")==j.marketId.replace("_","."))&&(d==j.selectionId)&&f==j.categoryType){h.push(j)}});return h};DataBase.txn.calculatePL=function(){var f=a.keySet();for(var h in f){var g=f[h];var k=a.get(g);var e=MathUtil.roundp(k.stake,2);var l=k.categoryType;var j=SideType.getInstanceOf(k.sideType);if(SideType.Back.unique()==j.value){if(CategoryType.FANCY_BET.unique()==l){k.profit=MyTransactionUtils.getFancyBetPL(k.odds,e);k.liability=e}else{k.profit=UnMatchTicketUtil.getPL(k.odds,e);k.liability=e}}else{if(SideType.Lay.unique()==j.value){if(CategoryType.FANCY_BET.unique()==l){k.profit=e;k.liability=MyTransactionUtils.getFancyBetPL(k.odds,e)}else{k.profit=e;k.liability=UnMatchTicketUtil.getPL(k.odds,e)}}}var d=MathUtil.decimal.multiply(k.odds,e);if(isNaN(d)){d=0}k.stakeOdds=d}};DataBase.txn.summaryByMarketPk=function(e){var d=DataBase.txn.getByMarketId(e.eventId,e.marketId,null,null,e.categoryType);$j.each(d,function(g,h){var f=a.get(h.id);f.summary=1;f.status=MyTransactionStatusType.Settle.unique()})};DataBase.txn.queryAll=function(){return a.values()};DataBase.txn.size=function(){return a.length};DataBase.bookMakerTxn={};var c=new TreeMap();DataBase.bookMakerTxn.update=function(g){for(var e in g){var h=g[e];var d=c.get(h.id);if(d!=null){c.remove(h.id)}if(MyTransactionUtils.isActive(h.status)){var f=h.eventId+";"+h.marketId.replace("_",".")+";"+h.categoryType;if(ArrayUtil.indexOf(TxnHandler.marketPks,f)==-1){TxnHandler.marketPks.push(f)}}c.put(h.id,h)}};DataBase.bookMakerTxn.add=function(d){return c.put(d.id,d)};DataBase.bookMakerTxn.get=function(d){return c.get(d)};DataBase.bookMakerTxn.getByEventId=function(d,e){var f=[];$j.each(c.values(),function(g,h){if(MyTransactionStatusType.Active.unique()!=h.status||h.summary==1){return true}if(d==h.eventId&&e==h.categoryType){f.push(h)}});return f};DataBase.bookMakerTxn.getByMarketId=function(e,h,d,f,g){var i=[];$j.each(c.values(),function(j,k){if(f==null||f.length==0){if(MyTransactionStatusType.Active.unique()!=k.status){return true}}else{if(!MyTransactionUtils.isContainsStatus(f,k.status)){return true}}if(k.summary==1){return true}if(e==null&&h==null){i.push(k)}else{if(d!=null){if(k.sideType!=d){return true}}if((e==k.eventId)&&(h.replace("_",".")==k.marketId.replace("_","."))&&g==k.categoryType){i.push(k)}}});return i};DataBase.bookMakerTxn.getBySelectionId=function(e,g,d,f){var h=[];$j.each(c.values(),function(i,j){if(MyTransactionStatusType.Active.unique()!=j.status){return true}if((e==j.eventId)&&(g.replace("_",".")==j.marketId.replace("_","."))&&(d==j.selectionId)&&f==j.categoryType){h.push(j)}});return h};DataBase.bookMakerTxn.calculatePL=function(){var f=c.keySet();for(var h in f){var g=f[h];var k=c.get(g);var e=MathUtil.roundp(k.stake,2);var l=k.categoryType;var j=SideType.getInstanceOf(k.sideType);if(SideType.Back.unique()==j.value){if(EventType.CRICKET.unique()==k.eventType){k.profit=MyTransactionUtils.getFancyBetPL(k.odds,e);k.liability=e}else{k.profit=UnMatchTicketUtil.getPL(k.odds,e);k.liability=e}}else{if(SideType.Lay.unique()==j.value){if(EventType.CRICKET.unique()==k.eventType){k.profit=e;k.liability=MyTransactionUtils.getFancyBetPL(k.odds,e)}else{k.profit=e;k.liability=UnMatchTicketUtil.getPL(k.odds,e)}}}var d=MathUtil.decimal.multiply(k.odds,e);if(isNaN(d)){d=0}k.stakeOdds=d}};DataBase.bookMakerTxn.summaryByMarketPk=function(d){var e=DataBase.bookMakerTxn.getByMarketId(d.eventId,d.marketId,null,null,d.categoryType);$j.each(e,function(g,h){var f=c.get(h.id);f.summary=1;f.status=MyTransactionStatusType.Settle.unique()})};DataBase.bookMakerTxn.queryAll=function(){return c.values()};DataBase.bookMakerTxn.size=function(){return c.length}})();function outOfScale(b,c){var a=(""+b).split(".");return(a.length>1&&a[1].length>c)};