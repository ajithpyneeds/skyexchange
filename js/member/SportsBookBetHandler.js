if(typeof(SportsBookBetHandler)=="undefined"){SportsBookBetHandler={}}(function(){var k=5;SportsBookBetHandler.appendBoard=function(z,F,s,r,E,w,G){SportsBookBetHandler.clearBoard();var B=DataBase.sportsBookBet.generateKey(F,r,E,w);var A=DataBase.sportsBookMarkets.getSelection(F,r,E,w);if(A==null){return}var y=z.prop("handicap");var x=DataBase.sportsBookBet.add(F,s,r,E,w,G,A.selectionName,A.betfairEventId,y);var D=false;var C=q(B,F,r,E,w,x);z.after(C.fadeIn());C.find("#odds").html(x.odds);if(PageConfig.userCoin!=null&&PageConfig.userCoin>0){var u=DataBase.sportsBookMarkets.get(F,r,E);var t=parseFloat(PageConfig.userCoin);if(u.min&&parseFloat(u.min)>PageConfig.userCoin){t=parseFloat(u.min)}C.find("#inputStake").val(t);D=DataBase.sportsBookBet.updateStake(F,r,E,w,t)}else{C.find("#inputStake").val("")}var v=j(C,F,r,E);SportsBookBetHandler.eventCalculate(C,F,r,E,w,D);C.find("#odds").select();SportsBookBetHandler.updateExposure();CoinHandler.showSportsBookBetCoin(C)};SportsBookBetHandler.clearBoard=function(){var r=$j("#sportsBookWrap");var s=r.find("[id^=sportsBookBetBoard_]");$j.each(s,function(u,w){w=r.find(w);if(w.length>0){var v=w.prop("eventId");var x=w.prop("marketId");var t=w.prop("selectionId");b(w,v,x,t)}});DataBase.sportsBookBet.clear()};SportsBookBetHandler.removeBoardByMarket=function(t,v,w){var s=$j("#sportsBookWrap");var u=DataBase.sportsBookMarkets.getEventMarketKey(t,v,w);var r=s.find("[id^=sportsBookBetBoard_][marketPk="+u+"]");r.hide();DataBase.sportsBookBet.removeByMarket(t,v,w);SportsBookBetHandler.getExposure(t,v,w)};SportsBookBetHandler.resetAllBetBoard=function(){var r=$j("#sportsBookWrap");r.find("[id^=sportsBookBetBoard_]").hide();SportsBookEventHandler.removeSelectClass();SportsBookBetHandler.updateExposure()};function b(t,s,u,r){t.hide()}function q(u,s,v,y,t,r){var w=$j("#overWrap");var x=w.find("#sportsBookBetBoard_"+u);if(x.length==0){x=p(w,u,s,v,y,t,r)}x.find("#sportsBookAcceptAnyOdds").prop("checked",TopMenuHandler.isAcceptAnyOdds("sportsBook"));UiUtils.removeContents(x.find("#sportsBookMaxStake"));return x}function p(s,x,A,r,y,u,v){var z=s.find("#sportsBookTemplateTable").find("#sportsBookBetTemplate").clone();var t=z.find("#sportsBookBetHeader");var w=z.find("#oddsHeader");z.prop("id","sportsBookBetBoard_"+x);z.prop("eventId",r);z.prop("marketId",y);z.prop("selectionId",u);z.prop("apiSiteType",A);z.attr("marketPk",DataBase.sportsBookMarkets.getEventMarketKey(A,r,y));t.find("#gameTypeName").before(" "+v.selectionName+" ");w.find("#odds").html(v.odds);e(z,A,r,y,u,x,v);return z}function e(w,s,v,x,u,t,r){w.find("#placeBet").unbind("click").click(function(){if(typeof(LoginHandler)!="undefined"&&!LoginHandler.userIsLogin()){return}var y=j(w,s,v,x);f(w,s,v,x,u,t,y)});w.find("#cancel").unbind("click").click(function(){DataBase.sportsBookBet.clear();b(w,v,x,u);SportsBookEventHandler.removeSelectClass();SportsBookBetHandler.getExposure(s,v,x)});w.find("#inputStake").click(function(){w.find("#inputStake").select()});w.find("#inputStake").change(function(){var y=parseFloat(w.find("#inputStake").val())||0;var A=j(w,s,v,x);var z=DataBase.sportsBookBet.updateStake(s,v,x,u,y);SportsBookBetHandler.eventCalculate(w,s,v,x,u,z)});w.find("#inputStake").blur(function(){CoinHandler.hideStakePopupList();var y=parseFloat(w.find("#inputStake").val())||0;var A=j(w,s,v,x);var z=DataBase.sportsBookBet.updateStake(s,v,x,u,y);SportsBookBetHandler.eventCalculate(w,s,v,x,u,z)});w.find("#inputStake").keydown(function(z){var y=z.which;if(KeyEventUtils.isNumberKey(z)||KeyEventUtils.isBackspaceKey(y)||KeyEventUtils.isDeleteKey(y)||KeyEventUtils.isArrowKey(y)||KeyEventUtils.isTabKey(y)||KeyEventUtils.isEnterKey(y)){return}WindowEventUtil.stopEvent(z)});w.find("#inputStake").keyup(function(C){$j(this).val(function(D,E){return StringUtil.commaSeparateNumber(E)});var y=parseFloat(w.find("#inputStake").val())||0;var A=j(w,s,v,x);var z=DataBase.sportsBookBet.updateStake(s,v,x,u,y);SportsBookBetHandler.eventCalculate(w,s,v,x,u,z);var B=C.which;if(KeyEventUtils.isEnterKey(B)){w.find("#placeBet").click()}if(KeyEventUtils.isTabKey(B)&&w.find("#inputStake").is(":focus")){w.find("#inputStake").select()}});if(ApiSiteType.OW.unique()==s){w.find("#getSportsBookMaxStakeBtn").hide()}else{if(ApiSiteType.SPORTRADAR.unique()==s){w.find("#getSportsBookMaxStakeBtn").off("click").on("click",function(){SportsBookBetHandler.getSportsBookMaxStake(w,r)})}}}SportsBookBetHandler.eventCalculate=function(w,y,r,v,s,x){var t=DataBase.sportsBookBet.get(y,r,v,s);var u=o(t);var z=w.find("#placeBet");if(!u){z.addClass("disable")}else{z.removeClass("disable")}SportsBookBetHandler.getExposure(y,r,v)};function o(t){if(t==null){return false}var v=DataBase.sportsBookMarkets.get(t.apiSiteType,t.eventId,t.marketId);if(v==null){return false}var u=v.min;var r=v.max;if(!u||!r){return false}var s=parseFloat(t.stake||"0");if(s<u||s>r){return false}return true}function f(F,G,r,E,y,D,x){var s=F.find("#inputStake");var t=parseFloat(s.val())||0;var z=DataBase.sportsBookBet.get(G,r,E,y);var H="";var A=o(z);if(!A){var v=DataBase.sportsBookMarkets.get(z.apiSiteType,z.eventId,z.marketId);var w=v.min;var B=v.max;if(!w||!B){Trace.log(I18N.get("msg.error.validation.minMaxBetIsNotValid"))}if(t<w){s.val(w);DataBase.sportsBookBet.updateStake(G,r,E,y,w);H+=I18N.get("msg.member.minBet")}else{if(t>B){s.val(B);DataBase.sportsBookBet.updateStake(G,r,E,y,B);H+=I18N.get("msg.member.maxBet")}}}if(H!=""&&!A){a(x,"warning",H,true)}SportsBookBetHandler.getExposure(G,r,E);if(!A){F.find("#placeBet").removeClass("disable");return}z=DataBase.sportsBookBet.getForBet(G,r,E,y);var u=$j("#sportsBookBetBar_"+D);if(u.length==0){u=l(D);F.after(u)}var C=F.find("#sportsBookAcceptAnyOdds").is(":checked")?1:0;SportsBookBetHandler.submitBet(z,G,C,u,x);b(F,r,E,y)}SportsBookBetHandler.submitBet=function(r,s,x,y,u,w){var v=0;var t=0;$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.landingPath+"/member/playerService/sportsBookBet",data:{sportsBookBets:JSON.stringify([r]),isOneClickBet:w,isAcceptAnyOdds:x,apiSiteType:s},beforeSend:function(){if(y!=null){y.show();i(y,k)}},complete:function(){},success:function(z){try{if(z.error){if(u!=null){a(u,"error",z.error,true)}else{NoticeHandler.error(z.error)}return}if(z.result.length==0){return}for(var A in z.result){var E=z.result[A];if(E.status=="SUCCESS"){if(v==0&&t==0){v=E.eventId;t=E.marketId}if(E.unMatchTicket!=null){DataBase.unMatchTicket.update([E.unMatchTicket])}if(E.txn!=null){DataBase.txn.update([E.txn]);if(u!=null){a(u,"success",null,true,"txn",E.txn)}}}else{if(E.error){if(u!=null){a(u,"error",E.error,true)}else{NoticeHandler.error(E.error)}}}}if(v!=0&&t!=""){var D="";if(ApiSiteType.SPORTRADAR.unique()==s){D=CategoryType.SPORTRADAR_SPORTSBOOK.unique()}if(ApiSiteType.OW.unique()==s){D=CategoryType.OW_SPORTSBOOK.unique()}TxnHandler.setEventIdAndMarketId(v,t,D);v=0;t=""}TxnHandler.updateOpenBetSelectionBox();TxnHandler.checkToHideOpenBets();var B=BetHandler.calculateTotalLiability();JsCache.get("#betSlipFullBtn").find("#total").html(CurrencyUtil.formatter(B))}catch(C){Trace.printStackTrace(C)}finally{if(y!=null){y.hide()}SportsBookEventHandler.removeSelectClass();DataBase.sportsBookBet.clear();SportsBookBetHandler.getExposure(r.apiSiteType,r.eventId,r.marketId)}},error:function(z){Trace.printStackTrace(z);if(y!=null){y.hide()}}});JsCache.get("#confirmBetList").hide();JsCache.get("#confirmBetFullBtn").hide()};function l(r){var s=$j("#overWrap").find("#sportsBookTemplateTable").find("#sportsBookBetBarTemplate").clone();s.prop("id","sportsBookBetBar_"+r);return s}function i(u,r){var t=MathUtil.decimal.multiply(r,10);var s=""+MathUtil.decimal.multiply(r,10);if(t>=0){c(t,s,u)}}function c(u,t,v){var r=v.find("#progressBar");var s=n(u,t);r.css("width",s);v.find("#secRemain").html(MathUtil.decimal.divide(u,10)+" sec remainingâ€¦");if(u>0){u--;setTimeout(function(){c(u,t,v)},100)}}function n(u,t){var v=MathUtil.decimal.subtract(t,u);var r=MathUtil.decimal.divide(v,t);if(r>1){r=1}var s=MathUtil.decimal.multiply(r,100);return Math.round(s)+"%"}function m(r,s,t){return r+"_"+s+"_"+t}function j(v,r,t,w){var u=$j("#overWrap");var s=u.find("#sportsBookBetMessage_"+m(r,t,w));if(s.length==0){s=d(r,t,w)}v.after(s);return s}function d(r,t,u){var s=$j("#overWrap").find("#sportsBookTemplateTable").find("#sportsBookBetMessageTemplate").clone();s.prop("id","sportsBookBetMessage_"+m(r,t,u));return s}function a(w,z,A,x,u,v){var r=w.find("#header");w.find("#info").contents().filter(function(){return this.nodeType==3}).remove();w.find("#classWrap").removeClass("success").removeClass("error").removeClass("warning").addClass(z);if(A!=null){r.html(A)}if(v!=null){var t=v.stake;var y=CurrencyType.getInstanceOf(PageConfig.playerCurrency);var s=y.name+y.symbol+t+" at odds "+v.odds;CurrencyUtil.updateSetting({currencySymbol:y.symbol});s+=" Profit: ";s+=UnMatchTicketUtil.getPL(v.odds,v.stake);r.html("Bet Matched");r.after(s)}w.find("#close").unbind("click").click(function(){w.fadeOut()});if(x){setTimeout(function(){w.fadeOut()},3000)}w.fadeIn()}SportsBookBetHandler.getExposure=function(A,r,z){try{if(!ExposureUtil.isEnableShowSportsBookExposure(A,PageConfig.ENABLE_SHOW_SPORTRADAR_SPORTSBOOK_FORECAST,PageConfig.ENABLE_SHOW_OW_SPORTSBOOK_FORECAST)){return}var t=DataBase.sportsBookMarkets.get(A,r,z);if(t==null){Trace.printStackTrace("SportsBook market "+z+" is null");return}var y=t.sportsBookSelection;if(y==null){Trace.printStackTrace("sportsBookSelections "+z+" is null");return}var x=DataBase.sportsBookBet.getByMarketId(A,r,z);var u=DataBase.unMatchTicket.getByMarketId(r,z,null,CategoryType.SPORTRADAR_SPORTSBOOK.unique());var v=DataBase.txn.getByMarketId(r,z+"",null,null,CategoryType.SPORTRADAR_SPORTSBOOK.unique());if(x.length==0&&u.length==0&&v.length==0){g(A,r,z);return}var s=ExposureUtil.calculateSportsBookExposure(A,r,z,t.numberOfWinner,t.numberOfActiveRunners,x,v);h(A,r,z,y,x,v,s);g(A,r,z)}catch(w){Trace.printStackTrace(w)}};function h(E,z,s,A,t,C,J){var x=$j("#sportsBookWrap");var v=x.find("#sportsBookMarket_"+DataBase.sportsBookMarkets.getEventMarketKey(E,z,s));if(v.length==0){return}var I=WebSiteType.getInstanceOf(PageConfig.webSiteType);var w=CurrencyType.getInstanceOf(PageConfig.playerCurrency);var B={precision:2,separateSign:",",currencySymbol:w.symbol,formatter:CurrencyUtil.DefaultFormatter,"trailingZeros,":false};if(I.isFancyFairGroup()){B.precision=0;B.roundingMode="DOWN"}for(var F in A){var L=A[F];var u=v.find("#sportsBookSelection_"+SportsBookEventHandler.getSelectionKey(E,L));if(u.length==0){continue}var D=u.find("#before");var G=u.find("#after");if(J.exposureBeforeBet){var H=J.exposureBeforeBet.betSelections;var r=0;if(H[L.id]==null){r=H[0].minExposure}else{r=H[L.id].minExposure}D.removeClass();if(parseFloat(r)>=0){D.addClass("win")}else{D.addClass("lose")}D.html(CurrencyUtil.formatter(r,B));D.show()}else{D.hide()}if(J.exposureAfterBet){var K=J.exposureAfterBet.betSelections;var y=0;if(K[L.id]==null){y=K[0].minExposure}else{y=K[L.id].minExposure}G.removeClass();if(parseFloat(y)>=0){G.addClass("to-win")}else{G.addClass("to-lose")}G.html(CurrencyUtil.formatter(y,B));G.show()}else{G.hide()}}}function g(t,v,x){var s=$j("#sportsBookWrap");var u=s.find("#sportsBookMarket_"+DataBase.sportsBookMarkets.getEventMarketKey(t,v,x));if(u.length==0){return}var w=u.find("[id^=sportsBookSelection_]");var y=DataBase.sportsBookBet.getByMarketId(t,v,x);var r=DataBase.txn.getByMarketId(v,x+"",null,null,CategoryType.SPORTRADAR_SPORTSBOOK.unique());if(y.length>0){w.find("#after").show()}else{w.find("#after").hide()}if(r.length>0){w.find("#before").show()}else{w.find("#before").hide()}}SportsBookBetHandler.updateExposure=function(){if(!PageConfig.ENABLE_SHOW_SPORTRADAR_SPORTSBOOK_FORECAST&&!PageConfig.ENABLE_SHOW_OW_SPORTSBOOK_FORECAST){return}var t=$j("#sportsBookWrap");if(t.length==0||!t.is(":visible")){return}var r=t.find("[id^=sportsBookMarket_]:visible");if(r.length==0){return}for(var u in r){var x=t.find(r[u]);var v=x.prop("eventId");var w=x.prop("marketId");var s=x.prop("apiSiteType");if(x.length==0||v==null||w==null){return}SportsBookBetHandler.getExposure(s,v,w)}};SportsBookBetHandler.getSportsBookMaxStake=function(v,t){var u=v.find("#sportsBookAcceptAnyOdds").is(":checked")?1:0;var w=DataBase.sportsBookMarkets.get(t.apiSiteType,t.eventId,t.marketId);var s=t.stake;if((s==null||s==0)&&w!=null){s=w.min==null?1:w.min}var r=function(y){try{var x=y.sportsBookMaxStake;var z=v.find("#sportsBookMaxStake");UiUtils.removeContents(z);z.find("#getSportsBookMaxStakeBtn").after(x)}catch(A){Trace.printStackTrace(A)}};SportsBookMarketUtil.getSportsBookMaxStake(t.apiSiteType,t.eventType,t.eventId,t.marketId,t.selectionId,t.odds,s,t.betfairEventId,u,r)}})();if(typeof(DataBase)=="undefined"){DataBase={}}(function(){DataBase.sportsBookBet={};var a=new HashMap();DataBase.sportsBookBet.add=function(k,c,b,j,e,l,d,i,g){var f={apiSiteType:k,eventType:c,eventId:b,marketId:j,selectionId:e,odds:l,selectionName:d,betfairEventId:i,handicap:g};var h=DataBase.sportsBookBet.generateKey(k,b,j,e);a.put(h,f);return f};DataBase.sportsBookBet.generateKey=function(b,d,e,c){return b+"_"+d+"_"+e+"_"+c};DataBase.sportsBookBet.get=function(b,e,f,d){var c=DataBase.sportsBookBet.generateKey(b,e,f,d);return a.get(c)};DataBase.sportsBookBet.remove=function(b,e,f,d){var c=DataBase.sportsBookBet.generateKey(b,e,f,d);return a.remove(c)};DataBase.sportsBookBet.removeByMarket=function(b,c,d){var e=DataBase.sportsBookBet.getByMarketId(b,c,d);$j.each(e,function(g){var f=e[g];if(f==null){return true}DataBase.sportsBookBet.remove(f.apiSiteType,f.eventId,f.marketId,f.selectionId)})};DataBase.sportsBookBet.queryAll=function(){return a.values()};DataBase.sportsBookBet.clear=function(){a.clear()};DataBase.sportsBookBet.updateStake=function(c,f,h,d,g){var e=false;var b=DataBase.sportsBookBet.get(c,f,h,d);if(b==null){return}if(b.stake==null||(b.stake!=null&&b.stake!=g)){e=true}b.stake=g;return e};DataBase.sportsBookBet.getForBet=function(c,e,f,d){var b=DataBase.sportsBookBet.get(c,e,f,d);return{apiSiteType:b.apiSiteType,eventType:b.eventType,eventId:b.eventId,marketId:b.marketId,selectionId:b.selectionId,odds:b.odds,stake:b.stake,betfairEventId:b.betfairEventId,handicap:b.handicap,timestamp:new Date().getTime()}};DataBase.sportsBookBet.getByMarketId=function(c,d,e){var b=[];$j.each(a.values(),function(g,f){if(d==f.eventId&&e==f.marketId){b.push(f)}});return b}})();