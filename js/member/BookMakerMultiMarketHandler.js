if(typeof(BookMakerMultiMarketHandler)=="undefined"){BookMakerMultiMarketHandler={}}(function(){BookMakerMultiMarketHandler.queryTask=null;BookMakerMultiMarketHandler.init=function(){if(BookMakerMarketHandler.isEnableBookMaker()&&MultiMarketsHandler.isHasBookMakerMultiMarket()){BookMakerMultiMarketHandler.initTask()}};BookMakerMultiMarketHandler.initTask=function(){if(BookMakerMultiMarketHandler.queryTask==null){var a=TaskExecuter.createTask(PageConfig.getBookMakerMarketsTaskCycleTime,0,function(){BookMakerMultiMarketHandler.queryBookMakerMultiMarkets(this)});a.version={};a.oddsSettingVersion={};a.selectionTs={};BookMakerMultiMarketHandler.queryTask=a}else{BookMakerMultiMarketHandler.queryTask.isStop=false}BookMakerMultiMarketHandler.queryTask.run();TaskExecuter.execute()};BookMakerMultiMarketHandler.abortTask=function(){if(BookMakerMultiMarketHandler.queryTask!=null){BookMakerMultiMarketHandler.queryTask.stop()}};BookMakerMultiMarketHandler.queryBookMakerMultiMarkets=function(b){var c=DataBase.multiMarkets.queryAllByCategoryType(CategoryType.BOOK_MAKER.value);var e=[];for(var d=0,a=c.length;d<a;d++){var h=c[d];var g=h.eventId;if(typeof(b.version[g])=="undefined"){b.version[g]=-1}if(typeof(b.oddsSettingVersion[g])=="undefined"){b.oddsSettingVersion[g]=-1}if(typeof(b.selectionTs[g])=="undefined"){b.selectionTs[g]=-1}var f={eventType:h.eventType,eventId:h.eventId,version:b.version[g],oddsSettingVersion:b.oddsSettingVersion[g],selectionTs:b.selectionTs[g]};e.push(f)}$j.ajax({type:"POST",dataType:"JSON",url:PageConfig.landingPath+"/member/playerService/queryBookMakerMultiMarkets",data:{marketPks:JSON.stringify(e)},success:function(l){try{if(!l){return}for(var m=0,j=l.bookMakerInfos.length;m<j;m++){var k=l.bookMakerInfos[m];var o=k.bookMakerEvent;var n=o.eventId;if(k.version>b.version[n]){b.version[n]=Math.max(k.version,b.version[n])}if(k.oddsSettingVersion>b.oddsSettingVersion[n]){b.oddsSettingVersion[n]=Math.max(k.oddsSettingVersion,b.oddsSettingVersion[n])}if(k.selectionTs>b.selectionTs[n]){b.selectionTs[n]=Math.max(k.selectionTs,b.selectionTs[n])}BookMakerMarketHandler.updateBookMakerMarkets(k)}}catch(p){Trace.printStackTrace(p)}finally{b.check();TaskExecuter.execute()}},error:function(k,i,j){Trace.log(k.status);Trace.log(j);b.check();TaskExecuterV2.execute()}})}})();